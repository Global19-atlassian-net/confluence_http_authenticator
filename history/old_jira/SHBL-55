



<!DOCTYPE html>















<html>
<head>
    <title>[#SHBL-55] NullPointerException in RemoteUserAuthenticator.java:289 with confluence 4.1.4 and remoteUserAuth-2.1.5.jar - Atlassian Plugins JIRA Studio </title>

    <meta content="general" name="decorator" />
    <link rel="index" href="/secure/IssueNavigator.jspa" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="-1" />
    

    
<meta id="atlassian-token" name="atlassian-token" content="A5G2-B7UC-JLK8-Z7KY|30c88777a03ab34250c5b8b0895f887588a0780b|lout">


    <link rel="shortcut icon" href="/s/en_US-31q2po/650/149/_/favicon.ico">
    <link rel="icon" type="image/png" href="/s/en_US-31q2po/650/149/_/images/icons/favicon.png">

    
    <script type="text/javascript">var contextPath = '';</script>
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/1/_/download/superbatch/css/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/1/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if IE 9]>
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/1/_/download/superbatch/css/batch.css?conditionalComment=IE+9" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/1/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/1.0/_/download/batch/jira.webresources:jquery-fancybox/jira.webresources:jquery-fancybox.css" media="all">
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/1.0/_/download/batch/jira.webresources:autocomplete/jira.webresources:autocomplete.css" media="all">
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/1.0/_/download/batch/jira.webresources:global-static/jira.webresources:global-static.css" media="all">
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/1.0/_/download/batch/jira.webresources:global-static/jira.webresources:global-static.css?media=print" media="print">
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/5.7/_/download/batch/com.pyxis.greenhopper.jira:gh-ranking/com.pyxis.greenhopper.jira:gh-ranking.css" media="all">
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/1.0.6/_/download/batch/com.atlassian.plugin.atlassian-feedback-plugin:feedback/com.atlassian.plugin.atlassian-feedback-plugin:feedback.css" media="all">
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/0.15.4/_/download/batch/com.atlassian.jira.plugins.jira-bitbucket-connector-plugin:resources/com.atlassian.jira.plugins.jira-bitbucket-connector-plugin:resources.css" media="all">
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/4.4-studio-rc3/_/download/batch/com.atlassian.jira.jira-admin-quicknav-plugin:admin-quicksearch/com.atlassian.jira.jira-admin-quicknav-plugin:admin-quicksearch.css" media="all">
<script type="text/javascript" src="/s/en_US-31q2po/650/149/1/_/download/superbatch/js/batch.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/1.0/_/download/batch/jira.webresources:jquery-fancybox/jira.webresources:jquery-fancybox.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/1.0/_/download/batch/jira.webresources:calendar/jira.webresources:calendar.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/1.0/_/download/batch/jira.webresources:viewissue/jira.webresources:viewissue.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/1.0/_/download/batch/jira.webresources:autocomplete/jira.webresources:autocomplete.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/1.0/_/download/batch/jira.webresources:jira-fields/jira.webresources:jira-fields.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/5.7/_/download/batch/com.pyxis.greenhopper.jira:gh-ranking/com.pyxis.greenhopper.jira:gh-ranking.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/5.7/_/download/batch/com.pyxis.greenhopper.jira:gh-globalkeyboardshortcuts/com.pyxis.greenhopper.jira:gh-globalkeyboardshortcuts.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/1.0.6/_/download/batch/com.atlassian.plugin.atlassian-feedback-plugin:feedback/com.atlassian.plugin.atlassian-feedback-plugin:feedback.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/0.4/_/download/batch/com.atlassian.jira.plugins.jira-github-connector-plugin:resources/com.atlassian.jira.plugins.jira-github-connector-plugin:resources.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/0.15.4/_/download/batch/com.atlassian.jira.plugins.jira-bitbucket-connector-plugin:resources/com.atlassian.jira.plugins.jira-bitbucket-connector-plugin:resources.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/4.4-studio-rc3/_/download/batch/com.atlassian.jira.jira-soy-plugin:soy-deps/com.atlassian.jira.jira-soy-plugin:soy-deps.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/4.4-studio-rc3/_/download/batch/com.atlassian.jira.jira-admin-quicknav-plugin:admin-quicksearch/com.atlassian.jira.jira-admin-quicknav-plugin:admin-quicksearch.js" ></script>

    
        <script type="text/javascript" src="/rest/api/1.0/shortcuts/650/2c704f3b1c272597f28d679bb85da011/shortcuts.js?context=issueaction&amp;context=issuenavigation"></script>
    
    <link rel="search" type="application/opensearchdescription+xml" href="/osd.jsp" title="Atlassian Plugins JIRA Studio"/>
</head>



















<body id="jira" class="nl type-ab stalker sn">










<link rel="stylesheet" type="text/css" href="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/css/menu.css">
<link rel="stylesheet" type="text/css" href="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/css/navbar.css">
<link rel="stylesheet" type="text/css" href="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/css/dialog.css">
<!--[if IE]>
<link rel="stylesheet" type="text/css" href="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/css/dialog-ie.css">
<![endif]-->
<!--[if lt IE 9]>
<link rel="stylesheet" type="text/css" href="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/css/navbar-ie.css">
<![endif]-->
<!--[if IE 9]>
<link rel="stylesheet" type="text/css" href="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/css/navbar-ie9.css">
<![endif]-->
<link rel="stylesheet" type="text/css" href="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/css/userstatus.css">
<link rel="stylesheet" type="text/css" href="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_admin_styles/css/studioadmin.css">
<link rel="stylesheet" type="text/css" href="/plugins/servlet/studio/dynamiccss/studio-colors-css.css">
<link rel="stylesheet" type="text/css" href="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.theme.jira:studio_jira_resources/css/studio-jira-theme-override.css">

<div id="header" style="display:none">
</div>
<div class="studio-header" id="studio-header">

	<meta id="application-base-url" name="application-base-url" content="https://studio.plugins.atlassian.com"/>
<meta id="studio-context-path" name="studio-context-path" content=""/>
<meta id="jira-base-url" name="jira-base-url" content="https://studio.plugins.atlassian.com"/>
<meta id="confluence-base-url" name="confluence-base-url" content="https://studio.plugins.atlassian.com/wiki"/>

<div class="header-first-level">
    <div class="first-level-overlay">
        <div id="studio-logo">
            <a href="https://studio.plugins.atlassian.com/secure/Dashboard.jspa" class="logolink"><img src="https://studio.plugins.atlassian.com/download/resources/com.atlassian.studio.static:studio_images/images/StudioLogo.png" border="0" alt="Atlassian Plugins JIRA Studio"></a>
        </div>

        <div class="top-level-container">

            <div class="nav-dropdowns">
                <div id="studio-project-menu" class="project-menu">
	<ul class="ajs-menu-bar">
    	<li class="normal ajs-menu-item">
                        			<a class="user trigger ajs-menu-title" href="#"><span><span> Confluence Shibboleth Authenticator </span></span></a>

			<div class="ajs-drop-down hidden">
    			<ul class="first">

					                		                                                                                                                <li><a href="/browse/CNET" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=10979&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">.NET Authenticator with Single Sign-O...</span></a></li>
					                        <li><a href="/browse/ATTT" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=11825&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">@ Time Tracker</span></a></li>
					                        <li><a href="/browse/CONFABAPPLUGIN" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=10982&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">ABAP Code-Formatter</span></a></li>
					                        <li><a href="/browse/ABAP" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=11605&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">ABAP Syntax Highlighter</span></a></li>
					                        <li><a href="/browse/APRV" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=10360&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Ad hoc Workflows</span></a></li>
					                        <li><a href="/browse/ADHOC" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=10931&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Adhoc Builder - Deployment Tool</span></a></li>
					                        <li><a href="/browse/AALOG" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=11604&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Admin Activity Logger</span></a></li>
					                        <li><a href="/browse/ATD" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=11521&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">After the Deadline</span></a></li>
					                        <li><a href="/browse/BAACL" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=11551&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Agent ACL</span></a></li>
					                        <li><a href="/browse/AAS" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=10930&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Agile Application Stack</span></a></li>
					                        <li><a href="/browse/SPARTEZASCP" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=11123&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Agile Scrum Cards Print</span></a></li>
					                        <li><a href="/browse/CAGL" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=10951&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Agile Toolkit Plugin</span></a></li>
					                        <li><a href="/browse/JAVT" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=11031&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Agile Velocity Tracking plugin</span></a></li>
					                        <li><a href="/browse/ALFRES" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=10933&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Alfresco Crowd Integration module</span></a></li>
					                        <li><a href="/browse/ALFCON" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=11320&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Alfresco to Confluence Connector</span></a></li>
					                        <li><a href="/browse/ACCF" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=11371&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">All Comments Custom Field Type</span></a></li>
					                        <li><a href="/browse/CAE" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=10950&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Archive Extractor Plugin</span></a></li>
					                        <li><a href="/browse/STRM" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=10570&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Atlassian Activity Stream Plugin</span></a></li>
					                        <li><a href="/browse/ACLI" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=10882&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Atlassian Command Line Interface</span></a></li>
					                        <li><a href="/browse/PLE" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=11107&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Atlassian Connector for Eclipse</span></a></li>
										                                            <li id="ds-more"><a href="https://studio.plugins.atlassian.com/secure/BrowseProjects.jspa?selectedCategory=all" class="more-projects"><span>View All Projects</span></a></li>
					
				</ul>
    		</div>
    	</li>
    </ul>
</div>	


                
	    <div id="studio-user-menu-container">
        <a class="login-link" href="/login.jsp?os_destination=%2Fbrowse%2FSHBL-55">Log In</a>
    </div>
    
            </div> <!-- /nav-dropdowns -->

            <div class="navigation-tabs studio-menu">
                
<ul id="studio-tabs">
			<li class="current"><a href="/browse/SHBL">Issues</a></li>
			<li><a href="https://studio.plugins.atlassian.com/wiki/display/SHBL">Wiki</a></li>
			<li><a href="https://studio.plugins.atlassian.com/source/browse/SHBL">Source</a></li>
			<li><a href="https://studio.plugins.atlassian.com/source/cru/?filter=custom&project=CR-SHBL">Reviews</a></li>
			<li><a href="https://studio.plugins.atlassian.com/builds/browse/SHBL">Builds</a></li>
	</ul>

            </div>

        </div> <!-- /top-level-container -->
    </div>  <!-- /first-level-overlay -->
</div> <!-- /header-first-level -->


    <div id="header-bottom">

        <div class="second-level-nav studio-menu">

                            
                
<ul id="main-nav" class="menu-bar standard-menu-bar">
                        <li class="aui-dd-parent lazy  ">
                    <a class="lnk"
                href="/secure/Dashboard.jspa"
                 id="home_link"                 accessKey="h"                 title="View your current Dashboard"                >Dashboards</a>

                    <span class="drop-wrap">
            <a class="drop aui-dd-link"
                                    id="home_link_drop"
                    rel="home_link"
                    accessKey="d"
                    title="Access more options (Alt+d)"
                                href="#"><span>Access more options (Alt+d)</span></a></span>
                </li>
                        <li class="aui-dd-parent lazy  selected  ">
                    <a class="lnk"
                href="/secure/IssueNavigator.jspa"
                 id="find_link"                 accessKey="f"                 title="View your current filter"                >Issues</a>

                    <span class="drop-wrap">
            <a class="drop aui-dd-link"
                                    id="find_link_drop"
                    rel="find_link"
                    accessKey="i"
                    title="Access more options (Alt+i)"
                                href="#"><span>Access more options (Alt+i)</span></a></span>
                </li>
                        <li class="aui-dd-parent nonlazy  ">
                    <a class="lnk"
                href="/secure/GreenHopper.jspa"
                 id="greenhopper_menu"                                 title="Manage your project with GreenHopper"                >Agile</a>

                                                                                                            <span class="drop-wrap">
                            <a class="drop aui-dd-link"
                                                                    id="greenhopper_menu_drop"
                                    accessKey="g"
                                    rel="greenhopper_menu"
                                    title="Access more options (Alt+g)"
                                                                href="#"><span>Access more options</span></a></span>
                            <div class="aui-list hidden">
                                                
                            <ul id="greenhopper_menu_dropdown" class="aui-list-section aui-first   aui-last  ">
                                                                    <li class="aui-list-item"><a
                                         id="planningboard-mlink"                                         class="aui-list-item-link   "
                                                                                                                        href="/secure/VersionBoard.jspa">Planning Board</a></li>
                                                                    <li class="aui-list-item"><a
                                         id="taskboard-mlink"                                         class="aui-list-item-link   "
                                                                                                                        href="/secure/TaskBoard.jspa">Task Board</a></li>
                                                                    <li class="aui-list-item"><a
                                         id="chartboard-mlink"                                         class="aui-list-item-link   "
                                                                                                                        href="/secure/ChartBoard.jspa">Chart Board</a></li>
                                                                    <li class="aui-list-item"><a
                                         id="releasedboard-mlink"                                         class="aui-list-item-link   "
                                                                                                                        href="/secure/ArchiveChartBoard.jspa">Released Board</a></li>
                                                            </ul>
                                                    </div>
                            </li>
    </ul>

                
            
        </div> <!-- /second-level-nav -->

        <div class="quick-action-search">

            
            <a id="keyshortscuthelp" class="item-link hidden" title="Get more information about JIRA's Keyboard Shortcuts"
               href="/secure/ViewKeyboardShortcuts!default.jspa">Keyboard Shortcuts</a>
                            <a id="browse_link" class="hidden" href="/browse/SHBL">Selected Project</a>
            
            <form id="quick-search" class="dont-default-focus userpref-form" method="get" action="https://studio.plugins.atlassian.com/secure/StudioSearch.jspa">
    <fieldset>
        <legend>Quick Search</legend>
		<input type="hidden" name="suggest-tracking" value="search" />
		<input type="hidden" name="quickSearch" value="true" />
        <input id="studio-quick-search-query" type="text" accessKey="q" autocomplete="off" name="query" size="25"/>
        <input id="quick-search-submit" type="submit" value="Search"/>
    </fieldset>
    <fieldset class="hidden parameters">
        <input type="hidden" id="quickSearchPlaceholder" value="Search">
    </fieldset>
</form>

        </div> <!-- /quick-action-search -->

    </div> <!-- /header-second-level -->

</div>










<fieldset class="hidden parameters">
    <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation.">
    <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation.  Please try to <a href='/login.jsp?os_destination=%2Fbrowse%2FSHBL-55'>log in</a> or <a href='/secure/Signup!default.jspa'>sign up</a> for an account.">
    <input type="hidden" title="ajaxUnauthorisedAlert" value="You are not authorised to perform this operation.  Please log in.">
    <input type="hidden" title="baseURL" value="https://studio.plugins.atlassian.com:443">
    <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted.  This may be a temporary glitch or the server may be down.">
    <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation.">
    <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser">
    <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown">

    <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost.">
    <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog.">
    <input type="hidden" title="keyType" value="Type">
    <input type="hidden" title="keyThen" value="then">
    <input type="hidden" title="dblClickToExpand" value="Double click to expand">
    <input type="hidden" title="actions" value="Actions">
    <input type="hidden" title="removeItem" value="Remove">
    <input type="hidden" title="workflow" value="Workflow">
    <input type="hidden" title="labelNew" value="New Label">
    <input type="hidden" title="enterIssueKey" value="Enter issue key">
    <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all">
    <input type="hidden" title="closelink" value="Close">
    <input type="hidden" title="dotOperations" value="Operations">
    <input type="hidden" title="dotLoading" value="Loading...">
    <input type="hidden" title="frotherSuggestions" value="Suggestions">
    <input type="hidden" title="frotherNomatches" value="No Matches">
    <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version.">
    <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component.">
    <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid.">
</fieldset>




<div class="alertHeader">
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-6032469-24");
pageTracker._trackPageview();
} catch(err) {}</script>

<script type="text/javascript" charset="utf-8">
  (function(){
    t = document.createElement('script');t.async=true;t.type ='text/javascript';
    t.src = ('https:' == document.location.protocol ? 'https://secure.' : 'http://api.') + 'tellthemwhen.com/api/v2/notices/9ffb4ac1f71.js';
    var s=document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(t,s);
  })();
</script>

<!-- <div id="TTWNotify" style="display:none"></div> -->

<div style="text-align: center; border: #C00; background-color: #FF6600; line-height: 2em">studio.plugins.atlassian.com will be decommissioned in early 2013. If you are a project maintainer, please email <a href="mailto:developer-relations@atlassian.com">Atlassian Developer Relations</a> if you require assistance to migrate your project off this server.</div>
</div>




<fieldset class="hidden parameters">
    <input type="hidden" id="viewMoreMsg" value="Click to view {0} more">
    <input type="hidden" id="hideMsg" value="Hide" >
    <input type="hidden" id="error-401" value="Cannot perform this operation. You are not logged in." >
    <input type="hidden" id="issueOpTitleUnvote" value="Remove vote for this issue" >
    <input type="hidden" id="issueOpTitleVote" value="Vote for this issue" >
    <input type="hidden" id="issueOpTitleWatch" value="Start watching this issue" >
    <input type="hidden" id="issueOpTitleUnwatch" value="Stop watching this issue" >
    <input type="hidden" id="issueOpUnvote" value="Remove Vote" >
    <input type="hidden" id="issueOpVote" value="Add Vote" >
    <input type="hidden" id="issueOpWatch" value="Watch Issue" >
    <input type="hidden" id="issueOpUnwatch" value="Stop Watching" >
    <input type="hidden" id="i18nVote" value="Vote" >
    <input type="hidden" id="i18nVoted" value="Voted" >
    <input type="hidden" id="i18nWatch" value="Watch" >
    <input type="hidden" id="i18nWatching" value="Watching" >
</fieldset>

<div id="stalker"  class="stalker">
    <div class="item-header">
    
        












<h1 class="item-name avatar" style="background-image:url(/secure/projectavatar?pid=10580&amp;avatarId=10011&amp;size=large)">
        
            <img id="project-avatar" alt="" class="project-avatar-48" height="48" src="/secure/projectavatar?pid=10580&amp;avatarId=10011&amp;size=large" width="48" />
        
        <span>Confluence Shibboleth Authenticator</span>
</h1>


<ul class="breadcrumbs">
    <li><a id="project-name-val" href="/browse/SHBL">Confluence Shibboleth Authenticator</a></li>
    
    <li><a id="key-val" rel="31208" href="/browse/SHBL-55">SHBL-55</a></li>
</ul>

<h2 id="issue_header_summary" class="item-summary"><a href="/browse/SHBL-55">NullPointerException in RemoteUserAuthenticator.java:289 with confluence 4.1.4 and remoteUserAuth-2.1.5.jar</a></h2>

    
    </div>
    




    <div class="command-bar">
        <div class="ops-cont">
            <div class="ops-menus">
                
                
                    <ul id="opsbar-login" class="first ops">
                        <li id="ops-login" class="last">
                            <a id="ops-login-lnk" class="button first last" href="/login.jsp?os_destination=%2Fbrowse%2FSHBL-55">Log In</a>
                        </li>
                    </ul>
                
                
                    
                        
                    
                
                    
                        
                    
                
                
                    
                        <ul class="ops" id="view-drop">
                            <li>
                                <div class="aui-dd-parent">
                                    <a href="#" title="View this issue in another format" class="drop lnk aui-dd-link standard icon-views"><span>Views</span></a>
                                        <div class="aui-list hidden">
                                        <ul class="aui-first aui-last aui-list-section">
                                            
                                                <li class="aui-list-item">
                                                    <a class="aui-list-item-link" rel="nofollow" href="/si/jira.issueviews:issue-xml/SHBL-55/SHBL-55.xml">XML</a>
                                                </li>
                                            
                                                <li class="aui-list-item">
                                                    <a class="aui-list-item-link" rel="nofollow" href="/si/jira.issueviews:issue-word/SHBL-55/SHBL-55.doc">Word</a>
                                                </li>
                                            
                                                <li class="aui-list-item">
                                                    <a class="aui-list-item-link" rel="nofollow" href="/si/jira.issueviews:issue-html/SHBL-55/SHBL-55.html">Printable</a>
                                                </li>
                                            
                                        </ul>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    
                
            </div>
        </div>
    </div>          


    <div class="btm"></div>
</div>
<div id="main-content">
    <div class="active-area">
        <div class="column" id="primary">
            <div class="content">
                
                
                
                

                    <div id="details-module" class="module toggle-wrap">
                        <div class="mod-header">
                            <h3 class="toggle-title">Details</h3>
                        </div>
                        <div class="mod-content">
                            <ul id="issuedetails" class="property-list two-cols">
    <li class="item">
        <div class="wrap">
            <strong class="name">Type:</strong>
            <span id="type-val" class="value">
                                                        <img alt="Bug" height="16" src="/images/icons/bug.gif" title="Bug - A problem which impairs or prevents the functions of the product." width="16" />
             Bug
            </span>
        </div>
    </li>
    <li class="item item-right">
        <div class="wrap">
            <strong class="name">Status:</strong>
            <span id="status-val" class="value">
                                                        <img alt="Closed" height="16" src="/images/icons/status_closed.gif" title="Closed - The issue is considered finished, the resolution is correct. Issues which are closed can be reopened." width="16" />
             Closed
            </span>
                    </div>
    </li>
            <li class="item">
            <div class="wrap">
                <strong class="name">Priority:</strong>
                <span id="priority-val" class="value">
                                                                <img alt="Blocker" height="16" src="/images/icons/priority_blocker.gif" title="Blocker - Blocks development and/or testing work, production could not run." width="16" />
             Blocker
                </span>
            </div>
        </li>
                                <li class="item item-right">
            <div class="wrap">
                <strong class="name">Resolution:</strong>
                <span id="resolution-val" class="value resolved" >
                                         Fixed
                                </span>
            </div>
        </li>
                <li class="item">
            <div class="wrap">
                <strong class="name">Affects Version/s:</strong>
                <span id="versions-val" class="value">
                                            <span class="shorten" id="versions-field">
                                                            <span title="2.1.5 Changes by Gary Weaver: SHBL-53: Support for Confluence 4.1.x">2.1.5</span>                                                    </span>
                                    </span>
            </div>
        </li>
                <li class="item item-right">
            <div class="wrap">
                <strong class="name">Fix Version/s:</strong>
                <span id="fixfor-val" class="value">
                                            <span class="shorten" id="fixVersions-field">
                                                            <a href="/browse/SHBL/fixforversion/15729" title="2.1.9 Changes by Gary Weaver: SHBL-55, SHBL-56: Support for Confluence 4.1.x">2.1.9</a>                                                    </span>
                                    </span>
            </div>
        </li>
                <li class="item">
            <div class="wrap">
                <strong class="name">Component/s:</strong>
                <span id="components-val" class="value">
                                            None
                                    </span>
            </div>
        </li>
                    <li class="item full-width">
            <div class="wrap" id="wrap-labels">
                <strong class="name">Labels:</strong>
                    <div class="labels-wrap value">
            <span class="labels" id="labels-31208-value">None</span>
                </div>
            </div>
        </li>
                <li class="item full-width">
            <div class="wrap">
                <strong class="name">Environment:</strong>
                <div id="environment-val" class="value">
                                  Confluence v4.1.4
      
                </div>
            </div>
        </li>
    </ul>


                            
                                

<div id="customfieldmodule">
    

    
    
    <ul id="tabCellPane1" class="property-list">
        
        
            
                
                
                    <li id="rowForcustomfield_10061" class="item">
                        <div class="wrap">
                            <strong title="Internal Complexity" class="name">Internal Complexity:</strong>
                            <div id="customfield_10061-val" class="value type-select">
                                 Unknown

                            </div>
                        </div>
                    </li>
                
            
        
            
                
                
                    <li id="rowForcustomfield_10060" class="item">
                        <div class="wrap">
                            <strong title="Internal Value" class="name">Internal Value:</strong>
                            <div id="customfield_10060-val" class="value type-select">
                                 Unknown

                            </div>
                        </div>
                    </li>
                
            
        
            
                
                
                    <li id="rowForcustomfield_10082" class="item">
                        <div class="wrap">
                            <strong title="Rank" class="name">Rank:</strong>
                            <div id="customfield_10082-val" class="value type-greenhopper-ranking">
                                
<div id="RankField_customfield_10082view">	<span id="RankValue_customfield_10082view">Issue can not be ranked.</span>&nbsp;
			<span id="RankPage_customfield_10082view" class="gh-rankpage gh-jira-rankpage"></span>
</div>

                            </div>
                        </div>
                    </li>
                
            
        
    </ul>
    
</div>

                            
                        </div>
                    </div>

                    




<div id="descriptionmodule" class="module toggle-wrap">
    <div class="mod-header">
        <h3 class="toggle-title">Description</h3>
    </div>
    <div id="issue-description" class="mod-content">
        <p>In an attempt to solve issue described in <a href="/browse/SHBL-53" title="local user login throws an exception in 4.1"><del>SHBL-53</del></a>, I upgraded remoteUserAuth-2.0.1.jar to remoteUserAuth-2.1.5.jar. Before, I could use shib login (just not local login per <a href="/browse/SHBL-53" title="local user login throws an exception in 4.1"><del>SHBL-53</del></a>). Now I get a null pointer exception when I try to use the shib login.</p>

<p>==================<br/>
Cause<br/>
java.lang.NullPointerException<br/>
    at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.purgeUserRoles(RemoteUserAuthenticator.java:289)</p>

<p>Stack Trace:<a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/hide">hide</a></p>

<p>java.lang.NullPointerException<br/>
	at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.purgeUserRoles(RemoteUserAuthenticator.java:289)<br/>
	at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.updateGroupMemberships(RemoteUserAuthenticator.java:810)<br/>
	at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.getUserForAtlassianLoginFilter(RemoteUserAuthenticator.java:921)<br/>
	at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.getUser(RemoteUserAuthenticator.java:818)<br/>
	at com.atlassian.seraph.filter.SecurityFilter.doFilter(SecurityFilter.java:125)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.security.auth.trustedapps.filter.TrustedApplicationsFilter.doFilter(TrustedApplicationsFilter.java:98)<br/>
	at com.atlassian.confluence.util.AbstractBootstrapHotSwappingFilter.doFilter(AbstractBootstrapHotSwappingFilter.java:30)<br/>
	at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.seraph.filter.BaseLoginFilter.doFilter(BaseLoginFilter.java:150)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:46)<br/>
	at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter$1.doFilter(DelegatingPluginFilter.java:66)<br/>
	at com.atlassian.oauth.serviceprovider.internal.servlet.OAuthFilter.doFilter(OAuthFilter.java:71)<br/>
	at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter.doFilter(DelegatingPluginFilter.java:74)<br/>
	at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:42)<br/>
	at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:77)<br/>
	at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:63)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.confluence.util.ClusterHeaderFilter.doFilter(ClusterHeaderFilter.java:37)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.johnson.filters.AbstractJohnsonFilter.doFilter(AbstractJohnsonFilter.java:72)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at org.springframework.orm.hibernate.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:170)<br/>
	at com.atlassian.spring.filter.FlushingSpringSessionInViewFilter.doFilterInternal(FlushingSpringSessionInViewFilter.java:29)<br/>
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.confluence.util.ConfluenceErrorFilter.doFilter(ConfluenceErrorFilter.java:22)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.util.profiling.filters.ProfilingFilter.doFilter(ProfilingFilter.java:99)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.confluence.core.datetime.RequestTimeThreadLocalFilter.doFilter(RequestTimeThreadLocalFilter.java:35)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.gzipfilter.GzipFilter.doFilterInternal(GzipFilter.java:80)<br/>
	at com.atlassian.gzipfilter.GzipFilter.doFilter(GzipFilter.java:51)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.core.filters.cache.AbstractCachingFilter.doFilter(AbstractCachingFilter.java:33)<br/>
	at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:46)<br/>
	at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter$1.doFilter(DelegatingPluginFilter.java:66)<br/>
	at com.atlassian.confluence.extra.webdav.servlet.filter.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:43)<br/>
	at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter.doFilter(DelegatingPluginFilter.java:74)<br/>
	at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:42)<br/>
	at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:77)<br/>
	at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:63)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.confluence.web.filter.validateparam.RequestParamValidationFilter.doFilter(RequestParamValidationFilter.java:58)<br/>
	at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.confluence.web.filter.TranslationModeFilter.doFilter(TranslationModeFilter.java:43)<br/>
	at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.confluence.plugin.servlet.filter.ActionContextCleanUp.doFilter(ActionContextCleanUp.java:71)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.confluence.web.filter.LanguageExtractionFilter.doFilter(LanguageExtractionFilter.java:54)<br/>
	at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.confluence.util.RequestCacheThreadLocalFilter.doFilter(RequestCacheThreadLocalFilter.java:25)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.core.filters.encoding.AbstractEncodingFilter.doFilter(AbstractEncodingFilter.java:41)<br/>
	at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.core.filters.HeaderSanitisingFilter.doFilter(HeaderSanitisingFilter.java:44)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.confluence.servlet.FourOhFourErrorLoggingFilter.doFilter(FourOhFourErrorLoggingFilter.java:65)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)<br/>
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)<br/>
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)<br/>
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)<br/>
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)<br/>
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:291)<br/>
	at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:190)<br/>
	at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:291)<br/>
	at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:776)<br/>
	at org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:705)<br/>
	at org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.java:898)<br/>
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:690)<br/>
	at java.lang.Thread.run(Thread.java:662)</p>


<p>Referer URL<br/>
<a href="https://login.wisc.edu/idp/profile/SAML2/Redirect/SSO">https://login.wisc.edu/idp/profile/SAML2/Redirect/SSO</a></p>
    </div>
</div>





                    
                        






	<div id="attachmentmodule" class="module toggle-wrap">
		<div class="mod-header">
            <ul class="ops">
            
                <li class="drop" id="attachment-sorting-options">
                    <div class="aui-dd-parent">
                        <a href="#" id="attachment-sort-key-list" class="icon drop-menu aui-dropdown-trigger" title="More Options"><span>More Options</span></a>
                        <div class="aui-dropdown-content aui-list aui-list-checked">
                            <ul class="aui-list-section">
                                <li class="aui-list-item  aui-checked">
                                    <a id="attachment-sort-key-name" class="aui-list-item-link" rel="nofollow"
                                       href="/browse/SHBL-55?attachmentSortBy=fileName#attachmentmodule"
                                       title="Sort By Name">
                                        Sort By Name
                                    </a>
                                </li>
                                <li class="aui-list-item">
                                    <a id="attachment-sort-key-date" class="aui-list-item-link" rel="nofollow"
                                       href="/browse/SHBL-55?attachmentSortBy=dateTime#attachmentmodule"
                                       title="Sort By Date">
                                        Sort By Date
                                    </a>
                                </li>
                            </ul>
                            <ul class="aui-list-section " id="attachment-sort-direction-list">
                                <li class="aui-list-item aui-checked">
                                    <a id="attachment-sort-direction-asc" class="aui-list-item-link" rel="nofollow"
                                       href="/browse/SHBL-55?attachmentOrder=asc#attachmentmodule"
                                       title="Ascending">
                                        Ascending
                                    </a>
                                </li>
                                <li class="aui-list-item">
                                    <a id="attachment-sort-direction-desc" class="aui-list-item-link" rel="nofollow"
                                       href="/browse/SHBL-55?attachmentOrder=desc#attachmentmodule"
                                       title="Descending">
                                        Descending
                                    </a>
                                </li>
                            </ul>
                            
                                <ul class="aui-list-section aui-last">
                                    
                                        <li class="aui-list-item">
                                            <a id="aszip" href="/secure/attachmentzip/31208.zip"
                                               class="aui-list-item-link" title="Download all attachments as a ZIP file">
                                                Download All
                                            </a>
                                        </li>
                                    
                                    
                                </ul>
                            
                        </div>
                    </div>
                </li>
            </ul>
            <h3 class="toggle-title">Attachments</h3>
        </div>
        <div class="mod-content">
        
            <ol id="file_attachments" class="item-attachments">
            
                
                

                <li class="attachment-content ">
                    
                    
                        <div class="attachment-thumb">
                            <a href="/secure/attachment/20077/group_creation_in_2.1.8.log">
                                

    
        <img src="/images/icons/attach/text.gif" height="16" width="16"
             border="0" alt="Text File">        
        
    


                            </a>
                        </div>
                        <dl>
                            
                    <dt class="attachment-title">
                        <a href="/secure/attachment/20077/group_creation_in_2.1.8.log"
                           title="Latest 07/Feb/12 2:48 PM - John Hare">group_creation_in_2.1.8.log
                        </a>
                    </dt>
                    <dd class="attachment-date">
                        07/Feb/12 2:48 PM</dd>
                    <dd class="attachment-size">
                        2.06 MB</dd>
                    <dd class="attachment-author">
                        John Hare
                    </dd>
                
                        </dl>
                    
                </li>
            
                
                

                <li class="attachment-content ">
                    
                    
                        <div class="attachment-thumb">
                            <a href="/secure/attachment/20053/remoteUserAuthenticator.properties">
                                

    
    
        <img src="/images/icons/attach/file.gif" height="16" width="16" border="0" alt="File">
    


                            </a>
                        </div>
                        <dl>
                            
                    <dt class="attachment-title">
                        <a href="/secure/attachment/20053/remoteUserAuthenticator.properties"
                           title="Latest 05/Feb/12 3:58 AM - John Hare">remoteUserAuthenticator.properties
                        </a>
                    </dt>
                    <dd class="attachment-date">
                        05/Feb/12 3:58 AM</dd>
                    <dd class="attachment-size">
                        12 kB</dd>
                    <dd class="attachment-author">
                        John Hare
                    </dd>
                
                        </dl>
                    
                </li>
            
                
                

                <li class="attachment-content ">
                    
                    
                        <div class="attachment-thumb">
                            <a href="/secure/attachment/20054/seraph-config.xml">
                                

    
        <img src="/images/icons/attach/xml.gif" height="16" width="16"
             border="0" alt="XML File">        
        
    


                            </a>
                        </div>
                        <dl>
                            
                    <dt class="attachment-title">
                        <a href="/secure/attachment/20054/seraph-config.xml"
                           title="Latest 05/Feb/12 3:58 AM - John Hare">seraph-config.xml
                        </a>
                    </dt>
                    <dd class="attachment-date">
                        05/Feb/12 3:58 AM</dd>
                    <dd class="attachment-size">
                        2 kB</dd>
                    <dd class="attachment-author">
                        John Hare
                    </dd>
                
                        </dl>
                    
                </li>
            
            </ol>
    
        

        
        </div>
    </div>

    


                    
                
                
                    <div class='module toggle-wrap' id='activitymodule'><div id='activitymodule_heading' class='mod-header'><h3 class='toggle-title'>Activity</h3></div><div class='mod-content'>    <div class="tabwrap tabs2">
                    <div class="sortwrap">
                                    <a class="icon icon-sort-down" rel="nofollow" href="/browse/SHBL-55?actionOrder=desc#issue-tabs" title="Ascending order - Click to sort in descending order"><span>Ascending order - Click to sort in descending order</span></a>
                            </div>
                <ul id="issue-tabs" class="tabs horizontal">
                                    <li><a id="all-tabpanel" href="/browse/SHBL-55?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel#issue-tabs"><strong>All</strong></a></li>
                                                <li id="comment-tabpanel" class="active"><strong>Comments</strong></li>
                                                <li><a id="worklog-tabpanel" href="/browse/SHBL-55?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel#issue-tabs"><strong>Work Log</strong></a></li>
                                                <li><a id="changehistory-tabpanel" href="/browse/SHBL-55?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel#issue-tabs"><strong>History</strong></a></li>
                                                <li><a id="activity-stream-issue-tab" href="/browse/SHBL-55?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab#issue-tabs"><strong>Activity</strong></a></li>
                            </ul>
    </div>
    <div class="issuePanelContainer" id="issue_actions_container">
                        <div id="comment-54801" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54801&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54801" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54801_verbose" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54801_verbose subText'><span class='date user-tz' title='05/Feb/12 4:08 AM'><time datetime='2012-02-05T04:08-0800'>05/Feb/12 4:08 AM</time></span></span>  </div>
        <div class="action-body flooded"><p>Note: The NullPointerException is what happens when I try the Shib login. When I try the local user login I get the following stack trace (i.e. looks like the same issue as <a href="/browse/SHBL-53" title="local user login throws an exception in 4.1"><del>SHBL-53</del></a>).</p>

<p>====================<br/>
Cause</p>

<p>java.lang.ClassCastException: com.atlassian.confluence.user.SessionSafePrincipal cannot be cast to com.atlassian.user.User<br/>
    at com.atlassian.confluence.user.AuthenticatedUserThreadLocal.getUser(AuthenticatedUserThreadLocal.java:25)</p>

<p>Stack Trace:<a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/hide">hide</a></p>

<p>java.lang.ClassCastException: com.atlassian.confluence.user.SessionSafePrincipal cannot be cast to com.atlassian.user.User<br/>
	at com.atlassian.confluence.user.AuthenticatedUserThreadLocal.getUser(AuthenticatedUserThreadLocal.java:25)<br/>
	at com.atlassian.confluence.util.UserThreadLocalFilter.doFilter(UserThreadLocalFilter.java:36)<br/>
	at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.seraph.filter.SecurityFilter.doFilter(SecurityFilter.java:211)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.security.auth.trustedapps.filter.TrustedApplicationsFilter.doFilter(TrustedApplicationsFilter.java:98)<br/>
	at com.atlassian.confluence.util.AbstractBootstrapHotSwappingFilter.doFilter(AbstractBootstrapHotSwappingFilter.java:30)<br/>
	at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.seraph.filter.BaseLoginFilter.doFilter(BaseLoginFilter.java:150)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:46)<br/>
	at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter$1.doFilter(DelegatingPluginFilter.java:66)<br/>
	at com.atlassian.oauth.serviceprovider.internal.servlet.OAuthFilter.doFilter(OAuthFilter.java:71)<br/>
	at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter.doFilter(DelegatingPluginFilter.java:74)<br/>
	at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:42)<br/>
	at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:77)<br/>
	at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:63)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.confluence.util.ClusterHeaderFilter.doFilter(ClusterHeaderFilter.java:37)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.johnson.filters.AbstractJohnsonFilter.doFilter(AbstractJohnsonFilter.java:72)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at org.springframework.orm.hibernate.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:170)<br/>
	at com.atlassian.spring.filter.FlushingSpringSessionInViewFilter.doFilterInternal(FlushingSpringSessionInViewFilter.java:29)<br/>
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.confluence.util.ConfluenceErrorFilter.doFilter(ConfluenceErrorFilter.java:22)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.util.profiling.filters.ProfilingFilter.doFilter(ProfilingFilter.java:99)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.confluence.core.datetime.RequestTimeThreadLocalFilter.doFilter(RequestTimeThreadLocalFilter.java:35)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.gzipfilter.GzipFilter.doFilterInternal(GzipFilter.java:80)<br/>
	at com.atlassian.gzipfilter.GzipFilter.doFilter(GzipFilter.java:51)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.core.filters.cache.AbstractCachingFilter.doFilter(AbstractCachingFilter.java:33)<br/>
	at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:46)<br/>
	at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter$1.doFilter(DelegatingPluginFilter.java:66)<br/>
	at com.atlassian.confluence.extra.webdav.servlet.filter.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:43)<br/>
	at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter.doFilter(DelegatingPluginFilter.java:74)<br/>
	at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:42)<br/>
	at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:77)<br/>
	at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:63)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.confluence.web.filter.validateparam.RequestParamValidationFilter.doFilter(RequestParamValidationFilter.java:58)<br/>
	at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.confluence.web.filter.TranslationModeFilter.doFilter(TranslationModeFilter.java:43)<br/>
	at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.confluence.plugin.servlet.filter.ActionContextCleanUp.doFilter(ActionContextCleanUp.java:71)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.confluence.web.filter.LanguageExtractionFilter.doFilter(LanguageExtractionFilter.java:54)<br/>
	at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.confluence.util.RequestCacheThreadLocalFilter.doFilter(RequestCacheThreadLocalFilter.java:25)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.core.filters.encoding.AbstractEncodingFilter.doFilter(AbstractEncodingFilter.java:41)<br/>
	at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.core.filters.HeaderSanitisingFilter.doFilter(HeaderSanitisingFilter.java:44)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at com.atlassian.confluence.servlet.FourOhFourErrorLoggingFilter.doFilter(FourOhFourErrorLoggingFilter.java:65)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)<br/>
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)<br/>
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)<br/>
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)<br/>
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)<br/>
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:291)<br/>
	at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:190)<br/>
	at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:291)<br/>
	at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:776)<br/>
	at org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:705)<br/>
	at org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.java:898)<br/>
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:690)<br/>
	at java.lang.Thread.run(Thread.java:662)</p>


<p>Referer URL</p>

<p><a href="https://wiki-dev.doit.wisc.edu/confluence/login.action">https://wiki-dev.doit.wisc.edu/confluence/login.action</a></p>
 </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54801_concise" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54801_concise subText'><span class='date user-tz' title='05/Feb/12 4:08 AM'><time datetime='2012-02-05T04:08-0800'>05/Feb/12 4:08 AM</time></span></span>               Note: The NullPointerException is what happens when I try the Shib login. When I try the local user login I get the following stack trace (i.e. looks like the same issue as <a href="/browse/SHBL-53" title="local user login throws an exception in 4.1"><del>SHBL-53</del></a>).

====================
Cause

java.lang.ClassCastException: com.atlassian.confluence.user.SessionSafePrincipal cannot be cast to com.atlassian.user.User
    at com.atlassian.confluence.user.AuthenticatedUserThreadLocal.getUser(AuthenticatedUserThreadLocal.java:25)

Stack Trace:<a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/hide">hide</a>

java.lang.ClassCastException: com.atlassian.confluence.user.SessionSafePrincipal cannot be cast to com.atlassian.user.User
	at com.atlassian.confluence.user.AuthenticatedUserThreadLocal.getUser(AuthenticatedUserThreadLocal.java:25)
	at com.atlassian.confluence.util.UserThreadLocalFilter.doFilter(UserThreadLocalFilter.java:36)
	at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.atlassian.seraph.filter.SecurityFilter.doFilter(SecurityFilter.java:211)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.atlassian.security.auth.trustedapps.filter.TrustedApplicationsFilter.doFilter(TrustedApplicationsFilter.java:98)
	at com.atlassian.confluence.util.AbstractBootstrapHotSwappingFilter.doFilter(AbstractBootstrapHotSwappingFilter.java:30)
	at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.atlassian.seraph.filter.BaseLoginFilter.doFilter(BaseLoginFilter.java:150)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:46)
	at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter$1.doFilter(DelegatingPluginFilter.java:66)
	at com.atlassian.oauth.serviceprovider.internal.servlet.OAuthFilter.doFilter(OAuthFilter.java:71)
	at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter.doFilter(DelegatingPluginFilter.java:74)
	at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:42)
	at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:77)
	at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:63)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.atlassian.confluence.util.ClusterHeaderFilter.doFilter(ClusterHeaderFilter.java:37)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.atlassian.johnson.filters.AbstractJohnsonFilter.doFilter(AbstractJohnsonFilter.java:72)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at org.springframework.orm.hibernate.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:170)
	at com.atlassian.spring.filter.FlushingSpringSessionInViewFilter.doFilterInternal(FlushingSpringSessionInViewFilter.java:29)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.atlassian.confluence.util.ConfluenceErrorFilter.doFilter(ConfluenceErrorFilter.java:22)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.atlassian.util.profiling.filters.ProfilingFilter.doFilter(ProfilingFilter.java:99)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.atlassian.confluence.core.datetime.RequestTimeThreadLocalFilter.doFilter(RequestTimeThreadLocalFilter.java:35)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.atlassian.gzipfilter.GzipFilter.doFilterInternal(GzipFilter.java:80)
	at com.atlassian.gzipfilter.GzipFilter.doFilter(GzipFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.atlassian.core.filters.cache.AbstractCachingFilter.doFilter(AbstractCachingFilter.java:33)
	at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:46)
	at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter$1.doFilter(DelegatingPluginFilter.java:66)
	at com.atlassian.confluence.extra.webdav.servlet.filter.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:43)
	at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter.doFilter(DelegatingPluginFilter.java:74)
	at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:42)
	at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:77)
	at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:63)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.atlassian.confluence.web.filter.validateparam.RequestParamValidationFilter.doFilter(RequestParamValidationFilter.java:58)
	at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.atlassian.confluence.web.filter.TranslationModeFilter.doFilter(TranslationModeFilter.java:43)
	at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.atlassian.confluence.plugin.servlet.filter.ActionContextCleanUp.doFilter(ActionContextCleanUp.java:71)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.atlassian.confluence.web.filter.LanguageExtractionFilter.doFilter(LanguageExtractionFilter.java:54)
	at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.atlassian.confluence.util.RequestCacheThreadLocalFilter.doFilter(RequestCacheThreadLocalFilter.java:25)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.atlassian.core.filters.encoding.AbstractEncodingFilter.doFilter(AbstractEncodingFilter.java:41)
	at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.atlassian.core.filters.HeaderSanitisingFilter.doFilter(HeaderSanitisingFilter.java:44)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.atlassian.confluence.servlet.FourOhFourErrorLoggingFilter.doFilter(FourOhFourErrorLoggingFilter.java:65)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:291)
	at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:190)
	at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:291)
	at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:776)
	at org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:705)
	at org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.java:898)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:690)
	at java.lang.Thread.run(Thread.java:662)


Referer URL

<a href="https://wiki-dev.doit.wisc.edu/confluence/login.action">https://wiki-dev.doit.wisc.edu/confluence/login.action</a>
         </div>
    </div>
</div>
                     <div id="comment-54809" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54809&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54809" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
                                            
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54809_verbose" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54809_verbose subText'><span class='date user-tz' title='05/Feb/12 11:30 AM'><time datetime='2012-02-05T11:30-0800'>05/Feb/12 11:30 AM</time></span></span>   - <span class="redText subText" title="John Hare - 06/Feb/12 1:27 PM">edited</span> </div>
        <div class="action-body flooded"><p>Note: the NullPointerError on line 289 of RemoteUserAuthenticator.java appears to be because a few lines earlier the variable p is hardcoded to null (i.e. Pager p = null) and the next reference to p is when it's being used in the loop.</p>


<p>With respect to the other problem the following debug output might be helpfull:<br/>
2012-02-05 13:23:36,188 ERROR <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor1">TP-Processor1</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> login Got the following error attempting to get existing user from session.<br/>
java.lang.NullPointerException<br/>
        at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.login(RemoteUserAuthenticator.java:708)<br/>
        at com.atlassian.seraph.filter.PasswordBasedLoginFilter.runAuthentication(PasswordBasedLoginFilter.java:127)<br/>
        at com.atlassian.seraph.filter.PasswordBasedLoginFilter.login(PasswordBasedLoginFilter.java:72)<br/>
        at com.atlassian.seraph.filter.BaseLoginFilter.doFilter(BaseLoginFilter.java:130)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:46)<br/>
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter$1.doFilter(DelegatingPluginFilter.java:66)<br/>
        at com.atlassian.oauth.serviceprovider.internal.servlet.OAuthFilter.doFilter(OAuthFilter.java:71)<br/>
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter.doFilter(DelegatingPluginFilter.java:74)<br/>
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:42)<br/>
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:77)<br/>
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:63)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.util.ClusterHeaderFilter.doFilter(ClusterHeaderFilter.java:37)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.johnson.filters.AbstractJohnsonFilter.doFilter(AbstractJohnsonFilter.java:72)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at org.springframework.orm.hibernate.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:170)<br/>
        at com.atlassian.spring.filter.FlushingSpringSessionInViewFilter.doFilterInternal(FlushingSpringSessionInViewFilter.java:29)<br/>
        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.util.ConfluenceErrorFilter.doFilter(ConfluenceErrorFilter.java:22)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.util.profiling.filters.ProfilingFilter.doFilter(ProfilingFilter.java:99)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.core.datetime.RequestTimeThreadLocalFilter.doFilter(RequestTimeThreadLocalFilter.java:35)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.gzipfilter.GzipFilter.doFilterInternal(GzipFilter.java:80)<br/>
        at com.atlassian.gzipfilter.GzipFilter.doFilter(GzipFilter.java:51)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.core.filters.cache.AbstractCachingFilter.doFilter(AbstractCachingFilter.java:33)<br/>
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:46)<br/>
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter$1.doFilter(DelegatingPluginFilter.java:66)<br/>
        at com.atlassian.confluence.extra.webdav.servlet.filter.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:43)<br/>
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter.doFilter(DelegatingPluginFilter.java:74)<br/>
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:42)<br/>
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:77)<br/>
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:63)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.web.filter.validateparam.RequestParamValidationFilter.doFilter(RequestParamValidationFilter.java:58)<br/>
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.web.filter.TranslationModeFilter.doFilter(TranslationModeFilter.java:43)<br/>
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.plugin.servlet.filter.ActionContextCleanUp.doFilter(ActionContextCleanUp.java:71)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.web.filter.LanguageExtractionFilter.doFilter(LanguageExtractionFilter.java:54)<br/>
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.util.RequestCacheThreadLocalFilter.doFilter(RequestCacheThreadLocalFilter.java:25)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.core.filters.encoding.AbstractEncodingFilter.doFilter(AbstractEncodingFilter.java:41)<br/>
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.core.filters.HeaderSanitisingFilter.doFilter(HeaderSanitisingFilter.java:44)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.servlet.FourOhFourErrorLoggingFilter.doFilter(FourOhFourErrorLoggingFilter.java:65)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)<br/>
        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)<br/>
        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)<br/>
        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)<br/>
        at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:555)<br/>
        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)<br/>
        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)<br/>
        at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:190)<br/>
        at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:291)<br/>
        at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:769)<br/>
        at org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:698)<br/>
        at org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.java:891)<br/>
        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:690)<br/>
        at java.lang.Thread.run(Thread.java:662)<br/>
2012-02-05 13:23:36,191 ERROR <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor1">TP-Processor1</a> [<a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/Catalina">Catalina</a>.<a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/localhost">localhost</a>.<a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/%2Fconfluence">/confluence</a>.<a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/action">action</a>] log Servlet.service() for servlet action threw exception<br/>
java.lang.NullPointerException<br/>
        at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.login(RemoteUserAuthenticator.java:726)<br/>
        at com.atlassian.seraph.filter.PasswordBasedLoginFilter.runAuthentication(PasswordBasedLoginFilter.java:127)<br/>
        at com.atlassian.seraph.filter.PasswordBasedLoginFilter.login(PasswordBasedLoginFilter.java:72)<br/>
        at com.atlassian.seraph.filter.BaseLoginFilter.doFilter(BaseLoginFilter.java:130)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:46)<br/>
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter$1.doFilter(DelegatingPluginFilter.java:66)<br/>
        at com.atlassian.oauth.serviceprovider.internal.servlet.OAuthFilter.doFilter(OAuthFilter.java:71)<br/>
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter.doFilter(DelegatingPluginFilter.java:74)<br/>
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:42)<br/>
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:77)<br/>
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:63)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.util.ClusterHeaderFilter.doFilter(ClusterHeaderFilter.java:37)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.johnson.filters.AbstractJohnsonFilter.doFilter(AbstractJohnsonFilter.java:72)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at org.springframework.orm.hibernate.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:170)<br/>
        at com.atlassian.spring.filter.FlushingSpringSessionInViewFilter.doFilterInternal(FlushingSpringSessionInViewFilter.java:29)<br/>
        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.util.ConfluenceErrorFilter.doFilter(ConfluenceErrorFilter.java:22)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.util.profiling.filters.ProfilingFilter.doFilter(ProfilingFilter.java:99)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.core.datetime.RequestTimeThreadLocalFilter.doFilter(RequestTimeThreadLocalFilter.java:35)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.gzipfilter.GzipFilter.doFilterInternal(GzipFilter.java:80)<br/>
        at com.atlassian.gzipfilter.GzipFilter.doFilter(GzipFilter.java:51)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.core.filters.cache.AbstractCachingFilter.doFilter(AbstractCachingFilter.java:33)<br/>
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:46)<br/>
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter$1.doFilter(DelegatingPluginFilter.java:66)<br/>
        at com.atlassian.confluence.extra.webdav.servlet.filter.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:43)<br/>
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter.doFilter(DelegatingPluginFilter.java:74)<br/>
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:42)<br/>
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:77)<br/>
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:63)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.web.filter.validateparam.RequestParamValidationFilter.doFilter(RequestParamValidationFilter.java:58)<br/>
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.web.filter.TranslationModeFilter.doFilter(TranslationModeFilter.java:43)<br/>
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.plugin.servlet.filter.ActionContextCleanUp.doFilter(ActionContextCleanUp.java:71)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.web.filter.LanguageExtractionFilter.doFilter(LanguageExtractionFilter.java:54)<br/>
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.util.RequestCacheThreadLocalFilter.doFilter(RequestCacheThreadLocalFilter.java:25)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.core.filters.encoding.AbstractEncodingFilter.doFilter(AbstractEncodingFilter.java:41)<br/>
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.core.filters.HeaderSanitisingFilter.doFilter(HeaderSanitisingFilter.java:44)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.servlet.FourOhFourErrorLoggingFilter.doFilter(FourOhFourErrorLoggingFilter.java:65)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)<br/>
        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)<br/>
        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)<br/>
        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)<br/>
        at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:555)<br/>
        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)<br/>
        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)<br/>
        at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:190)<br/>
        at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:291)<br/>
        at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:769)<br/>
        at org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:698)<br/>
        at org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.java:891)<br/>
        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:690)<br/>
        at java.lang.Thread.run(Thread.java:662)<br/>
2012-02-05 13:23:36,193 INFO <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor1">TP-Processor1</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/atlassian.confluence.status.SystemErrorInformationLogger">atlassian.confluence.status.SystemErrorInformationLogger</a> writeToLog <br/>
Request Unique ID : c4b39141-ff59-454a-9459-c9a140e8ba6c<br/>
--------------------------<br/>
JVM Stats<br/>
--------------------------<br/>
allocatedHeap = 464986112<br/>
availablePermGen = 308098472<br/>
usedMemory = 287773776<br/>
totalMemory = 464986112<br/>
freeMemory = 177212336<br/>
maxPermGen = 402653184<br/>
usedPermGen = 94554712<br/>
freeMemoryInMegabytes = 169<br/>
freeAllocatedHeap = 177212336<br/>
availableHeap = 1009707952<br/>
usedMemoryInMegabytes = 274<br/>
maxHeap = 1297481728<br/>
usedHeap = 287773776<br/>
totalMemoryInMegabytes = 443<br/>
--------------------------<br/>
Request Information<br/>
--------------------------<br/>
URL: <a href="https://wiki-test.doit.wisc.edu/confluence/500page.jsp">https://wiki-test.doit.wisc.edu/confluence/500page.jsp</a><br/>
Scheme: https<br/>
Server: wiki-test.doit.wisc.edu<br/>
Port: 443<br/>
URI: /confluence/500page.jsp<br/>
Context Path: /confluence<br/>
Servlet Path: /500page.jsp<br/>
Path Info: null<br/>
Query String: null<br/>
--------------------------<br/>
Attributes<br/>
--------------------------<br/>
javax.servlet.forward.request_uri: /confluence/dologin.action<br/>
javax.servlet.forward.context_path: /confluence<br/>
javax.servlet.forward.servlet_path: /dologin.action<br/>
javax.servlet.forward.path_info: /500page.jsp<br/>
javax.servlet.error.status_code: 500<br/>
javax.servlet.error.servlet_name: action<br/>
com.atlassian.gzipfilter.GzipFilter_already_filtered: true<br/>
loginfilter.already.filtered: true<br/>
com.atlassian.confluence.web.ConfluenceJohnsonFilter_already_filtered: true<br/>
Confluence-Request-Time: 1328469816178<br/>
javax.servlet.error.message: <br/>
com.atlassian.core.filters.HeaderSanitisingFilter_already_filtered: true<br/>
__cleanup_recursion_counter: 0<br/>
com.atlassian.confluence.web.filter.validateparam.RequestParamValidationFilter_already_filtered: true<br/>
javax.servlet.error.exception: java.lang.NullPointerException<br/>
javax.servlet.error.request_uri: /confluence/dologin.action<br/>
--------------------------<br/>
Parameters<br/>
--------------------------<br/>
os_destination : <br/>
os_username : xxxx@gmail.com<br/>
login : Log In<br/>
caused by: java.lang.NullPointerException<br/>
at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.login(RemoteUserAuthenticator.java:726)</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
                                            
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54809_concise" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54809_concise subText'><span class='date user-tz' title='05/Feb/12 11:30 AM'><time datetime='2012-02-05T11:30-0800'>05/Feb/12 11:30 AM</time></span></span>   - <span class="redText subText" title="John Hare - 06/Feb/12 1:27 PM">edited</span>              Note: the NullPointerError on line 289 of RemoteUserAuthenticator.java appears to be because a few lines earlier the variable p is hardcoded to null (i.e. Pager p = null) and the next reference to p is when it's being used in the loop.


With respect to the other problem the following debug output might be helpfull:
2012-02-05 13:23:36,188 ERROR <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor1">TP-Processor1</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> login Got the following error attempting to get existing user from session.
java.lang.NullPointerException
        at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.login(RemoteUserAuthenticator.java:708)
        at com.atlassian.seraph.filter.PasswordBasedLoginFilter.runAuthentication(PasswordBasedLoginFilter.java:127)
        at com.atlassian.seraph.filter.PasswordBasedLoginFilter.login(PasswordBasedLoginFilter.java:72)
        at com.atlassian.seraph.filter.BaseLoginFilter.doFilter(BaseLoginFilter.java:130)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:46)
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter$1.doFilter(DelegatingPluginFilter.java:66)
        at com.atlassian.oauth.serviceprovider.internal.servlet.OAuthFilter.doFilter(OAuthFilter.java:71)
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter.doFilter(DelegatingPluginFilter.java:74)
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:42)
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:77)
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:63)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.util.ClusterHeaderFilter.doFilter(ClusterHeaderFilter.java:37)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.johnson.filters.AbstractJohnsonFilter.doFilter(AbstractJohnsonFilter.java:72)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at org.springframework.orm.hibernate.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:170)
        at com.atlassian.spring.filter.FlushingSpringSessionInViewFilter.doFilterInternal(FlushingSpringSessionInViewFilter.java:29)
        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.util.ConfluenceErrorFilter.doFilter(ConfluenceErrorFilter.java:22)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.util.profiling.filters.ProfilingFilter.doFilter(ProfilingFilter.java:99)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.core.datetime.RequestTimeThreadLocalFilter.doFilter(RequestTimeThreadLocalFilter.java:35)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.gzipfilter.GzipFilter.doFilterInternal(GzipFilter.java:80)
        at com.atlassian.gzipfilter.GzipFilter.doFilter(GzipFilter.java:51)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.core.filters.cache.AbstractCachingFilter.doFilter(AbstractCachingFilter.java:33)
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:46)
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter$1.doFilter(DelegatingPluginFilter.java:66)
        at com.atlassian.confluence.extra.webdav.servlet.filter.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:43)
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter.doFilter(DelegatingPluginFilter.java:74)
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:42)
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:77)
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:63)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.web.filter.validateparam.RequestParamValidationFilter.doFilter(RequestParamValidationFilter.java:58)
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.web.filter.TranslationModeFilter.doFilter(TranslationModeFilter.java:43)
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.plugin.servlet.filter.ActionContextCleanUp.doFilter(ActionContextCleanUp.java:71)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.web.filter.LanguageExtractionFilter.doFilter(LanguageExtractionFilter.java:54)
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.util.RequestCacheThreadLocalFilter.doFilter(RequestCacheThreadLocalFilter.java:25)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.core.filters.encoding.AbstractEncodingFilter.doFilter(AbstractEncodingFilter.java:41)
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.core.filters.HeaderSanitisingFilter.doFilter(HeaderSanitisingFilter.java:44)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.servlet.FourOhFourErrorLoggingFilter.doFilter(FourOhFourErrorLoggingFilter.java:65)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)
        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)
        at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:555)
        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)
        at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:190)
        at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:291)
        at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:769)
        at org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:698)
        at org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.java:891)
        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:690)
        at java.lang.Thread.run(Thread.java:662)
2012-02-05 13:23:36,191 ERROR <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor1">TP-Processor1</a> [<a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/Catalina">Catalina</a>.<a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/localhost">localhost</a>.<a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/%2Fconfluence">/confluence</a>.<a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/action">action</a>] log Servlet.service() for servlet action threw exception
java.lang.NullPointerException
        at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.login(RemoteUserAuthenticator.java:726)
        at com.atlassian.seraph.filter.PasswordBasedLoginFilter.runAuthentication(PasswordBasedLoginFilter.java:127)
        at com.atlassian.seraph.filter.PasswordBasedLoginFilter.login(PasswordBasedLoginFilter.java:72)
        at com.atlassian.seraph.filter.BaseLoginFilter.doFilter(BaseLoginFilter.java:130)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:46)
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter$1.doFilter(DelegatingPluginFilter.java:66)
        at com.atlassian.oauth.serviceprovider.internal.servlet.OAuthFilter.doFilter(OAuthFilter.java:71)
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter.doFilter(DelegatingPluginFilter.java:74)
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:42)
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:77)
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:63)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.util.ClusterHeaderFilter.doFilter(ClusterHeaderFilter.java:37)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.johnson.filters.AbstractJohnsonFilter.doFilter(AbstractJohnsonFilter.java:72)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at org.springframework.orm.hibernate.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:170)
        at com.atlassian.spring.filter.FlushingSpringSessionInViewFilter.doFilterInternal(FlushingSpringSessionInViewFilter.java:29)
        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.util.ConfluenceErrorFilter.doFilter(ConfluenceErrorFilter.java:22)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.util.profiling.filters.ProfilingFilter.doFilter(ProfilingFilter.java:99)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.core.datetime.RequestTimeThreadLocalFilter.doFilter(RequestTimeThreadLocalFilter.java:35)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.gzipfilter.GzipFilter.doFilterInternal(GzipFilter.java:80)
        at com.atlassian.gzipfilter.GzipFilter.doFilter(GzipFilter.java:51)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.core.filters.cache.AbstractCachingFilter.doFilter(AbstractCachingFilter.java:33)
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:46)
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter$1.doFilter(DelegatingPluginFilter.java:66)
        at com.atlassian.confluence.extra.webdav.servlet.filter.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:43)
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter.doFilter(DelegatingPluginFilter.java:74)
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:42)
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:77)
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:63)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.web.filter.validateparam.RequestParamValidationFilter.doFilter(RequestParamValidationFilter.java:58)
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.web.filter.TranslationModeFilter.doFilter(TranslationModeFilter.java:43)
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.plugin.servlet.filter.ActionContextCleanUp.doFilter(ActionContextCleanUp.java:71)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.web.filter.LanguageExtractionFilter.doFilter(LanguageExtractionFilter.java:54)
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.util.RequestCacheThreadLocalFilter.doFilter(RequestCacheThreadLocalFilter.java:25)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.core.filters.encoding.AbstractEncodingFilter.doFilter(AbstractEncodingFilter.java:41)
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.core.filters.HeaderSanitisingFilter.doFilter(HeaderSanitisingFilter.java:44)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.servlet.FourOhFourErrorLoggingFilter.doFilter(FourOhFourErrorLoggingFilter.java:65)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)
        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)
        at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:555)
        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)
        at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:190)
        at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:291)
        at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:769)
        at org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:698)
        at org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.java:891)
        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:690)
        at java.lang.Thread.run(Thread.java:662)
2012-02-05 13:23:36,193 INFO <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor1">TP-Processor1</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/atlassian.confluence.status.SystemErrorInformationLogger">atlassian.confluence.status.SystemErrorInformationLogger</a> writeToLog 
Request Unique ID : c4b39141-ff59-454a-9459-c9a140e8ba6c
--------------------------
JVM Stats
--------------------------
allocatedHeap = 464986112
availablePermGen = 308098472
usedMemory = 287773776
totalMemory = 464986112
freeMemory = 177212336
maxPermGen = 402653184
usedPermGen = 94554712
freeMemoryInMegabytes = 169
freeAllocatedHeap = 177212336
availableHeap = 1009707952
usedMemoryInMegabytes = 274
maxHeap = 1297481728
usedHeap = 287773776
totalMemoryInMegabytes = 443
--------------------------
Request Information
--------------------------
URL: <a href="https://wiki-test.doit.wisc.edu/confluence/500page.jsp">https://wiki-test.doit.wisc.edu/confluence/500page.jsp</a>
Scheme: https
Server: wiki-test.doit.wisc.edu
Port: 443
URI: /confluence/500page.jsp
Context Path: /confluence
Servlet Path: /500page.jsp
Path Info: null
Query String: null
--------------------------
Attributes
--------------------------
javax.servlet.forward.request_uri: /confluence/dologin.action
javax.servlet.forward.context_path: /confluence
javax.servlet.forward.servlet_path: /dologin.action
javax.servlet.forward.path_info: /500page.jsp
javax.servlet.error.status_code: 500
javax.servlet.error.servlet_name: action
com.atlassian.gzipfilter.GzipFilter_already_filtered: true
loginfilter.already.filtered: true
com.atlassian.confluence.web.ConfluenceJohnsonFilter_already_filtered: true
Confluence-Request-Time: 1328469816178
javax.servlet.error.message: 
com.atlassian.core.filters.HeaderSanitisingFilter_already_filtered: true
__cleanup_recursion_counter: 0
com.atlassian.confluence.web.filter.validateparam.RequestParamValidationFilter_already_filtered: true
javax.servlet.error.exception: java.lang.NullPointerException
javax.servlet.error.request_uri: /confluence/dologin.action
--------------------------
Parameters
--------------------------
os_destination : 
os_username : xxxx@gmail.com
login : Log In
caused by: java.lang.NullPointerException
at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.login(RemoteUserAuthenticator.java:726)         </div>
    </div>
</div>
                     <div id="comment-54810" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54810&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54810" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54810_verbose" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54810_verbose subText'><span class='date user-tz' title='05/Feb/12 11:43 AM'><time datetime='2012-02-05T11:43-0800'>05/Feb/12 11:43 AM</time></span></span>  </div>
        <div class="action-body flooded"><p>2012-02-05 13:23:36,231 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor7">TP-Processor7</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/includes/css/setup.css">https://wiki-test.doit.wisc.edu/confluence/includes/css/setup.css</a> triggered this AuthN check.<br/>
2012-02-05 13:23:36,232 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor7">TP-Processor7</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> createSafeUserid Remote user is returned as is, mappers do not matched.<br/>
2012-02-05 13:23:36,233 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor7">TP-Processor7</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Remote user was null or empty, can not perform authentication.<br/>
2012-02-05 13:23:36,233 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor7">TP-Processor7</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/includes/css/setup.css">https://wiki-test.doit.wisc.edu/confluence/includes/css/setup.css</a> triggered this AuthN check.<br/>
2012-02-05 13:23:36,234 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor7">TP-Processor7</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> createSafeUserid Remote user is returned as is, mappers do not matched.<br/>
2012-02-05 13:23:36,235 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor7">TP-Processor7</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Remote user was null or empty, can not perform authentication.<br/>
2012-02-05 13:23:36,237 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor11">TP-Processor11</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/includes/js/cookieUtils.js">https://wiki-test.doit.wisc.edu/confluence/includes/js/cookieUtils.js</a> triggered this AuthN check.<br/>
2012-02-05 13:23:36,239 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor11">TP-Processor11</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> createSafeUserid Remote user is returned as is, mappers do not matched.<br/>
2012-02-05 13:23:36,240 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor11">TP-Processor11</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Remote user was null or empty, can not perform authentication.<br/>
2012-02-05 13:23:36,240 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor11">TP-Processor11</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/includes/js/cookieUtils.js">https://wiki-test.doit.wisc.edu/confluence/includes/js/cookieUtils.js</a> triggered this AuthN check.<br/>
2012-02-05 13:23:36,241 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor11">TP-Processor11</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> createSafeUserid Remote user is returned as is, mappers do not matched.<br/>
2012-02-05 13:23:36,242 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor11">TP-Processor11</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Remote user was null or empty, can not perform authentication.</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54810_concise" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54810_concise subText'><span class='date user-tz' title='05/Feb/12 11:43 AM'><time datetime='2012-02-05T11:43-0800'>05/Feb/12 11:43 AM</time></span></span>               2012-02-05 13:23:36,231 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor7">TP-Processor7</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/includes/css/setup.css">https://wiki-test.doit.wisc.edu/confluence/includes/css/setup.css</a> triggered this AuthN check.
2012-02-05 13:23:36,232 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor7">TP-Processor7</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> createSafeUserid Remote user is returned as is, mappers do not matched.
2012-02-05 13:23:36,233 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor7">TP-Processor7</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Remote user was null or empty, can not perform authentication.
2012-02-05 13:23:36,233 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor7">TP-Processor7</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/includes/css/setup.css">https://wiki-test.doit.wisc.edu/confluence/includes/css/setup.css</a> triggered this AuthN check.
2012-02-05 13:23:36,234 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor7">TP-Processor7</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> createSafeUserid Remote user is returned as is, mappers do not matched.
2012-02-05 13:23:36,235 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor7">TP-Processor7</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Remote user was null or empty, can not perform authentication.
2012-02-05 13:23:36,237 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor11">TP-Processor11</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/includes/js/cookieUtils.js">https://wiki-test.doit.wisc.edu/confluence/includes/js/cookieUtils.js</a> triggered this AuthN check.
2012-02-05 13:23:36,239 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor11">TP-Processor11</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> createSafeUserid Remote user is returned as is, mappers do not matched.
2012-02-05 13:23:36,240 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor11">TP-Processor11</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Remote user was null or empty, can not perform authentication.
2012-02-05 13:23:36,240 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor11">TP-Processor11</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/includes/js/cookieUtils.js">https://wiki-test.doit.wisc.edu/confluence/includes/js/cookieUtils.js</a> triggered this AuthN check.
2012-02-05 13:23:36,241 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor11">TP-Processor11</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> createSafeUserid Remote user is returned as is, mappers do not matched.
2012-02-05 13:23:36,242 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor11">TP-Processor11</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Remote user was null or empty, can not perform authentication.         </div>
    </div>
</div>
                     <div id="comment-54812" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54812&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54812" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
                                            
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54812_verbose" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54812_verbose subText'><span class='date user-tz' title='05/Feb/12 2:14 PM'><time datetime='2012-02-05T14:14-0800'>05/Feb/12 2:14 PM</time></span></span>   - <span class="redText subText" title="John Hare - 06/Feb/12 1:22 PM">edited</span> </div>
        <div class="action-body flooded"><p>I've been adding debug statments to my custom version of the plugin to pinpoint where the failure is happening. I believe I have proof now that the bug is in the Atlassian codebase. It appears like it might be some theading issue related to the the CONFDEV-6043 fix which added the SessionSafePrinciple class into ConfluenceAuthenticator.java.</p>

<p>Here is the interesting part of my debug output:<br/>
 So, at timestamp 2012-02-05 15:14:41,240, the shib remote authenticator is basically done handing off the login to the local authenticator and the user is logged in at that point.</p>

<p>After that point there are a couple requests which get checked, the user is determined to be logged in and the authenticator returns as normal.</p>

<p>After the requst to homepage.action though, the log thread apears to crash when it tries to fetch the logged in user. This appears to be a bug in how the ThreadLocal storage is being handled in AuthenticatedUserThreadLocal.java:25 (just like the stack trace shows).</p>

<p>==============================================</p>

<p>So the following log line:</p>

<p>2012-02-05 15:14:41,242 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/atlassian.seraph.auth.DefaultAuthenticator">atlassian.seraph.auth.DefaultAuthenticator</a> authoriseUserAndEstablishSession authoriseUser : 'xxxx@gmail.com' can login according to the RoleMapper</p>

<p>Shows the thread of execution on line DefaultAuthenticator.java:201</p>


<p>The next interesting thing that happens is a call on line 214 to: <br/>
putPrincipalInSessionContext(httpServletRequest, principal);</p>



<p>Which if I'm not mistaken executes the protected method define on line DefaultAuthenticator.java:243.</p>

<p>protected void putPrincipalInSessionContext(final HttpServletRequest httpServletRequest, final Principal principal)</p>
{ 
final HttpSession httpSession = httpServletRequest.getSession(); httpSession.setAttribute(LOGGED_IN_KEY, principal); httpSession.setAttribute(LOGGED_OUT_KEY, null); 
}




<p> Note however that the ConfluenceAuthenticator.java class also overrides this method on line 88:</p>

<p> // CONFDEV-6043. Users we get from the system may not be serializable, which makes it hard to put<br/>
 // one in the session. We can put a placeholder user in the session because every time Seraph gets it<br/>
 // out again, it passes it through refreshPrincipalObtainedFromSession() to turn it back into a live user<br/>
 // for the rest of the request.<br/>
 protected void putPrincipalInSessionContext(HttpServletRequest httpServletRequest, Principal principal)</p>
 { super.putPrincipalInSessionContext(httpServletRequest, principal == null ? null : new SessionSafePrincipal(principal)); }



<p>My theory is that the authorizeUserAndEstablishSession call is calling the method that doesn't use the SessionSafePrincipal wrapper class and the thread trying to dereference it later does try to cast it to the SessionSafePrincipal wrapper.</p>






<p>=====================<br/>
2012-02-05 15:14:40,961 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> login Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/dologin.action">https://wiki-test.doit.wisc.edu/confluence/dologin.action</a> triggered this AuthN check. (username=xxxx@gmail.com, remoteIP=128.104.19.219, remoteHost=128.104.19.219)<br/>
2012-02-05 15:14:40,962 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> login remoteIP=128.104.19.219 remoteHost=128.104.19.219<br/>
2012-02-05 15:14:40,963 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> login JH9: calling getUserFromSession: request=com.atlassian.seraph.filter.BaseLoginFilter$SecurityHttpRequestWrapper@142d6ab<br/>
2012-02-05 15:14:40,963 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/atlassian.seraph.auth.DefaultAuthenticator">atlassian.seraph.auth.DefaultAuthenticator</a> getUserFromSession getUserFromSession : Session found; BUT it has no Principal in it<br/>
2012-02-05 15:14:40,965 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> login JH9: returning from getUserFromSession: user=null<br/>
2012-02-05 15:14:40,965 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> login JH9: finally block: user=null<br/>
2012-02-05 15:14:40,966 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> login JH9: dereferencing null  user.getName()  didn't have a logged in key in session.<br/>
2012-02-05 15:14:40,967 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> createSafeUserid originalRemoteuser: null<br/>
2012-02-05 15:14:40,967 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> createSafeUserid Remote user is returned as is, mappers do not matched.<br/>
2012-02-05 15:14:40,968 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> login Remote user was null or empty, calling super.login() to perform local login.<br/>
2012-02-05 15:14:40,968 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> login Trying local login for user xxxx@gmail.com<br/>
2012-02-05 15:14:41,240 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/atlassian.seraph.auth.DefaultAuthenticator">atlassian.seraph.auth.DefaultAuthenticator</a> login login : 'xxxx@gmail.com' has been authenticated<br/>
2012-02-05 15:14:41,242 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/atlassian.seraph.auth.DefaultAuthenticator">atlassian.seraph.auth.DefaultAuthenticator</a> authoriseUserAndEstablishSession authoriseUser : 'xxxx@gmail.com' can login according to the RoleMapper<br/>
2012-02-05 15:14:41,339 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/">https://wiki-test.doit.wisc.edu/confluence/</a> triggered this AuthN check.<br/>
2012-02-05 15:14:41,340 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter xxxx@gmail.com already logged in, returning.<br/>
2012-02-05 15:14:41,341 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/">https://wiki-test.doit.wisc.edu/confluence/</a> triggered this AuthN check.<br/>
2012-02-05 15:14:41,341 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter xxxx@gmail.com already logged in, returning.<br/>
2012-02-05 15:14:43,304 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/homepage.action">https://wiki-test.doit.wisc.edu/confluence/homepage.action</a> triggered this AuthN check.<br/>
2012-02-05 15:14:43,305 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter xxxx@gmail.com already logged in, returning.<br/>
2012-02-05 15:14:43,306 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/homepage.action">https://wiki-test.doit.wisc.edu/confluence/homepage.action</a> triggered this AuthN check.<br/>
2012-02-05 15:14:43,307 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter xxxx@gmail.com already logged in, returning.<br/>
2012-02-05 15:14:43,312 ERROR <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> [<a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/Catalina">Catalina</a>.<a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/localhost">localhost</a>.<a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/%2Fconfluence">/confluence</a>.<a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/action">action</a>] log Servlet.service() for servlet action threw exception<br/>
java.lang.ClassCastException: com.atlassian.confluence.user.SessionSafePrincipal cannot be cast to com.atlassian.user.User<br/>
        at com.atlassian.confluence.user.AuthenticatedUserThreadLocal.getUser(AuthenticatedUserThreadLocal.java:25)<br/>
        at com.atlassian.confluence.util.UserThreadLocalFilter.doFilter(UserThreadLocalFilter.java:36)<br/>
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.seraph.filter.SecurityFilter.doFilter(SecurityFilter.java:211)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.security.auth.trustedapps.filter.TrustedApplicationsFilter.doFilter(TrustedApplicationsFilter.java:98)<br/>
        at com.atlassian.confluence.util.AbstractBootstrapHotSwappingFilter.doFilter(AbstractBootstrapHotSwappingFilter.java:30)<br/>
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.seraph.filter.BaseLoginFilter.doFilter(BaseLoginFilter.java:150)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:46)<br/>
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter$1.doFilter(DelegatingPluginFilter.java:66)<br/>
        at com.atlassian.oauth.serviceprovider.internal.servlet.OAuthFilter.doFilter(OAuthFilter.java:71)<br/>
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter.doFilter(DelegatingPluginFilter.java:74)<br/>
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:42)<br/>
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:77)<br/>
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:63)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.util.ClusterHeaderFilter.doFilter(ClusterHeaderFilter.java:37)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.johnson.filters.AbstractJohnsonFilter.doFilter(AbstractJohnsonFilter.java:72)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at org.springframework.orm.hibernate.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:170)<br/>
        at com.atlassian.spring.filter.FlushingSpringSessionInViewFilter.doFilterInternal(FlushingSpringSessionInViewFilter.java:29)<br/>
        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.util.ConfluenceErrorFilter.doFilter(ConfluenceErrorFilter.java:22)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.util.profiling.filters.ProfilingFilter.doFilter(ProfilingFilter.java:99)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.core.datetime.RequestTimeThreadLocalFilter.doFilter(RequestTimeThreadLocalFilter.java:35)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.gzipfilter.GzipFilter.doFilterInternal(GzipFilter.java:80)<br/>
        at com.atlassian.gzipfilter.GzipFilter.doFilter(GzipFilter.java:51)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.core.filters.cache.AbstractCachingFilter.doFilter(AbstractCachingFilter.java:33)<br/>
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:46)<br/>
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter$1.doFilter(DelegatingPluginFilter.java:66)<br/>
        at com.atlassian.confluence.extra.webdav.servlet.filter.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:43)<br/>
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter.doFilter(DelegatingPluginFilter.java:74)<br/>
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:42)<br/>
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:77)<br/>
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:63)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.web.filter.validateparam.RequestParamValidationFilter.doFilter(RequestParamValidationFilter.java:58)<br/>
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.web.filter.TranslationModeFilter.doFilter(TranslationModeFilter.java:43)<br/>
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.plugin.servlet.filter.ActionContextCleanUp.doFilter(ActionContextCleanUp.java:71)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.web.filter.LanguageExtractionFilter.doFilter(LanguageExtractionFilter.java:54)<br/>
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.util.RequestCacheThreadLocalFilter.doFilter(RequestCacheThreadLocalFilter.java:25)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.core.filters.encoding.AbstractEncodingFilter.doFilter(AbstractEncodingFilter.java:41)<br/>
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.core.filters.HeaderSanitisingFilter.doFilter(HeaderSanitisingFilter.java:44)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at com.atlassian.confluence.servlet.FourOhFourErrorLoggingFilter.doFilter(FourOhFourErrorLoggingFilter.java:65)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)<br/>
        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)<br/>
        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)<br/>
        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)<br/>
        at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:555)<br/>
        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)<br/>
        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)<br/>
        at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:190)<br/>
        at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:291)<br/>
        at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:769)<br/>
        at org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:698)<br/>
        at org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.java:891)<br/>
        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:690)<br/>
        at java.lang.Thread.run(Thread.java:662)<br/>
2012-02-05 15:14:43,715 INFO <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/atlassian.confluence.status.SystemErrorInformationLogger">atlassian.confluence.status.SystemErrorInformationLogger</a> writeToLog <br/>
Request Unique ID : a7bd468b-a8a7-4bc7-9d60-edd6f12d8d37<br/>
--------------------------<br/>
JVM Stats<br/>
--------------------------<br/>
allocatedHeap = 436084736<br/>
availablePermGen = 308884272<br/>
usedMemory = 233046096<br/>
totalMemory = 436084736<br/>
freeMemory = 203038640<br/>
maxPermGen = 402653184<br/>
usedPermGen = 93768912<br/>
freeMemoryInMegabytes = 193<br/>
freeAllocatedHeap = 203038640<br/>
availableHeap = 1064435632<br/>
usedMemoryInMegabytes = 222<br/>
maxHeap = 1297481728<br/>
usedHeap = 233046096<br/>
totalMemoryInMegabytes = 415<br/>
--------------------------<br/>
Request Information<br/>
--------------------------<br/>
URL: <a href="https://wiki-test.doit.wisc.edu/confluence/500page.jsp">https://wiki-test.doit.wisc.edu/confluence/500page.jsp</a><br/>
Scheme: https<br/>
Server: wiki-test.doit.wisc.edu<br/>
Port: 443<br/>
URI: /confluence/500page.jsp<br/>
Context Path: /confluence<br/>
Servlet Path: /500page.jsp<br/>
Path Info: null<br/>
Query String: null<br/>
--------------------------<br/>
Attributes<br/>
--------------------------<br/>
javax.servlet.forward.request_uri: /confluence/homepage.action<br/>
javax.servlet.forward.context_path: /confluence<br/>
javax.servlet.forward.servlet_path: /homepage.action<br/>
javax.servlet.forward.path_info: /500page.jsp<br/>
os_securityfilter_already_filtered: true<br/>
atlassian.core.seraph.original.url: /homepage.action<br/>
javax.servlet.error.status_code: 500<br/>
javax.servlet.error.servlet_name: action<br/>
com.atlassian.gzipfilter.GzipFilter_already_filtered: true<br/>
loginfilter.already.filtered: true<br/>
Confluence-Request-Time: 1328476483304<br/>
com.atlassian.confluence.web.ConfluenceJohnsonFilter_already_filtered: true<br/>
javax.servlet.error.message: <br/>
com.atlassian.core.filters.HeaderSanitisingFilter_already_filtered: true<br/>
__cleanup_recursion_counter: 0<br/>
com.atlassian.confluence.web.filter.validateparam.RequestParamValidationFilter_already_filtered: true<br/>
javax.servlet.error.exception: java.lang.ClassCastException: com.atlassian.confluence.user.SessionSafePrincipal cannot be cast to com.atlassian.user.User<br/>
javax.servlet.error.request_uri: /confluence/homepage.action<br/>
--------------------------<br/>
Parameters<br/>
--------------------------<br/>
caused by: java.lang.ClassCastException: com.atlassian.confluence.user.SessionSafePrincipal cannot be cast to com.atlassian.user.User<br/>
at com.atlassian.confluence.user.AuthenticatedUserThreadLocal.getUser(AuthenticatedUserThreadLocal.java:25)</p>

<p>2012-02-05 15:14:43,755 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor3">TP-Processor3</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/includes/css/setup.css">https://wiki-test.doit.wisc.edu/confluence/includes/css/setup.css</a> triggered this AuthN check.<br/>
2012-02-05 15:14:43,755 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor3">TP-Processor3</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter xxxx@gmail.com already logged in, returning.<br/>
2012-02-05 15:14:43,756 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor3">TP-Processor3</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/includes/css/setup.css">https://wiki-test.doit.wisc.edu/confluence/includes/css/setup.css</a> triggered this AuthN check.<br/>
2012-02-05 15:14:43,757 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor3">TP-Processor3</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter xxxx@gmail.com already logged in, returning.<br/>
2012-02-05 15:14:43,763 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor6">TP-Processor6</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/includes/js/cookieUtils.js">https://wiki-test.doit.wisc.edu/confluence/includes/js/cookieUtils.js</a> triggered this AuthN check.<br/>
2012-02-05 15:14:43,764 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor6">TP-Processor6</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter xxxx@gmail.com already logged in, returning.<br/>
2012-02-05 15:14:43,765 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor6">TP-Processor6</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/includes/js/cookieUtils.js">https://wiki-test.doit.wisc.edu/confluence/includes/js/cookieUtils.js</a> triggered this AuthN check.<br/>
2012-02-05 15:14:43,765 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor6">TP-Processor6</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter xxxx@gmail.com already logged in, returning.</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
                                            
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54812_concise" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54812_concise subText'><span class='date user-tz' title='05/Feb/12 2:14 PM'><time datetime='2012-02-05T14:14-0800'>05/Feb/12 2:14 PM</time></span></span>   - <span class="redText subText" title="John Hare - 06/Feb/12 1:22 PM">edited</span>              I've been adding debug statments to my custom version of the plugin to pinpoint where the failure is happening. I believe I have proof now that the bug is in the Atlassian codebase. It appears like it might be some theading issue related to the the CONFDEV-6043 fix which added the SessionSafePrinciple class into ConfluenceAuthenticator.java.

Here is the interesting part of my debug output:
 So, at timestamp 2012-02-05 15:14:41,240, the shib remote authenticator is basically done handing off the login to the local authenticator and the user is logged in at that point.

After that point there are a couple requests which get checked, the user is determined to be logged in and the authenticator returns as normal.

After the requst to homepage.action though, the log thread apears to crash when it tries to fetch the logged in user. This appears to be a bug in how the ThreadLocal storage is being handled in AuthenticatedUserThreadLocal.java:25 (just like the stack trace shows).

==============================================

So the following log line:

2012-02-05 15:14:41,242 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/atlassian.seraph.auth.DefaultAuthenticator">atlassian.seraph.auth.DefaultAuthenticator</a> authoriseUserAndEstablishSession authoriseUser : 'xxxx@gmail.com' can login according to the RoleMapper

Shows the thread of execution on line DefaultAuthenticator.java:201


The next interesting thing that happens is a call on line 214 to: 
putPrincipalInSessionContext(httpServletRequest, principal);



Which if I'm not mistaken executes the protected method define on line DefaultAuthenticator.java:243.

protected void putPrincipalInSessionContext(final HttpServletRequest httpServletRequest, final Principal principal)
{ 
final HttpSession httpSession = httpServletRequest.getSession(); httpSession.setAttribute(LOGGED_IN_KEY, principal); httpSession.setAttribute(LOGGED_OUT_KEY, null); 
}




 Note however that the ConfluenceAuthenticator.java class also overrides this method on line 88:

 // CONFDEV-6043. Users we get from the system may not be serializable, which makes it hard to put
 // one in the session. We can put a placeholder user in the session because every time Seraph gets it
 // out again, it passes it through refreshPrincipalObtainedFromSession() to turn it back into a live user
 // for the rest of the request.
 protected void putPrincipalInSessionContext(HttpServletRequest httpServletRequest, Principal principal)
 { super.putPrincipalInSessionContext(httpServletRequest, principal == null ? null : new SessionSafePrincipal(principal)); }



My theory is that the authorizeUserAndEstablishSession call is calling the method that doesn't use the SessionSafePrincipal wrapper class and the thread trying to dereference it later does try to cast it to the SessionSafePrincipal wrapper.






=====================
2012-02-05 15:14:40,961 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> login Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/dologin.action">https://wiki-test.doit.wisc.edu/confluence/dologin.action</a> triggered this AuthN check. (username=xxxx@gmail.com, remoteIP=128.104.19.219, remoteHost=128.104.19.219)
2012-02-05 15:14:40,962 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> login remoteIP=128.104.19.219 remoteHost=128.104.19.219
2012-02-05 15:14:40,963 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> login JH9: calling getUserFromSession: request=com.atlassian.seraph.filter.BaseLoginFilter$SecurityHttpRequestWrapper@142d6ab
2012-02-05 15:14:40,963 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/atlassian.seraph.auth.DefaultAuthenticator">atlassian.seraph.auth.DefaultAuthenticator</a> getUserFromSession getUserFromSession : Session found; BUT it has no Principal in it
2012-02-05 15:14:40,965 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> login JH9: returning from getUserFromSession: user=null
2012-02-05 15:14:40,965 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> login JH9: finally block: user=null
2012-02-05 15:14:40,966 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> login JH9: dereferencing null  user.getName()  didn't have a logged in key in session.
2012-02-05 15:14:40,967 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> createSafeUserid originalRemoteuser: null
2012-02-05 15:14:40,967 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> createSafeUserid Remote user is returned as is, mappers do not matched.
2012-02-05 15:14:40,968 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> login Remote user was null or empty, calling super.login() to perform local login.
2012-02-05 15:14:40,968 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> login Trying local login for user xxxx@gmail.com
2012-02-05 15:14:41,240 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/atlassian.seraph.auth.DefaultAuthenticator">atlassian.seraph.auth.DefaultAuthenticator</a> login login : 'xxxx@gmail.com' has been authenticated
2012-02-05 15:14:41,242 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/atlassian.seraph.auth.DefaultAuthenticator">atlassian.seraph.auth.DefaultAuthenticator</a> authoriseUserAndEstablishSession authoriseUser : 'xxxx@gmail.com' can login according to the RoleMapper
2012-02-05 15:14:41,339 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/">https://wiki-test.doit.wisc.edu/confluence/</a> triggered this AuthN check.
2012-02-05 15:14:41,340 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter xxxx@gmail.com already logged in, returning.
2012-02-05 15:14:41,341 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/">https://wiki-test.doit.wisc.edu/confluence/</a> triggered this AuthN check.
2012-02-05 15:14:41,341 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter xxxx@gmail.com already logged in, returning.
2012-02-05 15:14:43,304 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/homepage.action">https://wiki-test.doit.wisc.edu/confluence/homepage.action</a> triggered this AuthN check.
2012-02-05 15:14:43,305 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter xxxx@gmail.com already logged in, returning.
2012-02-05 15:14:43,306 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/homepage.action">https://wiki-test.doit.wisc.edu/confluence/homepage.action</a> triggered this AuthN check.
2012-02-05 15:14:43,307 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter xxxx@gmail.com already logged in, returning.
2012-02-05 15:14:43,312 ERROR <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> [<a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/Catalina">Catalina</a>.<a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/localhost">localhost</a>.<a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/%2Fconfluence">/confluence</a>.<a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/action">action</a>] log Servlet.service() for servlet action threw exception
java.lang.ClassCastException: com.atlassian.confluence.user.SessionSafePrincipal cannot be cast to com.atlassian.user.User
        at com.atlassian.confluence.user.AuthenticatedUserThreadLocal.getUser(AuthenticatedUserThreadLocal.java:25)
        at com.atlassian.confluence.util.UserThreadLocalFilter.doFilter(UserThreadLocalFilter.java:36)
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.seraph.filter.SecurityFilter.doFilter(SecurityFilter.java:211)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.security.auth.trustedapps.filter.TrustedApplicationsFilter.doFilter(TrustedApplicationsFilter.java:98)
        at com.atlassian.confluence.util.AbstractBootstrapHotSwappingFilter.doFilter(AbstractBootstrapHotSwappingFilter.java:30)
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.seraph.filter.BaseLoginFilter.doFilter(BaseLoginFilter.java:150)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:46)
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter$1.doFilter(DelegatingPluginFilter.java:66)
        at com.atlassian.oauth.serviceprovider.internal.servlet.OAuthFilter.doFilter(OAuthFilter.java:71)
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter.doFilter(DelegatingPluginFilter.java:74)
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:42)
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:77)
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:63)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.util.ClusterHeaderFilter.doFilter(ClusterHeaderFilter.java:37)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.johnson.filters.AbstractJohnsonFilter.doFilter(AbstractJohnsonFilter.java:72)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at org.springframework.orm.hibernate.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:170)
        at com.atlassian.spring.filter.FlushingSpringSessionInViewFilter.doFilterInternal(FlushingSpringSessionInViewFilter.java:29)
        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.util.ConfluenceErrorFilter.doFilter(ConfluenceErrorFilter.java:22)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.util.profiling.filters.ProfilingFilter.doFilter(ProfilingFilter.java:99)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.core.datetime.RequestTimeThreadLocalFilter.doFilter(RequestTimeThreadLocalFilter.java:35)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.gzipfilter.GzipFilter.doFilterInternal(GzipFilter.java:80)
        at com.atlassian.gzipfilter.GzipFilter.doFilter(GzipFilter.java:51)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.core.filters.cache.AbstractCachingFilter.doFilter(AbstractCachingFilter.java:33)
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:46)
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter$1.doFilter(DelegatingPluginFilter.java:66)
        at com.atlassian.confluence.extra.webdav.servlet.filter.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:43)
        at com.atlassian.plugin.servlet.filter.DelegatingPluginFilter.doFilter(DelegatingPluginFilter.java:74)
        at com.atlassian.plugin.servlet.filter.IteratingFilterChain.doFilter(IteratingFilterChain.java:42)
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:77)
        at com.atlassian.plugin.servlet.filter.ServletFilterModuleContainerFilter.doFilter(ServletFilterModuleContainerFilter.java:63)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.web.filter.validateparam.RequestParamValidationFilter.doFilter(RequestParamValidationFilter.java:58)
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.web.filter.TranslationModeFilter.doFilter(TranslationModeFilter.java:43)
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.plugin.servlet.filter.ActionContextCleanUp.doFilter(ActionContextCleanUp.java:71)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.web.filter.LanguageExtractionFilter.doFilter(LanguageExtractionFilter.java:54)
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.util.RequestCacheThreadLocalFilter.doFilter(RequestCacheThreadLocalFilter.java:25)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.core.filters.encoding.AbstractEncodingFilter.doFilter(AbstractEncodingFilter.java:41)
        at com.atlassian.core.filters.AbstractHttpFilter.doFilter(AbstractHttpFilter.java:31)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.core.filters.HeaderSanitisingFilter.doFilter(HeaderSanitisingFilter.java:44)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at com.atlassian.confluence.servlet.FourOhFourErrorLoggingFilter.doFilter(FourOhFourErrorLoggingFilter.java:65)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)
        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)
        at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:555)
        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)
        at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:190)
        at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:291)
        at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:769)
        at org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:698)
        at org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.java:891)
        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:690)
        at java.lang.Thread.run(Thread.java:662)
2012-02-05 15:14:43,715 INFO <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor8">TP-Processor8</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/atlassian.confluence.status.SystemErrorInformationLogger">atlassian.confluence.status.SystemErrorInformationLogger</a> writeToLog 
Request Unique ID : a7bd468b-a8a7-4bc7-9d60-edd6f12d8d37
--------------------------
JVM Stats
--------------------------
allocatedHeap = 436084736
availablePermGen = 308884272
usedMemory = 233046096
totalMemory = 436084736
freeMemory = 203038640
maxPermGen = 402653184
usedPermGen = 93768912
freeMemoryInMegabytes = 193
freeAllocatedHeap = 203038640
availableHeap = 1064435632
usedMemoryInMegabytes = 222
maxHeap = 1297481728
usedHeap = 233046096
totalMemoryInMegabytes = 415
--------------------------
Request Information
--------------------------
URL: <a href="https://wiki-test.doit.wisc.edu/confluence/500page.jsp">https://wiki-test.doit.wisc.edu/confluence/500page.jsp</a>
Scheme: https
Server: wiki-test.doit.wisc.edu
Port: 443
URI: /confluence/500page.jsp
Context Path: /confluence
Servlet Path: /500page.jsp
Path Info: null
Query String: null
--------------------------
Attributes
--------------------------
javax.servlet.forward.request_uri: /confluence/homepage.action
javax.servlet.forward.context_path: /confluence
javax.servlet.forward.servlet_path: /homepage.action
javax.servlet.forward.path_info: /500page.jsp
os_securityfilter_already_filtered: true
atlassian.core.seraph.original.url: /homepage.action
javax.servlet.error.status_code: 500
javax.servlet.error.servlet_name: action
com.atlassian.gzipfilter.GzipFilter_already_filtered: true
loginfilter.already.filtered: true
Confluence-Request-Time: 1328476483304
com.atlassian.confluence.web.ConfluenceJohnsonFilter_already_filtered: true
javax.servlet.error.message: 
com.atlassian.core.filters.HeaderSanitisingFilter_already_filtered: true
__cleanup_recursion_counter: 0
com.atlassian.confluence.web.filter.validateparam.RequestParamValidationFilter_already_filtered: true
javax.servlet.error.exception: java.lang.ClassCastException: com.atlassian.confluence.user.SessionSafePrincipal cannot be cast to com.atlassian.user.User
javax.servlet.error.request_uri: /confluence/homepage.action
--------------------------
Parameters
--------------------------
caused by: java.lang.ClassCastException: com.atlassian.confluence.user.SessionSafePrincipal cannot be cast to com.atlassian.user.User
at com.atlassian.confluence.user.AuthenticatedUserThreadLocal.getUser(AuthenticatedUserThreadLocal.java:25)

2012-02-05 15:14:43,755 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor3">TP-Processor3</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/includes/css/setup.css">https://wiki-test.doit.wisc.edu/confluence/includes/css/setup.css</a> triggered this AuthN check.
2012-02-05 15:14:43,755 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor3">TP-Processor3</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter xxxx@gmail.com already logged in, returning.
2012-02-05 15:14:43,756 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor3">TP-Processor3</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/includes/css/setup.css">https://wiki-test.doit.wisc.edu/confluence/includes/css/setup.css</a> triggered this AuthN check.
2012-02-05 15:14:43,757 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor3">TP-Processor3</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter xxxx@gmail.com already logged in, returning.
2012-02-05 15:14:43,763 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor6">TP-Processor6</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/includes/js/cookieUtils.js">https://wiki-test.doit.wisc.edu/confluence/includes/js/cookieUtils.js</a> triggered this AuthN check.
2012-02-05 15:14:43,764 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor6">TP-Processor6</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter xxxx@gmail.com already logged in, returning.
2012-02-05 15:14:43,765 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor6">TP-Processor6</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter Request made to <a href="https://wiki-test.doit.wisc.edu/confluence/includes/js/cookieUtils.js">https://wiki-test.doit.wisc.edu/confluence/includes/js/cookieUtils.js</a> triggered this AuthN check.
2012-02-05 15:14:43,765 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor6">TP-Processor6</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> getUserForAtlassianLoginFilter xxxx@gmail.com already logged in, returning.         </div>
    </div>
</div>
                     <div id="comment-54813" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54813&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54813" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54813_verbose" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54813_verbose subText'><span class='date user-tz' title='05/Feb/12 2:20 PM'><time datetime='2012-02-05T14:20-0800'>05/Feb/12 2:20 PM</time></span></span>  </div>
        <div class="action-body flooded"><p>Note: there are a couple cases in the RemoteUserAuthenticator.java file where user can get dereferenced if it's null and debugging is turned on.<br/>
1. In login 2 lines above the "} catch(Throwable t) {" line of code.<br/>
2. Just below that in the last few lines of the finally block, the log.debug dereferences user.getName() but user might be null at that point (at least it was for me).</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54813_concise" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54813_concise subText'><span class='date user-tz' title='05/Feb/12 2:20 PM'><time datetime='2012-02-05T14:20-0800'>05/Feb/12 2:20 PM</time></span></span>               Note: there are a couple cases in the RemoteUserAuthenticator.java file where user can get dereferenced if it's null and debugging is turned on.
1. In login 2 lines above the "} catch(Throwable t) {" line of code.
2. Just below that in the last few lines of the finally block, the log.debug dereferences user.getName() but user might be null at that point (at least it was for me).         </div>
    </div>
</div>
                     <div id="comment-54820" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54820&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54820" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54820_verbose" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54820_verbose subText'><span class='date user-tz' title='05/Feb/12 9:16 PM'><time datetime='2012-02-05T21:16-0800'>05/Feb/12 9:16 PM</time></span></span>  </div>
        <div class="action-body flooded"><p>I need to revise my theory a bit. I wanted to confirm my assumptions about what was being called when so I put together a small stub program to verify the method call orders.</p>

<p>RemoteUserAuthenticator:login<br/>
 RemoteUserAuthenticator:calling super.login<br/>
 ConfluenceAuthenticator:login<br/>
 ConfluenceAuthenticator:calling super.login<br/>
 DefaultAuthenticator:login<br/>
 DefaultAuthenticator:calling authoriseAndEstablishSession<br/>
 DefaultAuthenticator:authoriseUserAndEstablishSession<br/>
 DefaultAuthenticator:calling putPrincipalInSessionContext<br/>
 ConfluenceAuthenticator:putPrincipalInSessionContext<br/>
 ConfluenceAuthenticator:calling super.putPrincipalInSessionContext (with SessionSafePrincipal wrapper)<br/>
 DefaultAuthenticator:putPrincipalInSessionContext</p>

<p>An incorrect assumption I had in my previous comment was that the call to putPrincipalInSessionContext from the DefaultAuthenticator's authoriseAndEstablishSession method was executing it's own putPrincipalInSessionContext method.</p>

<p>However, it actually calls the overriden version in ConfluenceAuthenticator (which picks up the SessionSafePrinicipal wrapper) before calling super.putPrincipalInSessionContext in the DefaultAuthenticator.</p>

<p>So, my earlier theory that it was executing DefaultAuthenticator:putPrincipalInSessionContext<br/>
 was incorrect.</p>

<p>New theory is that it sets the principal as intended with the SessionSafePrincipal wrapper<br/>
 and that there is simply code in confluence that is not expecting that wrapper to be<br/>
 present (specifically AuthenticatedUserThreadLocal.java:25).</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54820_concise" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54820_concise subText'><span class='date user-tz' title='05/Feb/12 9:16 PM'><time datetime='2012-02-05T21:16-0800'>05/Feb/12 9:16 PM</time></span></span>               I need to revise my theory a bit. I wanted to confirm my assumptions about what was being called when so I put together a small stub program to verify the method call orders.

RemoteUserAuthenticator:login
 RemoteUserAuthenticator:calling super.login
 ConfluenceAuthenticator:login
 ConfluenceAuthenticator:calling super.login
 DefaultAuthenticator:login
 DefaultAuthenticator:calling authoriseAndEstablishSession
 DefaultAuthenticator:authoriseUserAndEstablishSession
 DefaultAuthenticator:calling putPrincipalInSessionContext
 ConfluenceAuthenticator:putPrincipalInSessionContext
 ConfluenceAuthenticator:calling super.putPrincipalInSessionContext (with SessionSafePrincipal wrapper)
 DefaultAuthenticator:putPrincipalInSessionContext

An incorrect assumption I had in my previous comment was that the call to putPrincipalInSessionContext from the DefaultAuthenticator's authoriseAndEstablishSession method was executing it's own putPrincipalInSessionContext method.

However, it actually calls the overriden version in ConfluenceAuthenticator (which picks up the SessionSafePrinicipal wrapper) before calling super.putPrincipalInSessionContext in the DefaultAuthenticator.

So, my earlier theory that it was executing DefaultAuthenticator:putPrincipalInSessionContext
 was incorrect.

New theory is that it sets the principal as intended with the SessionSafePrincipal wrapper
 and that there is simply code in confluence that is not expecting that wrapper to be
 present (specifically AuthenticatedUserThreadLocal.java:25).         </div>
    </div>
</div>
                     <div id="comment-54821" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54821&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54821" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54821_verbose" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54821_verbose subText'><span class='date user-tz' title='05/Feb/12 9:16 PM'><time datetime='2012-02-05T21:16-0800'>05/Feb/12 9:16 PM</time></span></span>  </div>
        <div class="action-body flooded"><p>Looks like UserThreadLocalFilter.java doesn't know anything about the SessionSafePrincipal class and is expecting to be able to cast the Principal to a User (which I guess is basically what the stack trace shows so I'm probably not adding much info here).</p>

<p>As an FYI though: we are using the default web.xml file that comes with v4.1.4. We've made no edits or customizations to the filters.</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54821_concise" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54821_concise subText'><span class='date user-tz' title='05/Feb/12 9:16 PM'><time datetime='2012-02-05T21:16-0800'>05/Feb/12 9:16 PM</time></span></span>               Looks like UserThreadLocalFilter.java doesn't know anything about the SessionSafePrincipal class and is expecting to be able to cast the Principal to a User (which I guess is basically what the stack trace shows so I'm probably not adding much info here).

As an FYI though: we are using the default web.xml file that comes with v4.1.4. We've made no edits or customizations to the filters.         </div>
    </div>
</div>
                     <div id="comment-54844" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54844&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54844" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54844_verbose" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_54844_verbose subText'><span class='date user-tz' title='06/Feb/12 10:21 AM'><time datetime='2012-02-06T10:21-0800'>06/Feb/12 10:21 AM</time></span></span>  </div>
        <div class="action-body flooded"><p>John,</p>

<p>Yes, we had a number of places where the assumption that Principal was a User were wrong and have changed everywhere we could, afaik, but if you find anything specifically that we can do differently, please let us know or let me know if you'd like to change the code yourself and I can ask that you be added to the project. Unfortunately I have almost no time to do support on the authenticator this week, and I don't have a test environment available anymore for the shib authenticator, so I have to fly blind and rely on user assistance for testing usually (which is much less than optimal!). If you have time to contribute that would be great.</p>

<p>Ok, so I just read Ryan Ackley's latest comment in <a href="https://studio.plugins.atlassian.com/browse/SHBL-53">https://studio.plugins.atlassian.com/browse/SHBL-53</a> and it seems that there is something we just need to remove outright from the latest version of the authenticator, which is going to make it incompatible with versions of Confluence prior to 4.1, I think.</p>

<p>Will try that quickly and release- that is the best I can do I think. Will be offline for a few weeks. <img class="emoticon" src="/images/icons/emoticons/sad.gif" height="20" width="20" align="absmiddle" alt="" border="0"/> Let me know asap if you want access to the codebase and I can ask Atlassian to add you if you think you could help get it through this issue if my upcoming "fix" doesn't.</p>

<p>Thanks,<br/>
Gary</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54844_concise" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_54844_concise subText'><span class='date user-tz' title='06/Feb/12 10:21 AM'><time datetime='2012-02-06T10:21-0800'>06/Feb/12 10:21 AM</time></span></span>               John,

Yes, we had a number of places where the assumption that Principal was a User were wrong and have changed everywhere we could, afaik, but if you find anything specifically that we can do differently, please let us know or let me know if you'd like to change the code yourself and I can ask that you be added to the project. Unfortunately I have almost no time to do support on the authenticator this week, and I don't have a test environment available anymore for the shib authenticator, so I have to fly blind and rely on user assistance for testing usually (which is much less than optimal!). If you have time to contribute that would be great.

Ok, so I just read Ryan Ackley's latest comment in <a href="https://studio.plugins.atlassian.com/browse/SHBL-53">https://studio.plugins.atlassian.com/browse/SHBL-53</a> and it seems that there is something we just need to remove outright from the latest version of the authenticator, which is going to make it incompatible with versions of Confluence prior to 4.1, I think.

Will try that quickly and release- that is the best I can do I think. Will be offline for a few weeks. <img class="emoticon" src="/images/icons/emoticons/sad.gif" height="20" width="20" align="absmiddle" alt="" border="0"/> Let me know asap if you want access to the codebase and I can ask Atlassian to add you if you think you could help get it through this issue if my upcoming "fix" doesn't.

Thanks,
Gary         </div>
    </div>
</div>
                     <div id="comment-54846" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54846&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54846" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54846_verbose" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54846_verbose subText'><span class='date user-tz' title='06/Feb/12 11:29 AM'><time datetime='2012-02-06T11:29-0800'>06/Feb/12 11:29 AM</time></span></span>  </div>
        <div class="action-body flooded"><p>I'm happy to help with code changes but not sure I'd attempt anything beyond fixing up those debug statements untill I'm a bit more up to speed with the internals. Might be best for you to make any of the significant changes and cut releases etc...<br/>
I'm happy to test anything you think might be worth trying (releases and/or making some local mods to try various ideas). Fixing this is a significant priority for me so I have time available for anything that might help.</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54846_concise" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54846_concise subText'><span class='date user-tz' title='06/Feb/12 11:29 AM'><time datetime='2012-02-06T11:29-0800'>06/Feb/12 11:29 AM</time></span></span>               I'm happy to help with code changes but not sure I'd attempt anything beyond fixing up those debug statements untill I'm a bit more up to speed with the internals. Might be best for you to make any of the significant changes and cut releases etc...
I'm happy to test anything you think might be worth trying (releases and/or making some local mods to try various ideas). Fixing this is a significant priority for me so I have time available for anything that might help.         </div>
    </div>
</div>
                     <div id="comment-54851" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54851&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54851" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54851_verbose" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_54851_verbose subText'><span class='date user-tz' title='06/Feb/12 12:51 PM'><time datetime='2012-02-06T12:51-0800'>06/Feb/12 12:51 PM</time></span></span>  </div>
        <div class="action-body flooded"><p>John,</p>

<p>Per comment in <a href="/browse/SHBL-53" title="local user login throws an exception in 4.1"><del>SHBL-53</del></a> I removed some old code that was attempting to use the old method to get user from HTTP session which Confluence 4.1 no longer supports. Just released fix as 2.1.6, but this means that 2.1.6+ are only compatible with Confluence 4.1+.</p>

<p>Here is the jar: <a href="https://studio.plugins.atlassian.com/svn/SHBL/releases/remoteUserAuth-2.1.6.jar">https://studio.plugins.atlassian.com/svn/SHBL/releases/remoteUserAuth-2.1.6.jar</a></p>

<p>I also added defaults for config items, just in case people didn't update their config file to use the latest config options.</p>

<p>Let me know if that works for you.</p>

<p>Thanks,<br/>
Gary</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54851_concise" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_54851_concise subText'><span class='date user-tz' title='06/Feb/12 12:51 PM'><time datetime='2012-02-06T12:51-0800'>06/Feb/12 12:51 PM</time></span></span>               John,

Per comment in <a href="/browse/SHBL-53" title="local user login throws an exception in 4.1"><del>SHBL-53</del></a> I removed some old code that was attempting to use the old method to get user from HTTP session which Confluence 4.1 no longer supports. Just released fix as 2.1.6, but this means that 2.1.6+ are only compatible with Confluence 4.1+.

Here is the jar: <a href="https://studio.plugins.atlassian.com/svn/SHBL/releases/remoteUserAuth-2.1.6.jar">https://studio.plugins.atlassian.com/svn/SHBL/releases/remoteUserAuth-2.1.6.jar</a>

I also added defaults for config items, just in case people didn't update their config file to use the latest config options.

Let me know if that works for you.

Thanks,
Gary         </div>
    </div>
</div>
                     <div id="comment-54854" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54854&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54854" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
                                            
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54854_verbose" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54854_verbose subText'><span class='date user-tz' title='06/Feb/12 1:13 PM'><time datetime='2012-02-06T13:13-0800'>06/Feb/12 1:13 PM</time></span></span>   - <span class="redText subText" title="John Hare - 06/Feb/12 1:37 PM">edited</span> </div>
        <div class="action-body flooded"><p>Thanks, trying it now...</p>

<p>I did hit a NullPointerError that I forgot to mention yesterday though. In purgeUserRolls, Pager p is set to null on line 276. The next reference to it is in the loop where it's being dereferenced, thus the NullPointerError (line 289).</p>

<p>For now I'll comment out that bit and build my own version of 2.1.6 to give your recent changes a try.</p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>270:    private void purgeUserRoles(Principal user, Collection rolesToKeep) {
271:        if ((config.getPurgeMappings().size() == 0)) {
272:            if (log.isDebugEnabled()) {
273:                log.debug("No roles to purge specified, not purging any roles...");
274:            }
275:        } else {
276:            Pager p = null;
277:            if (log.isDebugEnabled()) {
278:                log.debug("Purging roles from user " + user.getName());
279:            }
280:
281:            CrowdService crowdService = getCrowdService();
282:            if (crowdService == null) {
283:                throw new RuntimeException("crowdService was not wired in RemoteUserAuthenticator");
284:            }
285:
286:            User crowdUser = crowdService.getUser(user.getName());
287:            Collection purgeMappers = config.getPurgeMappings();
288:
289:            for (Iterator it = p.iterator(); it.hasNext(); ) {
290:                Group group = (Group) it.next();
291:                String role = group.getName();
</pre>
</div></div> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
                                            
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54854_concise" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54854_concise subText'><span class='date user-tz' title='06/Feb/12 1:13 PM'><time datetime='2012-02-06T13:13-0800'>06/Feb/12 1:13 PM</time></span></span>   - <span class="redText subText" title="John Hare - 06/Feb/12 1:37 PM">edited</span>              Thanks, trying it now...

I did hit a NullPointerError that I forgot to mention yesterday though. In purgeUserRolls, Pager p is set to null on line 276. The next reference to it is in the loop where it's being dereferenced, thus the NullPointerError (line 289).

For now I'll comment out that bit and build my own version of 2.1.6 to give your recent changes a try.

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>270:    private void purgeUserRoles(Principal user, Collection rolesToKeep) {
271:        if ((config.getPurgeMappings().size() == 0)) {
272:            if (log.isDebugEnabled()) {
273:                log.debug("No roles to purge specified, not purging any roles...");
274:            }
275:        } else {
276:            Pager p = null;
277:            if (log.isDebugEnabled()) {
278:                log.debug("Purging roles from user " + user.getName());
279:            }
280:
281:            CrowdService crowdService = getCrowdService();
282:            if (crowdService == null) {
283:                throw new RuntimeException("crowdService was not wired in RemoteUserAuthenticator");
284:            }
285:
286:            User crowdUser = crowdService.getUser(user.getName());
287:            Collection purgeMappers = config.getPurgeMappings();
288:
289:            for (Iterator it = p.iterator(); it.hasNext(); ) {
290:                Group group = (Group) it.next();
291:                String role = group.getName();
</pre>
</div></div>         </div>
    </div>
</div>
                     <div id="comment-54855" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54855&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54855" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54855_verbose" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_54855_verbose subText'><span class='date user-tz' title='06/Feb/12 2:21 PM'><time datetime='2012-02-06T14:21-0800'>06/Feb/12 2:21 PM</time></span></span>  </div>
        <div class="action-body flooded"><p>Wow. Thanks, I didn't see that and have no idea what happened there. Good catch and sorry I missed that.</p>

<p>You don't have to rebuild/change that if purge.roles is empty like:<br/>
purge.roles=</p>

<p>or better yet is just not defined. It looks like the intent was to get a Pager for groups and iterate them. That wouldn't be hard to get groups and iterate, but there may be a better way and unfortunately I don't have time at the moment to fix it, so that functionality looks to be "broken" and should not be used for now.</p>

<p>Thanks again,<br/>
Gary</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54855_concise" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_54855_concise subText'><span class='date user-tz' title='06/Feb/12 2:21 PM'><time datetime='2012-02-06T14:21-0800'>06/Feb/12 2:21 PM</time></span></span>               Wow. Thanks, I didn't see that and have no idea what happened there. Good catch and sorry I missed that.

You don't have to rebuild/change that if purge.roles is empty like:
purge.roles=

or better yet is just not defined. It looks like the intent was to get a Pager for groups and iterate them. That wouldn't be hard to get groups and iterate, but there may be a better way and unfortunately I don't have time at the moment to fix it, so that functionality looks to be "broken" and should not be used for now.

Thanks again,
Gary         </div>
    </div>
</div>
                     <div id="comment-54898" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54898&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54898" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
                                            
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54898_verbose" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54898_verbose subText'><span class='date user-tz' title='07/Feb/12 7:22 AM'><time datetime='2012-02-07T07:22-0800'>07/Feb/12 7:22 AM</time></span></span>   - <span class="redText subText" title="John Hare - 07/Feb/12 7:26 AM">edited</span> </div>
        <div class="action-body flooded"><p>So your latest 2.1.6 version was still complaining about the SessionSafePrincipal casting problem. </p>

<p>Here's what I think might be happening, feel free to correct me if I'm off on any points. </p>

<p>There is a filter mapped to *.action which triggers a call to UserThreadLocalFilter.java which calls AuthenticatedUserThreadLocal.java which calls getUser from the RemoteUserAuthenticator.</p>

<p>When the login happens the RemoteUserAuthenticator passes control to ConfluenceAuthenticator via a call to super.login(). ConfluenceAuthenticator is now wrapping the user data in SessionSafePrincipal before it sticks it into the session.</p>

<p>When the filter calls RemoteUserAuthenticator.getUser(request,response), if the user is logged in, rather than pulling it from the session I inserted a call to super.getUser(request,response) passing controll to ConfluenceAuthenticator. ConfluenceAuthenticator basically does the return getUserAccessor().getUser(uid); that Ryan Ackley suggested in <a href="/browse/SHBL-53" title="local user login throws an exception in 4.1"><del>SHBL-53</del></a>. </p>

<p>I'm not sure I fully understand what the difference is between what we were doing and this change but it was the difference between local logins failing and working for me. Here's the interesting bit of code that I modified to make the local logins work (lines 823-825).</p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>810:    public Principal getUserForAtlassianLoginFilter(HttpServletRequest request, HttpServletResponse response) {
811:        if (log.isDebugEnabled()) {
812:            log.debug("Request made to " + request.getRequestURL() + " triggered this AuthN check.");
813:        }
814:
815:        HttpSession httpSession = request.getSession();
816:        Principal user = null;
817:
818:        // for those interested on the events
819:        String remoteIP = request.getRemoteAddr();
820:        String remoteHost = request.getRemoteHost();
821:
822:        // Check if the user is already logged in
823:        if (ettpSessionerAccessor().getUser(uid);getAttrinute(ConfluenceAuthenticator.LOGGED_IN_KEY) != null) {
824:            return super.getUser(request, response);
825:        }
</pre>
</div></div>

<p>Also, I'm not fully up to speed on everything that getUserForAtlassianLoginFilter is trying to do so I'm not sure if there are other places that may need this same change.</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
                                            
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54898_concise" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54898_concise subText'><span class='date user-tz' title='07/Feb/12 7:22 AM'><time datetime='2012-02-07T07:22-0800'>07/Feb/12 7:22 AM</time></span></span>   - <span class="redText subText" title="John Hare - 07/Feb/12 7:26 AM">edited</span>              So your latest 2.1.6 version was still complaining about the SessionSafePrincipal casting problem. 

Here's what I think might be happening, feel free to correct me if I'm off on any points. 

There is a filter mapped to *.action which triggers a call to UserThreadLocalFilter.java which calls AuthenticatedUserThreadLocal.java which calls getUser from the RemoteUserAuthenticator.

When the login happens the RemoteUserAuthenticator passes control to ConfluenceAuthenticator via a call to super.login(). ConfluenceAuthenticator is now wrapping the user data in SessionSafePrincipal before it sticks it into the session.

When the filter calls RemoteUserAuthenticator.getUser(request,response), if the user is logged in, rather than pulling it from the session I inserted a call to super.getUser(request,response) passing controll to ConfluenceAuthenticator. ConfluenceAuthenticator basically does the return getUserAccessor().getUser(uid); that Ryan Ackley suggested in <a href="/browse/SHBL-53" title="local user login throws an exception in 4.1"><del>SHBL-53</del></a>. 

I'm not sure I fully understand what the difference is between what we were doing and this change but it was the difference between local logins failing and working for me. Here's the interesting bit of code that I modified to make the local logins work (lines 823-825).

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>810:    public Principal getUserForAtlassianLoginFilter(HttpServletRequest request, HttpServletResponse response) {
811:        if (log.isDebugEnabled()) {
812:            log.debug("Request made to " + request.getRequestURL() + " triggered this AuthN check.");
813:        }
814:
815:        HttpSession httpSession = request.getSession();
816:        Principal user = null;
817:
818:        // for those interested on the events
819:        String remoteIP = request.getRemoteAddr();
820:        String remoteHost = request.getRemoteHost();
821:
822:        // Check if the user is already logged in
823:        if (ettpSessionerAccessor().getUser(uid);getAttrinute(ConfluenceAuthenticator.LOGGED_IN_KEY) != null) {
824:            return super.getUser(request, response);
825:        }
</pre>
</div></div>

Also, I'm not fully up to speed on everything that getUserForAtlassianLoginFilter is trying to do so I'm not sure if there are other places that may need this same change.         </div>
    </div>
</div>
                     <div id="comment-54903" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54903&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54903" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54903_verbose" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_54903_verbose subText'><span class='date user-tz' title='07/Feb/12 11:40 AM'><time datetime='2012-02-07T11:40-0800'>07/Feb/12 11:40 AM</time></span></span>  </div>
        <div class="action-body flooded"><p>Fixed the NPE via reintroducing (yay) UserAccessor usage to get group list. Doing it via embedded crowd is painful (would have to create group search query using poorly documented interface). so hopefully it is ok now. Not tested:</p>

<p><a href="https://studio.plugins.atlassian.com/svn/SHBL/releases/remoteUserAuth-2.1.7.jar">https://studio.plugins.atlassian.com/svn/SHBL/releases/remoteUserAuth-2.1.7.jar</a></p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54903_concise" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_54903_concise subText'><span class='date user-tz' title='07/Feb/12 11:40 AM'><time datetime='2012-02-07T11:40-0800'>07/Feb/12 11:40 AM</time></span></span>               Fixed the NPE via reintroducing (yay) UserAccessor usage to get group list. Doing it via embedded crowd is painful (would have to create group search query using poorly documented interface). so hopefully it is ok now. Not tested:

<a href="https://studio.plugins.atlassian.com/svn/SHBL/releases/remoteUserAuth-2.1.7.jar">https://studio.plugins.atlassian.com/svn/SHBL/releases/remoteUserAuth-2.1.7.jar</a>         </div>
    </div>
</div>
                     <div id="comment-54904" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54904&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54904" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54904_verbose" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54904_verbose subText'><span class='date user-tz' title='07/Feb/12 12:08 PM'><time datetime='2012-02-07T12:08-0800'>07/Feb/12 12:08 PM</time></span></span>  </div>
        <div class="action-body flooded"><p>ok, it looks like v2.1.7 is working for both the shib logins and the local logins. I want to spend some more quality time with it but it's looking good after my initial test.</p>

<p>I did see a debug statement that has thrown a NullPointerException on me in the past that looks like it's still vulnerable. In RemoteUserAuthenticator.java line 703. I've had this throw a NullPointerException in the past. If getUserFromSession on line 693 returns a null, and debugging is turned on it will do so.</p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>693:            user = getUserFromSession(request);
694:            if (user != null) {
695:                if (log.isDebugEnabled()) {
696:                    log.debug("" + user.getName() + " already logged in (user in session), returning.");
697:                }
698:
699:                return true;
700:            }
701:
702:            if (log.isDebugEnabled()) {
703:                log.debug("" + user.getName() + " didn't have a user in session.");
704:            }
</pre>
</div></div>

<p>I'll do more testing on v2.1.7 and post a message here with my results. I want to confirm all the group config stuff is working as expected.</p>

<p>Thanks for all your help!</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54904_concise" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54904_concise subText'><span class='date user-tz' title='07/Feb/12 12:08 PM'><time datetime='2012-02-07T12:08-0800'>07/Feb/12 12:08 PM</time></span></span>               ok, it looks like v2.1.7 is working for both the shib logins and the local logins. I want to spend some more quality time with it but it's looking good after my initial test.

I did see a debug statement that has thrown a NullPointerException on me in the past that looks like it's still vulnerable. In RemoteUserAuthenticator.java line 703. I've had this throw a NullPointerException in the past. If getUserFromSession on line 693 returns a null, and debugging is turned on it will do so.

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>693:            user = getUserFromSession(request);
694:            if (user != null) {
695:                if (log.isDebugEnabled()) {
696:                    log.debug("" + user.getName() + " already logged in (user in session), returning.");
697:                }
698:
699:                return true;
700:            }
701:
702:            if (log.isDebugEnabled()) {
703:                log.debug("" + user.getName() + " didn't have a user in session.");
704:            }
</pre>
</div></div>

I'll do more testing on v2.1.7 and post a message here with my results. I want to confirm all the group config stuff is working as expected.

Thanks for all your help!         </div>
    </div>
</div>
                     <div id="comment-54905" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54905&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54905" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54905_verbose" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_54905_verbose subText'><span class='date user-tz' title='07/Feb/12 12:25 PM'><time datetime='2012-02-07T12:25-0800'>07/Feb/12 12:25 PM</time></span></span>  </div>
        <div class="action-body flooded"><p>Sorry about the NPE. Fixed it, I think (and added logging/check in a few other places that may not matter or may break it- I didn't test and hacked quickly). Try this with debug on and off:</p>

<p><a href="https://studio.plugins.atlassian.com/svn/SHBL/releases/remoteUserAuth-2.1.8.jar">https://studio.plugins.atlassian.com/svn/SHBL/releases/remoteUserAuth-2.1.8.jar</a></p>

<p>Thanks for your help! If this works I'm probably off of this for a while. Been really sidetracked this week.<br/>
Gary</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54905_concise" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_54905_concise subText'><span class='date user-tz' title='07/Feb/12 12:25 PM'><time datetime='2012-02-07T12:25-0800'>07/Feb/12 12:25 PM</time></span></span>               Sorry about the NPE. Fixed it, I think (and added logging/check in a few other places that may not matter or may break it- I didn't test and hacked quickly). Try this with debug on and off:

<a href="https://studio.plugins.atlassian.com/svn/SHBL/releases/remoteUserAuth-2.1.8.jar">https://studio.plugins.atlassian.com/svn/SHBL/releases/remoteUserAuth-2.1.8.jar</a>

Thanks for your help! If this works I'm probably off of this for a while. Been really sidetracked this week.
Gary         </div>
    </div>
</div>
                     <div id="comment-54906" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54906&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54906" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54906_verbose" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_54906_verbose subText'><span class='date user-tz' title='07/Feb/12 12:25 PM'><time datetime='2012-02-07T12:25-0800'>07/Feb/12 12:25 PM</time></span></span>  </div>
        <div class="action-body flooded"><p>And by that I mean sidetracked in general- not just this. <img class="emoticon" src="/images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54906_concise" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_54906_concise subText'><span class='date user-tz' title='07/Feb/12 12:25 PM'><time datetime='2012-02-07T12:25-0800'>07/Feb/12 12:25 PM</time></span></span>               And by that I mean sidetracked in general- not just this. <img class="emoticon" src="/images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/>         </div>
    </div>
</div>
                     <div id="comment-54908" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54908&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54908" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54908_verbose" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_54908_verbose subText'><span class='date user-tz' title='07/Feb/12 12:42 PM'><time datetime='2012-02-07T12:42-0800'>07/Feb/12 12:42 PM</time></span></span>  </div>
        <div class="action-body flooded"><p>(fixes released in 2.1.8)</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54908_concise" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_54908_concise subText'><span class='date user-tz' title='07/Feb/12 12:42 PM'><time datetime='2012-02-07T12:42-0800'>07/Feb/12 12:42 PM</time></span></span>               (fixes released in 2.1.8)         </div>
    </div>
</div>
                     <div id="comment-54912" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54912&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54912" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54912_verbose" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54912_verbose subText'><span class='date user-tz' title='07/Feb/12 2:45 PM'><time datetime='2012-02-07T14:45-0800'>07/Feb/12 2:45 PM</time></span></span>  </div>
        <div class="action-body flooded"><p>I'm testing v2.1.8. The login functionality seems to be working. Right now I'm trying to confirm that the dynamic group configs are working. I think there is a proglem with group creation.</p>

<p>On our site we have a sort of Department code that each employee exists under. If that code "eduWisconsinUDDS" is passed in the shib login we map that to a number of Confluence groups. The mappings for my Dept are:</p>
<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>getRolesFromHeader Processing dynamicroles header=eduWisconsinUDDS, value=A067130
getRolesFromHeader Found role mapping from 'A067130' to 'udds-a'
getRolesFromHeader Found role mapping from 'A067130' to 'udds-a06'
getRolesFromHeader Found role mapping from 'A067130' to 'udds-a0671'
getRolesFromHeader Found role mapping from 'A067130' to 'udds-a067130'
getRolesFromHeader Found role mapping from 'A067130' to 'doit-employees'
</pre>
</div></div>
<p>So to test this I removed the given test user from these groups and then logged in.<br/>
The given user shoud be added to these groups (and the groups created if they don't exist) upon login.</p>

<p>It looks like the plugin assumes that the groups don't exist. Here's the interesting bit of the log, I'll attach the full log separately:</p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>2012-02-07 16:25:18,381 DEBUG [TP-Processor12] [confluence.authentication.shibboleth.RemoteUserAuthenticator] getRolesFromHeader Processing dynamicroles header=eduWisconsinUDDS, value=A067130
2012-02-07 16:25:18,382 DEBUG [TP-Processor12] [confluence.authentication.shibboleth.RemoteUserAuthenticator] getRolesFromHeader Found role mapping from 'A067130' to 'udds-a'
2012-02-07 16:25:18,383 DEBUG [TP-Processor12] [confluence.authentication.shibboleth.RemoteUserAuthenticator] getRolesFromHeader Found role mapping from 'A067130' to 'udds-a06'
2012-02-07 16:25:18,383 DEBUG [TP-Processor12] [confluence.authentication.shibboleth.RemoteUserAuthenticator] getRolesFromHeader Found role mapping from 'A067130' to 'udds-a0671'
2012-02-07 16:25:18,384 DEBUG [TP-Processor12] [confluence.authentication.shibboleth.RemoteUserAuthenticator] getRolesFromHeader Found role mapping from 'A067130' to 'udds-a067130'
2012-02-07 16:25:18,385 DEBUG [TP-Processor12] [confluence.authentication.shibboleth.RemoteUserAuthenticator] getRolesFromHeader Found role mapping from 'A067130' to 'doit-employees'
2012-02-07 16:25:18,385 DEBUG [TP-Processor12] [confluence.authentication.shibboleth.RemoteUserAuthenticator] assignUserToRoles Assigning xxxx to role confluence-users
2012-02-07 16:25:18,386 DEBUG [TP-Processor12] [confluence.authentication.shibboleth.RemoteUserAuthenticator] assignUserToRoles Skipping xxxx to role confluence-users - already a member
2012-02-07 16:25:18,387 DEBUG [TP-Processor12] [confluence.authentication.shibboleth.RemoteUserAuthenticator] assignUserToRoles Assigning xxxx to role doit-employees
2012-02-07 16:25:18,388 ERROR [TP-Processor12] [confluence.authentication.shibboleth.RemoteUserAuthenticator] doInTransaction Failed to add user xxxx to group 'doit-employees'!
com.atlassian.crowd.exception.embedded.InvalidGroupException: com.atlassian.crowd.exception.InvalidGroupException: Group already exists
	at com.atlassian.crowd.embedded.core.CrowdServiceImpl.addGroup(CrowdServiceImpl.java:500)
	at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator$2.doInTransaction(RemoteUserAuthenticator.java:1135)
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:128)
	at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.addUserToGroup(RemoteUserAuthenticator.java:1132)
	at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.assignUserToRoles(RemoteUserAuthenticator.java:252)
	at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.updateGroupMemberships(RemoteUserAuthenticator.java:791)
	at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.getUser(RemoteUserAuthenticator.java:891)
	at com.atlassian.seraph.auth.AbstractAuthenticator.getUser(AbstractAuthenticator.java:45)
	at com.atlassian.seraph.filter.BaseLoginFilter$SecurityHttpRequestWrapper.getUserPrincipal(BaseLoginFilter.java:236)
	at com.atlassian.seraph.filter.BaseLoginFilter$SecurityHttpRequestWrapper.getRemoteUser(BaseLoginFilter.java:224)
</pre>
</div></div>
 </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54912_concise" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54912_concise subText'><span class='date user-tz' title='07/Feb/12 2:45 PM'><time datetime='2012-02-07T14:45-0800'>07/Feb/12 2:45 PM</time></span></span>               I'm testing v2.1.8. The login functionality seems to be working. Right now I'm trying to confirm that the dynamic group configs are working. I think there is a proglem with group creation.

On our site we have a sort of Department code that each employee exists under. If that code "eduWisconsinUDDS" is passed in the shib login we map that to a number of Confluence groups. The mappings for my Dept are:
<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>getRolesFromHeader Processing dynamicroles header=eduWisconsinUDDS, value=A067130
getRolesFromHeader Found role mapping from 'A067130' to 'udds-a'
getRolesFromHeader Found role mapping from 'A067130' to 'udds-a06'
getRolesFromHeader Found role mapping from 'A067130' to 'udds-a0671'
getRolesFromHeader Found role mapping from 'A067130' to 'udds-a067130'
getRolesFromHeader Found role mapping from 'A067130' to 'doit-employees'
</pre>
</div></div>
So to test this I removed the given test user from these groups and then logged in.
The given user shoud be added to these groups (and the groups created if they don't exist) upon login.

It looks like the plugin assumes that the groups don't exist. Here's the interesting bit of the log, I'll attach the full log separately:

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>2012-02-07 16:25:18,381 DEBUG [TP-Processor12] [confluence.authentication.shibboleth.RemoteUserAuthenticator] getRolesFromHeader Processing dynamicroles header=eduWisconsinUDDS, value=A067130
2012-02-07 16:25:18,382 DEBUG [TP-Processor12] [confluence.authentication.shibboleth.RemoteUserAuthenticator] getRolesFromHeader Found role mapping from 'A067130' to 'udds-a'
2012-02-07 16:25:18,383 DEBUG [TP-Processor12] [confluence.authentication.shibboleth.RemoteUserAuthenticator] getRolesFromHeader Found role mapping from 'A067130' to 'udds-a06'
2012-02-07 16:25:18,383 DEBUG [TP-Processor12] [confluence.authentication.shibboleth.RemoteUserAuthenticator] getRolesFromHeader Found role mapping from 'A067130' to 'udds-a0671'
2012-02-07 16:25:18,384 DEBUG [TP-Processor12] [confluence.authentication.shibboleth.RemoteUserAuthenticator] getRolesFromHeader Found role mapping from 'A067130' to 'udds-a067130'
2012-02-07 16:25:18,385 DEBUG [TP-Processor12] [confluence.authentication.shibboleth.RemoteUserAuthenticator] getRolesFromHeader Found role mapping from 'A067130' to 'doit-employees'
2012-02-07 16:25:18,385 DEBUG [TP-Processor12] [confluence.authentication.shibboleth.RemoteUserAuthenticator] assignUserToRoles Assigning xxxx to role confluence-users
2012-02-07 16:25:18,386 DEBUG [TP-Processor12] [confluence.authentication.shibboleth.RemoteUserAuthenticator] assignUserToRoles Skipping xxxx to role confluence-users - already a member
2012-02-07 16:25:18,387 DEBUG [TP-Processor12] [confluence.authentication.shibboleth.RemoteUserAuthenticator] assignUserToRoles Assigning xxxx to role doit-employees
2012-02-07 16:25:18,388 ERROR [TP-Processor12] [confluence.authentication.shibboleth.RemoteUserAuthenticator] doInTransaction Failed to add user xxxx to group 'doit-employees'!
com.atlassian.crowd.exception.embedded.InvalidGroupException: com.atlassian.crowd.exception.InvalidGroupException: Group already exists
	at com.atlassian.crowd.embedded.core.CrowdServiceImpl.addGroup(CrowdServiceImpl.java:500)
	at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator$2.doInTransaction(RemoteUserAuthenticator.java:1135)
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:128)
	at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.addUserToGroup(RemoteUserAuthenticator.java:1132)
	at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.assignUserToRoles(RemoteUserAuthenticator.java:252)
	at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.updateGroupMemberships(RemoteUserAuthenticator.java:791)
	at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.getUser(RemoteUserAuthenticator.java:891)
	at com.atlassian.seraph.auth.AbstractAuthenticator.getUser(AbstractAuthenticator.java:45)
	at com.atlassian.seraph.filter.BaseLoginFilter$SecurityHttpRequestWrapper.getUserPrincipal(BaseLoginFilter.java:236)
	at com.atlassian.seraph.filter.BaseLoginFilter$SecurityHttpRequestWrapper.getRemoteUser(BaseLoginFilter.java:224)
</pre>
</div></div>
         </div>
    </div>
</div>
                     <div id="comment-54913" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54913&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54913" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54913_verbose" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54913_verbose subText'><span class='date user-tz' title='07/Feb/12 2:46 PM'><time datetime='2012-02-07T14:46-0800'>07/Feb/12 2:46 PM</time></span></span>  </div>
        <div class="action-body flooded"><p>group creation failing</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54913_concise" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54913_concise subText'><span class='date user-tz' title='07/Feb/12 2:46 PM'><time datetime='2012-02-07T14:46-0800'>07/Feb/12 2:46 PM</time></span></span>               group creation failing         </div>
    </div>
</div>
                     <div id="comment-54914" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54914&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54914" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
                                            
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54914_verbose" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54914_verbose subText'><span class='date user-tz' title='07/Feb/12 2:48 PM'><time datetime='2012-02-07T14:48-0800'>07/Feb/12 2:48 PM</time></span></span>   - <span class="redText subText" title="John Hare - 07/Feb/12 2:50 PM">edited</span> </div>
        <div class="action-body flooded"><p>Attaching file: group_creation_in_2.1.8.log </p>

<p>This is a full log of login attempt where group creation is failing. <br/>
Related to previous comment about eduWisconsinUDDS value mapping to groups.</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
                                            
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54914_concise" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54914_concise subText'><span class='date user-tz' title='07/Feb/12 2:48 PM'><time datetime='2012-02-07T14:48-0800'>07/Feb/12 2:48 PM</time></span></span>   - <span class="redText subText" title="John Hare - 07/Feb/12 2:50 PM">edited</span>              Attaching file: group_creation_in_2.1.8.log 

This is a full log of login attempt where group creation is failing. 
Related to previous comment about eduWisconsinUDDS value mapping to groups.         </div>
    </div>
</div>
                     <div id="comment-54947" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54947&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54947" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
                                            
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54947_verbose" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_54947_verbose subText'><span class='date user-tz' title='08/Feb/12 6:33 AM'><time datetime='2012-02-08T06:33-0800'>08/Feb/12 6:33 AM</time></span></span>   - <span class="redText subText" title="Gary S. Weaver - 08/Feb/12 7:00 AM">edited</span> </div>
        <div class="action-body flooded"><p>John,</p>

<p>Thanks! Just found some serious related bugs, so will fix in this ticket even though this should be a separate ticket. (I'm in a hurry unfortunately.)</p>

<p>Thanks,<br/>
Gary</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
                                            
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54947_concise" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_54947_concise subText'><span class='date user-tz' title='08/Feb/12 6:33 AM'><time datetime='2012-02-08T06:33-0800'>08/Feb/12 6:33 AM</time></span></span>   - <span class="redText subText" title="Gary S. Weaver - 08/Feb/12 7:00 AM">edited</span>              John,

Thanks! Just found some serious related bugs, so will fix in this ticket even though this should be a separate ticket. (I'm in a hurry unfortunately.)

Thanks,
Gary         </div>
    </div>
</div>
                     <div id="comment-54950" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54950&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54950" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54950_verbose" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_54950_verbose subText'><span class='date user-tz' title='08/Feb/12 7:16 AM'><time datetime='2012-02-08T07:16-0800'>08/Feb/12 7:16 AM</time></span></span>  </div>
        <div class="action-body flooded"><p>Finally fixed? <a href="https://studio.plugins.atlassian.com/svn/SHBL/releases/remoteUserAuth-2.1.9.jar">https://studio.plugins.atlassian.com/svn/SHBL/releases/remoteUserAuth-2.1.9.jar</a></p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54950_concise" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_54950_concise subText'><span class='date user-tz' title='08/Feb/12 7:16 AM'><time datetime='2012-02-08T07:16-0800'>08/Feb/12 7:16 AM</time></span></span>               Finally fixed? <a href="https://studio.plugins.atlassian.com/svn/SHBL/releases/remoteUserAuth-2.1.9.jar">https://studio.plugins.atlassian.com/svn/SHBL/releases/remoteUserAuth-2.1.9.jar</a>         </div>
    </div>
</div>
                     <div id="comment-54954" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-55?focusedCommentId=54954&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-54954" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54954_verbose" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54954_verbose subText'><span class='date user-tz' title='08/Feb/12 7:30 AM'><time datetime='2012-02-08T07:30-0800'>08/Feb/12 7:30 AM</time></span></span>  </div>
        <div class="action-body flooded"><p>Thanks, I'm out of the office today so will give 2.1.9 a try tomorrow. Will open a separate ticket for new issues. My appologies for stringing it all into this one. Appreciate your sticking with me on all these tweaks!</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="john.hare@doit.wisc.edu" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_54954_concise" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
 added a comment  - <span class='commentdate_54954_concise subText'><span class='date user-tz' title='08/Feb/12 7:30 AM'><time datetime='2012-02-08T07:30-0800'>08/Feb/12 7:30 AM</time></span></span>               Thanks, I'm out of the office today so will give 2.1.9 a try tomorrow. Will open a separate ticket for new issues. My appologies for stringing it all into this one. Appreciate your sticking with me on all these tweaks!         </div>
    </div>
</div>
                 </div>
</div></div>
                

            </div>
        </div>

        <div class="column" id="secondary">
            <div class="content">
                
                    <div class='module toggle-wrap' id='peoplemodule'><div id='peoplemodule_heading' class='mod-header'><h3 class='toggle-title'>People</h3></div><div class='mod-content'><ul class="item-details" id="peopledetails">
    <li class="people-details">
                <dl>
            <dt>Assignee:</dt>
            <dd id="assignee-val">
                        <a class="user-hover" rel="gswduke" id="issue_summary_assignee_gswduke" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
            </dd>
        </dl>
                        <dl>
            <dt>Reporter:</dt>
            <dd id="reporter-val">
                        <a class="user-hover" rel="john.hare@doit.wisc.edu" id="issue_summary_reporter_john.hare@doit.wisc.edu" href="/secure/ViewProfile.jspa?name=john.hare%40doit.wisc.edu">John Hare</a>
            </dd>
        </dl>
                    </li>
</ul>
<div id="votes-val">
                <span id="vote-label" title="You cannot vote or change your vote on resolved issues."><span class="icon icon-vote-disabled"></span><span class="action-text">Vote</span></span>
    
                (<span id="vote-data">0</span>)
    </div>
<div id="watchers-val">
            <span id="watch-label" title="You have to be logged in to watch an issue."><span class="icon icon-watch-disabled"></span>Watch</span>
    
        
            (<span id="watcher-data">0</span>)
    </div>
</div></div><div class='module toggle-wrap' id='datesmodule'><div id='datesmodule_heading' class='mod-header'><h3 class='toggle-title'>Dates</h3></div><div class='mod-content'><ul class="item-details">
    <li>
            <dl class="dates">
            <dt>Created:</dt>
            <dd id="create-date" class="date user-tz"  title="05/Feb/12 3:58 AM" >
                        <time datetime="2012-02-05T03:58-0800">05/Feb/12 3:58 AM</time></dd>                     </dd>
        </dl>
            <dl class="dates">
            <dt>Updated:</dt>
            <dd id="updated-date" class="date user-tz"  title="08/Feb/12 7:30 AM" >
                        <time datetime="2012-02-08T07:30-0800">08/Feb/12 7:30 AM</time></dd>                     </dd>
        </dl>
            <dl class="dates">
            <dt>Resolved:</dt>
            <dd id="resolved-date" class="date user-tz"  title="08/Feb/12 6:33 AM" >
                        <time datetime="2012-02-08T06:33-0800">08/Feb/12 6:33 AM</time></dd>                     </dd>
        </dl>
        </li>
</ul>
</div></div>
                

            </div>
        </div>
        
            
                
            
        

    </div>
</div>










<div id="studio-footer" class="footer" style="width:100%; padding:0 0 25px 0;">
    <div id="poweredby">
        <p>
            Powered by <a href="http://www.atlassian.com/hosted/studio">JIRA Studio</a> <span id="studioVersion">107.6 r5978538efb935b5414d28000aa78b98bedfcae46</span> |
            <a href="http://www.atlassian.com/hosted/terms.jsp">Terms of Use</a> |
            <a href="http://studio.atlassian.com/browse/JST">Bug/feature request</a> |
            <a href="https://support.atlassian.com/secure/CreateIssueDetails!init.jspa?summary=Your+summary+here...&amp;issuetype=1&amp;priority=3&amp;description=Please+describe+your+problem+here%3A%0A%0A%0AProblem+reported+from+URL%3A+https%3A%2F%2Fstudio.plugins.atlassian.com%2Fbrowse%2FSHBL-55&amp;customfield_10440=https%3A%2F%2Fstudio.plugins.atlassian.com&amp;pid=10140&amp;">Request Support</a> |
            <a href="http://confluence.atlassian.com/display/JIRASTUDIO" target="help_JIRASTUDIO" rel="nofollow">Help/Documentation</a> |
            <a href="http://blogs.atlassian.com/devtools/studio">JIRA Studio Blog</a> |
            <a href="http://twitter.com/jirastudio">Twitter @JIRAStudio</a>
        </p>
    </div>
</div>

<script type="text/javascript" charset="utf-8" src="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/js/contentnamesearch.js"></script>
<script type="text/javascript" charset="utf-8" src="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/js/split_button.js"></script>
<script type="text/javascript" charset="utf-8" src="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/js/userstatus.js"></script>

            <script type="text/javascript" charset="utf-8" src="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/js/safe-ajax.js"></script>
    
<script type="text/javascript">
    // This is the app specific data that the shared js expects
    studioData = {"jiraUrl" : "https://studio.plugins.atlassian.com"};

            document.cookie = "studio.project.rec.used.cookie=" + escape("SHBL-_-") + "; Max-Age=31536000; path=/;";
    
    // Google analytics
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-6032469-30");
    pageTracker._trackPageview();
    } catch(err) {}
</script>

<form id="jira_request_timing_info" class="dont-default-focus" >
	<fieldset class="parameters hidden">
		<input type="hidden" title="jira.request.start.millis" value="1358699928295" />
		<input type="hidden" title="jira.request.server.time" value="7338" />
		<input type="hidden" title="jira.request.id" value="518x7330424x1" />
		<input type="hidden" title="jira.session.expiry.time" value="-" />
		<input type="hidden" title="jira.session.expiry.in.mins" value="-" />
		<input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="2" />
	</fieldset>
</form>
<!--
	                 REQUEST ID : 518x7330424x1
	          REQUEST TIMESTAMP : [20/Jan/2013:08:38:48 -0800]
	               REQUEST TIME : 7.3380
	                 ASESSIONID : ar4a0l
	        CONCURRENT REQUESTS : 2
-->
</body>
</html>
