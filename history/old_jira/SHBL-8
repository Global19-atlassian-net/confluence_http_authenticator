



<!DOCTYPE html>















<html>
<head>
    <title>[#SHBL-8] Shibboleth Authenticator not assigning users to groups in Confluence 2.9.2 - Atlassian Plugins JIRA Studio </title>

    <meta content="general" name="decorator" />
    <link rel="index" href="/secure/IssueNavigator.jspa" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="-1" />
    

    
<meta id="atlassian-token" name="atlassian-token" content="A5G2-B7UC-JLK8-Z7KY|8c63f47c0bac8850f6b78220829494275c4c2fca|lout">


    <link rel="shortcut icon" href="/s/en_US-31q2po/650/149/_/favicon.ico">
    <link rel="icon" type="image/png" href="/s/en_US-31q2po/650/149/_/images/icons/favicon.png">

    
    <script type="text/javascript">var contextPath = '';</script>
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/1/_/download/superbatch/css/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/1/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if IE 9]>
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/1/_/download/superbatch/css/batch.css?conditionalComment=IE+9" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/1/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/1.0/_/download/batch/jira.webresources:jquery-fancybox/jira.webresources:jquery-fancybox.css" media="all">
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/1.0/_/download/batch/jira.webresources:autocomplete/jira.webresources:autocomplete.css" media="all">
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/1.0/_/download/batch/jira.webresources:global-static/jira.webresources:global-static.css" media="all">
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/1.0/_/download/batch/jira.webresources:global-static/jira.webresources:global-static.css?media=print" media="print">
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/5.7/_/download/batch/com.pyxis.greenhopper.jira:gh-ranking/com.pyxis.greenhopper.jira:gh-ranking.css" media="all">
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/1.0.6/_/download/batch/com.atlassian.plugin.atlassian-feedback-plugin:feedback/com.atlassian.plugin.atlassian-feedback-plugin:feedback.css" media="all">
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/0.15.4/_/download/batch/com.atlassian.jira.plugins.jira-bitbucket-connector-plugin:resources/com.atlassian.jira.plugins.jira-bitbucket-connector-plugin:resources.css" media="all">
<link type="text/css" rel="stylesheet" href="/s/en_US-31q2po/650/149/4.4-studio-rc3/_/download/batch/com.atlassian.jira.jira-admin-quicknav-plugin:admin-quicksearch/com.atlassian.jira.jira-admin-quicknav-plugin:admin-quicksearch.css" media="all">
<script type="text/javascript" src="/s/en_US-31q2po/650/149/1/_/download/superbatch/js/batch.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/1.0/_/download/batch/jira.webresources:jquery-fancybox/jira.webresources:jquery-fancybox.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/1.0/_/download/batch/jira.webresources:calendar/jira.webresources:calendar.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/1.0/_/download/batch/jira.webresources:viewissue/jira.webresources:viewissue.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/1.0/_/download/batch/jira.webresources:autocomplete/jira.webresources:autocomplete.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/1.0/_/download/batch/jira.webresources:jira-fields/jira.webresources:jira-fields.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/5.7/_/download/batch/com.pyxis.greenhopper.jira:gh-ranking/com.pyxis.greenhopper.jira:gh-ranking.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/5.7/_/download/batch/com.pyxis.greenhopper.jira:gh-globalkeyboardshortcuts/com.pyxis.greenhopper.jira:gh-globalkeyboardshortcuts.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/1.0.6/_/download/batch/com.atlassian.plugin.atlassian-feedback-plugin:feedback/com.atlassian.plugin.atlassian-feedback-plugin:feedback.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/0.4/_/download/batch/com.atlassian.jira.plugins.jira-github-connector-plugin:resources/com.atlassian.jira.plugins.jira-github-connector-plugin:resources.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/0.15.4/_/download/batch/com.atlassian.jira.plugins.jira-bitbucket-connector-plugin:resources/com.atlassian.jira.plugins.jira-bitbucket-connector-plugin:resources.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/4.4-studio-rc3/_/download/batch/com.atlassian.jira.jira-soy-plugin:soy-deps/com.atlassian.jira.jira-soy-plugin:soy-deps.js" ></script>
<script type="text/javascript" src="/s/en_US-31q2po/650/149/4.4-studio-rc3/_/download/batch/com.atlassian.jira.jira-admin-quicknav-plugin:admin-quicksearch/com.atlassian.jira.jira-admin-quicknav-plugin:admin-quicksearch.js" ></script>

    
        <script type="text/javascript" src="/rest/api/1.0/shortcuts/650/2c704f3b1c272597f28d679bb85da011/shortcuts.js?context=issueaction&amp;context=issuenavigation"></script>
    
    <link rel="search" type="application/opensearchdescription+xml" href="/osd.jsp" title="Atlassian Plugins JIRA Studio"/>
</head>



















<body id="jira" class="nl type-ab stalker sn">










<link rel="stylesheet" type="text/css" href="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/css/menu.css">
<link rel="stylesheet" type="text/css" href="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/css/navbar.css">
<link rel="stylesheet" type="text/css" href="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/css/dialog.css">
<!--[if IE]>
<link rel="stylesheet" type="text/css" href="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/css/dialog-ie.css">
<![endif]-->
<!--[if lt IE 9]>
<link rel="stylesheet" type="text/css" href="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/css/navbar-ie.css">
<![endif]-->
<!--[if IE 9]>
<link rel="stylesheet" type="text/css" href="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/css/navbar-ie9.css">
<![endif]-->
<link rel="stylesheet" type="text/css" href="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/css/userstatus.css">
<link rel="stylesheet" type="text/css" href="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_admin_styles/css/studioadmin.css">
<link rel="stylesheet" type="text/css" href="/plugins/servlet/studio/dynamiccss/studio-colors-css.css">
<link rel="stylesheet" type="text/css" href="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.theme.jira:studio_jira_resources/css/studio-jira-theme-override.css">

<div id="header" style="display:none">
</div>
<div class="studio-header" id="studio-header">

	<meta id="application-base-url" name="application-base-url" content="https://studio.plugins.atlassian.com"/>
<meta id="studio-context-path" name="studio-context-path" content=""/>
<meta id="jira-base-url" name="jira-base-url" content="https://studio.plugins.atlassian.com"/>
<meta id="confluence-base-url" name="confluence-base-url" content="https://studio.plugins.atlassian.com/wiki"/>

<div class="header-first-level">
    <div class="first-level-overlay">
        <div id="studio-logo">
            <a href="https://studio.plugins.atlassian.com/secure/Dashboard.jspa" class="logolink"><img src="https://studio.plugins.atlassian.com/download/resources/com.atlassian.studio.static:studio_images/images/StudioLogo.png" border="0" alt="Atlassian Plugins JIRA Studio"></a>
        </div>

        <div class="top-level-container">

            <div class="nav-dropdowns">
                <div id="studio-project-menu" class="project-menu">
	<ul class="ajs-menu-bar">
    	<li class="normal ajs-menu-item">
                        			<a class="user trigger ajs-menu-title" href="#"><span><span> Confluence Shibboleth Authenticator </span></span></a>

			<div class="ajs-drop-down hidden">
    			<ul class="first">

					                		                                                                                                                <li><a href="/browse/CNET" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=10979&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">.NET Authenticator with Single Sign-O...</span></a></li>
					                        <li><a href="/browse/ATTT" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=11825&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">@ Time Tracker</span></a></li>
					                        <li><a href="/browse/CONFABAPPLUGIN" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=10982&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">ABAP Code-Formatter</span></a></li>
					                        <li><a href="/browse/ABAP" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=11605&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">ABAP Syntax Highlighter</span></a></li>
					                        <li><a href="/browse/APRV" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=10360&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Ad hoc Workflows</span></a></li>
					                        <li><a href="/browse/ADHOC" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=10931&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Adhoc Builder - Deployment Tool</span></a></li>
					                        <li><a href="/browse/AALOG" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=11604&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Admin Activity Logger</span></a></li>
					                        <li><a href="/browse/ATD" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=11521&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">After the Deadline</span></a></li>
					                        <li><a href="/browse/BAACL" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=11551&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Agent ACL</span></a></li>
					                        <li><a href="/browse/AAS" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=10930&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Agile Application Stack</span></a></li>
					                        <li><a href="/browse/SPARTEZASCP" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=11123&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Agile Scrum Cards Print</span></a></li>
					                        <li><a href="/browse/CAGL" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=10951&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Agile Toolkit Plugin</span></a></li>
					                        <li><a href="/browse/JAVT" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=11031&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Agile Velocity Tracking plugin</span></a></li>
					                        <li><a href="/browse/ALFRES" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=10933&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Alfresco Crowd Integration module</span></a></li>
					                        <li><a href="/browse/ALFCON" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=11320&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Alfresco to Confluence Connector</span></a></li>
					                        <li><a href="/browse/ACCF" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=11371&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">All Comments Custom Field Type</span></a></li>
					                        <li><a href="/browse/CAE" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=10950&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Archive Extractor Plugin</span></a></li>
					                        <li><a href="/browse/STRM" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=10570&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Atlassian Activity Stream Plugin</span></a></li>
					                        <li><a href="/browse/ACLI" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=10882&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Atlassian Command Line Interface</span></a></li>
					                        <li><a href="/browse/PLE" style="background-image:url(https://studio.plugins.atlassian.com/secure/projectavatar?pid=11107&amp;avatarId=10011&amp;size=small);"><span class="ds-project-name">Atlassian Connector for Eclipse</span></a></li>
										                                            <li id="ds-more"><a href="https://studio.plugins.atlassian.com/secure/BrowseProjects.jspa?selectedCategory=all" class="more-projects"><span>View All Projects</span></a></li>
					
				</ul>
    		</div>
    	</li>
    </ul>
</div>	


                
	    <div id="studio-user-menu-container">
        <a class="login-link" href="/login.jsp?os_destination=%2Fbrowse%2FSHBL-8">Log In</a>
    </div>
    
            </div> <!-- /nav-dropdowns -->

            <div class="navigation-tabs studio-menu">
                
<ul id="studio-tabs">
			<li class="current"><a href="/browse/SHBL">Issues</a></li>
			<li><a href="https://studio.plugins.atlassian.com/wiki/display/SHBL">Wiki</a></li>
			<li><a href="https://studio.plugins.atlassian.com/source/browse/SHBL">Source</a></li>
			<li><a href="https://studio.plugins.atlassian.com/source/cru/?filter=custom&project=CR-SHBL">Reviews</a></li>
			<li><a href="https://studio.plugins.atlassian.com/builds/browse/SHBL">Builds</a></li>
	</ul>

            </div>

        </div> <!-- /top-level-container -->
    </div>  <!-- /first-level-overlay -->
</div> <!-- /header-first-level -->


    <div id="header-bottom">

        <div class="second-level-nav studio-menu">

                            
                
<ul id="main-nav" class="menu-bar standard-menu-bar">
                        <li class="aui-dd-parent lazy  ">
                    <a class="lnk"
                href="/secure/Dashboard.jspa"
                 id="home_link"                 accessKey="h"                 title="View your current Dashboard"                >Dashboards</a>

                    <span class="drop-wrap">
            <a class="drop aui-dd-link"
                                    id="home_link_drop"
                    rel="home_link"
                    accessKey="d"
                    title="Access more options (Alt+d)"
                                href="#"><span>Access more options (Alt+d)</span></a></span>
                </li>
                        <li class="aui-dd-parent lazy  selected  ">
                    <a class="lnk"
                href="/secure/IssueNavigator.jspa"
                 id="find_link"                 accessKey="f"                 title="View your current filter"                >Issues</a>

                    <span class="drop-wrap">
            <a class="drop aui-dd-link"
                                    id="find_link_drop"
                    rel="find_link"
                    accessKey="i"
                    title="Access more options (Alt+i)"
                                href="#"><span>Access more options (Alt+i)</span></a></span>
                </li>
                        <li class="aui-dd-parent nonlazy  ">
                    <a class="lnk"
                href="/secure/GreenHopper.jspa"
                 id="greenhopper_menu"                                 title="Manage your project with GreenHopper"                >Agile</a>

                                                                                                            <span class="drop-wrap">
                            <a class="drop aui-dd-link"
                                                                    id="greenhopper_menu_drop"
                                    accessKey="g"
                                    rel="greenhopper_menu"
                                    title="Access more options (Alt+g)"
                                                                href="#"><span>Access more options</span></a></span>
                            <div class="aui-list hidden">
                                                
                            <ul id="greenhopper_menu_dropdown" class="aui-list-section aui-first   aui-last  ">
                                                                    <li class="aui-list-item"><a
                                         id="planningboard-mlink"                                         class="aui-list-item-link   "
                                                                                                                        href="/secure/VersionBoard.jspa">Planning Board</a></li>
                                                                    <li class="aui-list-item"><a
                                         id="taskboard-mlink"                                         class="aui-list-item-link   "
                                                                                                                        href="/secure/TaskBoard.jspa">Task Board</a></li>
                                                                    <li class="aui-list-item"><a
                                         id="chartboard-mlink"                                         class="aui-list-item-link   "
                                                                                                                        href="/secure/ChartBoard.jspa">Chart Board</a></li>
                                                                    <li class="aui-list-item"><a
                                         id="releasedboard-mlink"                                         class="aui-list-item-link   "
                                                                                                                        href="/secure/ArchiveChartBoard.jspa">Released Board</a></li>
                                                            </ul>
                                                    </div>
                            </li>
    </ul>

                
            
        </div> <!-- /second-level-nav -->

        <div class="quick-action-search">

            
            <a id="keyshortscuthelp" class="item-link hidden" title="Get more information about JIRA's Keyboard Shortcuts"
               href="/secure/ViewKeyboardShortcuts!default.jspa">Keyboard Shortcuts</a>
                            <a id="browse_link" class="hidden" href="/browse/SHBL">Selected Project</a>
            
            <form id="quick-search" class="dont-default-focus userpref-form" method="get" action="https://studio.plugins.atlassian.com/secure/StudioSearch.jspa">
    <fieldset>
        <legend>Quick Search</legend>
		<input type="hidden" name="suggest-tracking" value="search" />
		<input type="hidden" name="quickSearch" value="true" />
        <input id="studio-quick-search-query" type="text" accessKey="q" autocomplete="off" name="query" size="25"/>
        <input id="quick-search-submit" type="submit" value="Search"/>
    </fieldset>
    <fieldset class="hidden parameters">
        <input type="hidden" id="quickSearchPlaceholder" value="Search">
    </fieldset>
</form>

        </div> <!-- /quick-action-search -->

    </div> <!-- /header-second-level -->

</div>










<fieldset class="hidden parameters">
    <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation.">
    <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation.  Please try to <a href='/login.jsp?os_destination=%2Fbrowse%2FSHBL-8'>log in</a> or <a href='/secure/Signup!default.jspa'>sign up</a> for an account.">
    <input type="hidden" title="ajaxUnauthorisedAlert" value="You are not authorised to perform this operation.  Please log in.">
    <input type="hidden" title="baseURL" value="https://studio.plugins.atlassian.com:443">
    <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted.  This may be a temporary glitch or the server may be down.">
    <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation.">
    <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser">
    <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown">

    <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost.">
    <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog.">
    <input type="hidden" title="keyType" value="Type">
    <input type="hidden" title="keyThen" value="then">
    <input type="hidden" title="dblClickToExpand" value="Double click to expand">
    <input type="hidden" title="actions" value="Actions">
    <input type="hidden" title="removeItem" value="Remove">
    <input type="hidden" title="workflow" value="Workflow">
    <input type="hidden" title="labelNew" value="New Label">
    <input type="hidden" title="enterIssueKey" value="Enter issue key">
    <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all">
    <input type="hidden" title="closelink" value="Close">
    <input type="hidden" title="dotOperations" value="Operations">
    <input type="hidden" title="dotLoading" value="Loading...">
    <input type="hidden" title="frotherSuggestions" value="Suggestions">
    <input type="hidden" title="frotherNomatches" value="No Matches">
    <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version.">
    <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component.">
    <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid.">
</fieldset>




<div class="alertHeader">
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-6032469-24");
pageTracker._trackPageview();
} catch(err) {}</script>

<script type="text/javascript" charset="utf-8">
  (function(){
    t = document.createElement('script');t.async=true;t.type ='text/javascript';
    t.src = ('https:' == document.location.protocol ? 'https://secure.' : 'http://api.') + 'tellthemwhen.com/api/v2/notices/9ffb4ac1f71.js';
    var s=document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(t,s);
  })();
</script>

<!-- <div id="TTWNotify" style="display:none"></div> -->

<div style="text-align: center; border: #C00; background-color: #FF6600; line-height: 2em">studio.plugins.atlassian.com will be decommissioned in early 2013. If you are a project maintainer, please email <a href="mailto:developer-relations@atlassian.com">Atlassian Developer Relations</a> if you require assistance to migrate your project off this server.</div>
</div>




<fieldset class="hidden parameters">
    <input type="hidden" id="viewMoreMsg" value="Click to view {0} more">
    <input type="hidden" id="hideMsg" value="Hide" >
    <input type="hidden" id="error-401" value="Cannot perform this operation. You are not logged in." >
    <input type="hidden" id="issueOpTitleUnvote" value="Remove vote for this issue" >
    <input type="hidden" id="issueOpTitleVote" value="Vote for this issue" >
    <input type="hidden" id="issueOpTitleWatch" value="Start watching this issue" >
    <input type="hidden" id="issueOpTitleUnwatch" value="Stop watching this issue" >
    <input type="hidden" id="issueOpUnvote" value="Remove Vote" >
    <input type="hidden" id="issueOpVote" value="Add Vote" >
    <input type="hidden" id="issueOpWatch" value="Watch Issue" >
    <input type="hidden" id="issueOpUnwatch" value="Stop Watching" >
    <input type="hidden" id="i18nVote" value="Vote" >
    <input type="hidden" id="i18nVoted" value="Voted" >
    <input type="hidden" id="i18nWatch" value="Watch" >
    <input type="hidden" id="i18nWatching" value="Watching" >
</fieldset>

<div id="stalker"  class="stalker">
    <div class="item-header">
    
        












<h1 class="item-name avatar" style="background-image:url(/secure/projectavatar?pid=10580&amp;avatarId=10011&amp;size=large)">
        
            <img id="project-avatar" alt="" class="project-avatar-48" height="48" src="/secure/projectavatar?pid=10580&amp;avatarId=10011&amp;size=large" width="48" />
        
        <span>Confluence Shibboleth Authenticator</span>
</h1>


<ul class="breadcrumbs">
    <li><a id="project-name-val" href="/browse/SHBL">Confluence Shibboleth Authenticator</a></li>
    
    <li><a id="key-val" rel="17357" href="/browse/SHBL-8">SHBL-8</a></li>
</ul>

<h2 id="issue_header_summary" class="item-summary"><a href="/browse/SHBL-8">Shibboleth Authenticator not assigning users to groups in Confluence 2.9.2</a></h2>

    
    </div>
    




    <div class="command-bar">
        <div class="ops-cont">
            <div class="ops-menus">
                
                
                    <ul id="opsbar-login" class="first ops">
                        <li id="ops-login" class="last">
                            <a id="ops-login-lnk" class="button first last" href="/login.jsp?os_destination=%2Fbrowse%2FSHBL-8">Log In</a>
                        </li>
                    </ul>
                
                
                    
                        
                    
                
                    
                        
                    
                
                
                    
                        <ul class="ops" id="view-drop">
                            <li>
                                <div class="aui-dd-parent">
                                    <a href="#" title="View this issue in another format" class="drop lnk aui-dd-link standard icon-views"><span>Views</span></a>
                                        <div class="aui-list hidden">
                                        <ul class="aui-first aui-last aui-list-section">
                                            
                                                <li class="aui-list-item">
                                                    <a class="aui-list-item-link" rel="nofollow" href="/si/jira.issueviews:issue-xml/SHBL-8/SHBL-8.xml">XML</a>
                                                </li>
                                            
                                                <li class="aui-list-item">
                                                    <a class="aui-list-item-link" rel="nofollow" href="/si/jira.issueviews:issue-word/SHBL-8/SHBL-8.doc">Word</a>
                                                </li>
                                            
                                                <li class="aui-list-item">
                                                    <a class="aui-list-item-link" rel="nofollow" href="/si/jira.issueviews:issue-html/SHBL-8/SHBL-8.html">Printable</a>
                                                </li>
                                            
                                        </ul>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    
                
            </div>
        </div>
    </div>          


    <div class="btm"></div>
</div>
<div id="main-content">
    <div class="active-area">
        <div class="column" id="primary">
            <div class="content">
                
                
                
                

                    <div id="details-module" class="module toggle-wrap">
                        <div class="mod-header">
                            <h3 class="toggle-title">Details</h3>
                        </div>
                        <div class="mod-content">
                            <ul id="issuedetails" class="property-list two-cols">
    <li class="item">
        <div class="wrap">
            <strong class="name">Type:</strong>
            <span id="type-val" class="value">
                                                        <img alt="Bug" height="16" src="/images/icons/bug.gif" title="Bug - A problem which impairs or prevents the functions of the product." width="16" />
             Bug
            </span>
        </div>
    </li>
    <li class="item item-right">
        <div class="wrap">
            <strong class="name">Status:</strong>
            <span id="status-val" class="value">
                                                        <img alt="Resolved" height="16" src="/images/icons/status_resolved.gif" title="Resolved - A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed." width="16" />
             Resolved
            </span>
                    </div>
    </li>
            <li class="item">
            <div class="wrap">
                <strong class="name">Priority:</strong>
                <span id="priority-val" class="value">
                                                                <img alt="Blocker" height="16" src="/images/icons/priority_blocker.gif" title="Blocker - Blocks development and/or testing work, production could not run." width="16" />
             Blocker
                </span>
            </div>
        </li>
                                <li class="item item-right">
            <div class="wrap">
                <strong class="name">Resolution:</strong>
                <span id="resolution-val" class="value resolved" >
                                         Fixed
                                </span>
            </div>
        </li>
                <li class="item">
            <div class="wrap">
                <strong class="name">Affects Version/s:</strong>
                <span id="versions-val" class="value">
                                            <span class="shorten" id="versions-field">
                                                            <span title="1.2 Changes made by Bruc Liong of the Macquarie E-Learning Centre Of Excellence (MELCOE) to allow optional mapping of the values of 0-to-many HTTP Headers (fed by shib attributes) to Confluence group names (see properties file for how to do this). Changes made by Gary Weaver of Duke University to refactor config loading, constants, utility method, and added configuration VO.">1.2</span>                                                    </span>
                                    </span>
            </div>
        </li>
                <li class="item item-right">
            <div class="wrap">
                <strong class="name">Fix Version/s:</strong>
                <span id="fixfor-val" class="value">
                                            <span class="shorten" id="fixVersions-field">
                                                            <a href="/browse/SHBL/fixforversion/12115" title="1.3 RELEASE RETRACTED. SHBL-8 fix had bug, subsequently fixed in SHBL-9 for 1.3.1. Changes made by Juha Ojaluoma for SHBL-5 to convert full name to UTF-8. Changes made by Gary Weaver and Bruc Liong to convert all header values to UTF-8. Changes made by Gary Weaver for SHBL-7 to add ability to handle multiple headers. Changes made Vladimir Mencl for SHBL-8 to fix issue with adding users to groups noticed in Confluence 2.9.2.Changes made by Gary Weaver to use BSD open-source license instead of Apache open-source license. Changes made by Gary Weaver to mavenize project and refactor. Should work in prior versions (Confluence 2.3+), but needs testing. Tested in Confluence 2.9.2. ">1.3</a>                                                    </span>
                                    </span>
            </div>
        </li>
                <li class="item">
            <div class="wrap">
                <strong class="name">Component/s:</strong>
                <span id="components-val" class="value">
                                            None
                                    </span>
            </div>
        </li>
                    <li class="item full-width">
            <div class="wrap" id="wrap-labels">
                <strong class="name">Labels:</strong>
                    <div class="labels-wrap value">
            <span class="labels" id="labels-17357-value">None</span>
                </div>
            </div>
        </li>
                <li class="item full-width">
            <div class="wrap">
                <strong class="name">Environment:</strong>
                <div id="environment-val" class="value">
                                  RHEL5 running kernel 2.6.18-92.1.18.el5.i686.<br/>
Java: Sun JDK 1.6.0_10<br/>
Confluence 2.9.2
      
                </div>
            </div>
        </li>
    </ul>


                            
                                

<div id="customfieldmodule">
    

    
    
    <ul id="tabCellPane1" class="property-list">
        
        
            
                
                
                    <li id="rowForcustomfield_10061" class="item">
                        <div class="wrap">
                            <strong title="Internal Complexity" class="name">Internal Complexity:</strong>
                            <div id="customfield_10061-val" class="value type-select">
                                 Unknown

                            </div>
                        </div>
                    </li>
                
            
        
            
                
                
                    <li id="rowForcustomfield_10060" class="item">
                        <div class="wrap">
                            <strong title="Internal Value" class="name">Internal Value:</strong>
                            <div id="customfield_10060-val" class="value type-select">
                                 Unknown

                            </div>
                        </div>
                    </li>
                
            
        
            
                
                
                    <li id="rowForcustomfield_10082" class="item">
                        <div class="wrap">
                            <strong title="Rank" class="name">Rank:</strong>
                            <div id="customfield_10082-val" class="value type-greenhopper-ranking">
                                
<div id="RankField_customfield_10082view">	<span id="RankValue_customfield_10082view">Issue can not be ranked.</span>&nbsp;
			<span id="RankPage_customfield_10082view" class="gh-rankpage gh-jira-rankpage"></span>
</div>

                            </div>
                        </div>
                    </li>
                
            
        
    </ul>
    
</div>

                            
                        </div>
                    </div>

                    




<div id="descriptionmodule" class="module toggle-wrap">
    <div class="mod-header">
        <h3 class="toggle-title">Description</h3>
    </div>
    <div id="issue-description" class="mod-content">
        
<p>I have a problem with the Shibboleth Authenticator: it is not assigning users to groups in Confluence 2.9.2.</p>

<p>I got the module working on a test system with Confluence 2.9, but I'm<br/>
having a problem with the plugin on a planned production system running<br/>
Confluence 2.9.2.</p>

<p>New users are not added to the group confluence-users - and thus don't get<br/>
any permissions assigned.</p>

<p>In the logs, I could find the message:</p>

<p>assignUserToRoles Attempted to add user id:360450 name:vme28@canterbury.ac.nz fullName:Vladimir Mencl email:vladimir.mencl@canterbury.ac.nz created:2008-11-28 14:57:09.303 to role confluence-users but the role does not exist.</p>

<p>complaining that the group does not exist - but it does.</p>


<p>I have done some tests: I have created group "confluence-test" and changed the default.roles<br/>
setting (in remoteUserAuthenticator.properties) to confluence-test - and<br/>
got the same message for the new group as well.</p>

<p>&gt; 2008-12-02 11:45:15,124 ERROR <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor3">TP-Processor3</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> assignUserToRoles Attempted to add user id:360450 name:vme28@canterbury.ac.nz fullName:Vladimir Mencl email:vladimir.mencl@canterbury.ac.nz created:2008-11-28 14:57:09.303 to role confluence-test but the role does not exist.</p>


<p>I have also tried using dynamicroles to see if that would work: creating a group "confluence-dyntest" and assigning anyone coming in via my local IdP to this group:</p>

<p>header.dynamicroles.attributenames=Shib-Identity-Provider<br/>
header.dynamicroles.urn\:mace\:federation.org.au\:testfed\:canterbury.ac.nz=confluence-dyntest</p>

<p>But I got the same result:</p>

<p>2008-12-02 11:52:33,446 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor3">TP-Processor3</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> assignUserToRoles Assigning roles to user vme28@canterbury.ac.nz<br/>
2008-12-02 11:52:33,447 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor3">TP-Processor3</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> assignUserToRoles Assigning vme28@canterbury.ac.nz to role confluence-dyntest<br/>
2008-12-02 11:52:33,449 ERROR <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor3">TP-Processor3</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> assignUserToRoles Attempted to add user id:360450 name:vme28@canterbury.ac.nz fullName:Vladimir Mencl email:vladimir.mencl@canterbury.ac.nz created:2008-11-28 14:57:09.303 to role confluence-dyntest but the role does not exist.</p>

<p>I was about to deploy the product for use by the university community - and this appears to be a showstopper.  Any help?  Should I deploy Confluence 2.9 instead?</p>

<p>Thanks a lot in advance.</p>


<p>Cheers,<br/>
Vladimir</p>

<p>----------------------------------------------------------------<br/>
Vladimir Mencl, Ph.D.<br/>
Advanced Systems Technology Developer<br/>
Information Technology Services<br/>
University of Canterbury<br/>
Christchurch, New Zealand</p>

<p>vladimir.mencl@canterbury.ac.nz<br/>
(021) 997-352 (03) 364 2987, ext. 3012<br/>
FAX: +64 3 364 2332</p>

<p>----------------------------------------------------------------</p>

<p>PS: Below is the debug log covering startup of Confluence and logging in<br/>
(with DEBUG log setting for edu.georgetown.middleware.confluence)</p>

<p>2008-12-02 10:52:51,954 INFO <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/main">main</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/com.atlassian.confluence.lifecycle">com.atlassian.confluence.lifecycle</a> contextInitialized Starting Confluence 2.9.2 (build #1419)<br/>
2008-12-02 10:53:16,769 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/main">main</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.ShibAuthConfigLoader">georgetown.middleware.confluence.ShibAuthConfigLoader</a> getShibAuthConfiguration Initializing authenticator using property file /remoteUserAuthenticator.properties<br/>
2008-12-02 10:53:16,771 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/main">main</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.ShibAuthConfigLoader">georgetown.middleware.confluence.ShibAuthConfigLoader</a> getShibAuthConfiguration Setting create new users to true<br/>
2008-12-02 10:53:16,772 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/main">main</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.ShibAuthConfigLoader">georgetown.middleware.confluence.ShibAuthConfigLoader</a> getShibAuthConfiguration Setting update user information to true<br/>
2008-12-02 10:53:16,772 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/main">main</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.ShibAuthConfigLoader">georgetown.middleware.confluence.ShibAuthConfigLoader</a> getShibAuthConfiguration Setting update user roles to true<br/>
2008-12-02 10:53:16,774 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/main">main</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.ShibAuthConfigLoader">georgetown.middleware.confluence.ShibAuthConfigLoader</a> getShibAuthConfiguration Adding role confluence-users to list of default user roles<br/>
2008-12-02 10:53:16,774 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/main">main</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.ShibAuthConfigLoader">georgetown.middleware.confluence.ShibAuthConfigLoader</a> getShibAuthConfiguration HTTP Header that may contain user's full name set to: Shib-InetOrgPerson-displayName<br/>
2008-12-02 10:53:16,775 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/main">main</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.ShibAuthConfigLoader">georgetown.middleware.confluence.ShibAuthConfigLoader</a> getShibAuthConfiguration HTTP Header that may contain user's email address set to: Shib-InetOrgPerson-mail<br/>
2008-12-02 10:53:17,715 INFO <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/main">main</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/com.atlassian.confluence.lifecycle">com.atlassian.confluence.lifecycle</a> init Confluence is ready to serve<br/>
2008-12-02 10:53:36,719 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor3">TP-Processor3</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> getUser Request made to <a href="http://wiki.canterbury.ac.nz/">http://wiki.canterbury.ac.nz/</a> triggered this AuthN check<br/>
2008-12-02 10:53:36,730 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor3">TP-Processor3</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> getUser Remote user was null or empty, can not perform authentication<br/>
2008-12-02 10:53:36,733 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor3">TP-Processor3</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> getUser Request made to <a href="http://wiki.canterbury.ac.nz/">http://wiki.canterbury.ac.nz/</a> triggered this AuthN check<br/>
2008-12-02 10:53:36,734 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor3">TP-Processor3</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> getUser Remote user was null or empty, can not perform authentication<br/>
2008-12-02 10:53:36,875 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor2">TP-Processor2</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> getUser Request made to <a href="http://wiki.canterbury.ac.nz/homepage.action">http://wiki.canterbury.ac.nz/homepage.action</a> triggered this AuthN check<br/>
2008-12-02 10:53:36,878 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor2">TP-Processor2</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> getUser Remote user was null or empty, can not perform authentication<br/>
2008-12-02 10:53:36,879 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor2">TP-Processor2</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> getUser Request made to <a href="http://wiki.canterbury.ac.nz/homepage.action">http://wiki.canterbury.ac.nz/homepage.action</a> triggered this AuthN check<br/>
2008-12-02 10:53:36,880 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor2">TP-Processor2</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> getUser Remote user was null or empty, can not perform authentication<br/>
2008-12-02 10:53:36,882 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor2">TP-Processor2</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> getUser Request made to <a href="http://wiki.canterbury.ac.nz/homepage.action">http://wiki.canterbury.ac.nz/homepage.action</a> triggered this AuthN check<br/>
2008-12-02 10:53:36,883 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor2">TP-Processor2</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> getUser Remote user was null or empty, can not perform authentication<br/>
2008-12-02 10:53:37,555 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor2">TP-Processor2</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> getUser Request made to <a href="http://wiki.canterbury.ac.nz/homepage.action">http://wiki.canterbury.ac.nz/homepage.action</a> triggered this AuthN check<br/>
2008-12-02 10:53:37,557 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor2">TP-Processor2</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> getUser Remote user was null or empty, can not perform authentication<br/>
2008-12-02 10:53:37,557 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor2">TP-Processor2</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> getUser Request made to <a href="http://wiki.canterbury.ac.nz/homepage.action">http://wiki.canterbury.ac.nz/homepage.action</a> triggered this AuthN check<br/>
2008-12-02 10:53:37,558 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor2">TP-Processor2</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> getUser Remote user was null or empty, can not perform authentication<br/>
2008-12-02 10:53:37,580 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor2">TP-Processor2</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> getUser Request made to <a href="http://wiki.canterbury.ac.nz/homepage.action">http://wiki.canterbury.ac.nz/homepage.action</a> triggered this AuthN check<br/>
2008-12-02 10:53:37,589 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor2">TP-Processor2</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> getUser Remote user was null or empty, can not perform authentication<br/>
2008-12-02 10:53:46,526 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor1">TP-Processor1</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> getUser Request made to <a href="http://wiki.canterbury.ac.nz/homepage.action">http://wiki.canterbury.ac.nz/homepage.action</a> triggered this AuthN check<br/>
2008-12-02 10:53:46,528 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor1">TP-Processor1</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> getFullName Got fullName 'Vladimir Mencl' for header 'Shib-InetOrgPerson-displayName'<br/>
2008-12-02 10:53:46,528 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor1">TP-Processor1</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> getEmailAddress Got emailAddress 'vladimir.mencl@canterbury.ac.nz' for header 'Shib-InetOrgPerson-mail'<br/>
2008-12-02 10:53:46,529 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor1">TP-Processor1</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> getUser Getting user vme28@canterbury.ac.nz<br/>
2008-12-02 10:53:46,555 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor1">TP-Processor1</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> updateUser new user fullName is same as old one: 'Vladimir Mencl'<br/>
2008-12-02 10:53:46,556 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor1">TP-Processor1</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> updateUser new user emailAddress is same as old one: 'vladimir.mencl@canterbury.ac.nz'<br/>
2008-12-02 10:53:46,557 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor1">TP-Processor1</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> assignUserToRoles Assigning roles to user vme28@canterbury.ac.nz<br/>
2008-12-02 10:53:46,557 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor1">TP-Processor1</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> assignUserToRoles Assigning vme28@canterbury.ac.nz to role confluence-users<br/>
2008-12-02 10:53:46,568 ERROR <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor1">TP-Processor1</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> assignUserToRoles Attempted to add user id:360450 name:vme28@canterbury.ac.nz fullName:Vladimir Mencl email:vladimir.mencl@canterbury.ac.nz created:2008-11-28 14:57:09.303 to role confluence-users but the role does not exist.<br/>
2008-12-02 10:53:46,570 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor1">TP-Processor1</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> assignUserToRoles No roles specified, not adding any roles...<br/>
2008-12-02 10:53:46,570 DEBUG <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor1">TP-Processor1</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/georgetown.middleware.confluence.RemoteUserAuthenticator">georgetown.middleware.confluence.RemoteUserAuthenticator</a> getUser Logging in user vme28@canterbury.ac.nz</p>
    </div>
</div>





                    
                        






	<div id="attachmentmodule" class="module toggle-wrap">
		<div class="mod-header">
            <ul class="ops">
            
                <li class="drop" id="attachment-sorting-options">
                    <div class="aui-dd-parent">
                        <a href="#" id="attachment-sort-key-list" class="icon drop-menu aui-dropdown-trigger" title="More Options"><span>More Options</span></a>
                        <div class="aui-dropdown-content aui-list aui-list-checked">
                            <ul class="aui-list-section">
                                <li class="aui-list-item  aui-checked">
                                    <a id="attachment-sort-key-name" class="aui-list-item-link" rel="nofollow"
                                       href="/browse/SHBL-8?attachmentSortBy=fileName#attachmentmodule"
                                       title="Sort By Name">
                                        Sort By Name
                                    </a>
                                </li>
                                <li class="aui-list-item">
                                    <a id="attachment-sort-key-date" class="aui-list-item-link" rel="nofollow"
                                       href="/browse/SHBL-8?attachmentSortBy=dateTime#attachmentmodule"
                                       title="Sort By Date">
                                        Sort By Date
                                    </a>
                                </li>
                            </ul>
                            <ul class="aui-list-section " id="attachment-sort-direction-list">
                                <li class="aui-list-item aui-checked">
                                    <a id="attachment-sort-direction-asc" class="aui-list-item-link" rel="nofollow"
                                       href="/browse/SHBL-8?attachmentOrder=asc#attachmentmodule"
                                       title="Ascending">
                                        Ascending
                                    </a>
                                </li>
                                <li class="aui-list-item">
                                    <a id="attachment-sort-direction-desc" class="aui-list-item-link" rel="nofollow"
                                       href="/browse/SHBL-8?attachmentOrder=desc#attachmentmodule"
                                       title="Descending">
                                        Descending
                                    </a>
                                </li>
                            </ul>
                            
                                <ul class="aui-list-section aui-last">
                                    
                                        <li class="aui-list-item">
                                            <a id="aszip" href="/secure/attachmentzip/17357.zip"
                                               class="aui-list-item-link" title="Download all attachments as a ZIP file">
                                                Download All
                                            </a>
                                        </li>
                                    
                                    
                                </ul>
                            
                        </div>
                    </div>
                </li>
            </ul>
            <h3 class="toggle-title">Attachments</h3>
        </div>
        <div class="mod-content">
        
            <ol id="file_attachments" class="item-attachments">
            
                
                

                <li class="attachment-content ">
                    
                    
                        <div class="attachment-thumb">
                            <a href="/secure/attachment/12613/shibboleth-authenticator-addMembership-fix.diff">
                                

    
    
        <img src="/images/icons/attach/file.gif" height="16" width="16" border="0" alt="File">
    


                            </a>
                        </div>
                        <dl>
                            
                    <dt class="attachment-title">
                        <a href="/secure/attachment/12613/shibboleth-authenticator-addMembership-fix.diff"
                           title="Latest 02/Dec/08 10:45 PM - Vladimir Mencl">shibboleth-authenticator-addMembership-fix.diff
                        </a>
                    </dt>
                    <dd class="attachment-date">
                        02/Dec/08 10:45 PM</dd>
                    <dd class="attachment-size">
                        2 kB</dd>
                    <dd class="attachment-author">
                        Vladimir Mencl
                    </dd>
                
                        </dl>
                    
                </li>
            
            </ol>
    
        

        
        </div>
    </div>

    


                    
                
                
                    <div class='module toggle-wrap' id='linkingmodule'><div id='linkingmodule_heading' class='mod-header'><h3 class='toggle-title'>Issue Links</h3></div><div class='mod-content'>            <table class="aui issue-links links-outward aui-table-rowhover">
        <thead>
            <tr>
                <td colspan="5">
                    This issue <strong>duplicates</strong>:
                </td>
            </tr>
        </thead>
        <tbody>
                <tr>
            <td class="issuekey">
                <a href="/browse/SHBL-3" title="Default group add is failing with &quot;insufficient permissions&quot;"  class="resolution" >SHBL-3</a>
            </td>
            <td class="summary"> Default group add is failing with &quot;insufficient permissions&quot; </td>
            <td class="priority">
                                                <img src="/images/icons/priority_major.gif" height="16" width="16" border="0" align="absmiddle" alt="Major" title="Major - Major loss of function.">
                                </td>
            <td class="status">
                            <img src="/images/icons/status_resolved.gif" height="16" width="16" border="0" align="absmiddle" alt="Resolved" title="Resolved - A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">
                </td>
            <td class="actions">
                            </td>
        </tr>
                </tbody>
    </table>
            </div></div><div class='module toggle-wrap' id='activitymodule'><div id='activitymodule_heading' class='mod-header'><h3 class='toggle-title'>Activity</h3></div><div class='mod-content'>    <div class="tabwrap tabs2">
                    <div class="sortwrap">
                                    <a class="icon icon-sort-down" rel="nofollow" href="/browse/SHBL-8?actionOrder=desc#issue-tabs" title="Ascending order - Click to sort in descending order"><span>Ascending order - Click to sort in descending order</span></a>
                            </div>
                <ul id="issue-tabs" class="tabs horizontal">
                                    <li><a id="all-tabpanel" href="/browse/SHBL-8?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel#issue-tabs"><strong>All</strong></a></li>
                                                <li id="comment-tabpanel" class="active"><strong>Comments</strong></li>
                                                <li><a id="worklog-tabpanel" href="/browse/SHBL-8?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel#issue-tabs"><strong>Work Log</strong></a></li>
                                                <li><a id="changehistory-tabpanel" href="/browse/SHBL-8?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel#issue-tabs"><strong>History</strong></a></li>
                                                <li><a id="activity-stream-issue-tab" href="/browse/SHBL-8?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab#issue-tabs"><strong>Activity</strong></a></li>
                            </ul>
    </div>
    <div class="issuePanelContainer" id="issue_actions_container">
                        <div id="comment-21417" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-8?focusedCommentId=21417&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-21417" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="vladimir.mencl" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_21417_verbose" href="/secure/ViewProfile.jspa?name=vladimir.mencl">Vladimir Mencl</a>
 added a comment  - <span class='commentdate_21417_verbose subText'><span class='date user-tz' title='01/Dec/08 5:28 PM'><time datetime='2008-12-01T17:28-0800'>01/Dec/08 5:28 PM</time></span></span>  </div>
        <div class="action-body flooded"><p>Just looking into the source code:</p>

<p>                try {
                    group = userAccessor.getGroup(role);
                    userAccessor.addMembership(group, user);
                } catch (Throwable e) {
                    log.error("Attempted to add user " + user + " to role "
                              + role + " but the role does not exist.");
                }</p>

<p>The problem may be either with getGroup or with addMembership....</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="vladimir.mencl" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_21417_concise" href="/secure/ViewProfile.jspa?name=vladimir.mencl">Vladimir Mencl</a>
 added a comment  - <span class='commentdate_21417_concise subText'><span class='date user-tz' title='01/Dec/08 5:28 PM'><time datetime='2008-12-01T17:28-0800'>01/Dec/08 5:28 PM</time></span></span>               Just looking into the source code:

                try {
                    group = userAccessor.getGroup(role);
                    userAccessor.addMembership(group, user);
                } catch (Throwable e) {
                    log.error("Attempted to add user " + user + " to role "
                              + role + " but the role does not exist.");
                }

The problem may be either with getGroup or with addMembership....         </div>
    </div>
</div>
                     <div id="comment-21418" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-8?focusedCommentId=21418&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-21418" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="vladimir.mencl" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_21418_verbose" href="/secure/ViewProfile.jspa?name=vladimir.mencl">Vladimir Mencl</a>
 added a comment  - <span class='commentdate_21418_verbose subText'><span class='date user-tz' title='01/Dec/08 5:37 PM'><time datetime='2008-12-01T17:37-0800'>01/Dec/08 5:37 PM</time></span></span>  </div>
        <div class="action-body flooded"><p>Additional info on environment: Confluence is running against a Microsoft SQL Server 2008 database (in 2005 compatibility mode), with the jtds-1.2.2 JDBC driver.</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="vladimir.mencl" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_21418_concise" href="/secure/ViewProfile.jspa?name=vladimir.mencl">Vladimir Mencl</a>
 added a comment  - <span class='commentdate_21418_concise subText'><span class='date user-tz' title='01/Dec/08 5:37 PM'><time datetime='2008-12-01T17:37-0800'>01/Dec/08 5:37 PM</time></span></span>               Additional info on environment: Confluence is running against a Microsoft SQL Server 2008 database (in 2005 compatibility mode), with the jtds-1.2.2 JDBC driver.         </div>
    </div>
</div>
                     <div id="comment-21425" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-8?focusedCommentId=21425&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-21425" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="vladimir.mencl" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_21425_verbose" href="/secure/ViewProfile.jspa?name=vladimir.mencl">Vladimir Mencl</a>
 added a comment  - <span class='commentdate_21425_verbose subText'><span class='date user-tz' title='01/Dec/08 9:32 PM'><time datetime='2008-12-01T21:32-0800'>01/Dec/08 9:32 PM</time></span></span>  </div>
        <div class="action-body flooded">
<p>I have just tried compiling the current version in SVN from source code, and changed the logging command at the critical point RemoteUserAuthenticator.assignUserToRoles, line 583 to also include the exception:</p>

<p>&lt;                               + role + " but the role does not exist.");<br/>
&gt;                               + role + " but the role does not exist.", e);</p>

<p>This is the error message and the exception stackTrace I got: </p>

<p>com.atlassian.confluence.core.InsufficientPrivilegeException: User <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/Anonymous">Anonymous</a> does not have the required privileges.</p>

<p>I hope this is helpful - and that a reasonable solution can be found.</p>

<p>Cheers,<br/>
Vladimir</p>

<p>2008-12-02 16:26:23,821 ERROR <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor5">TP-Processor5</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> assignUserToRoles Attempted to add user id:786433 name:vme30@canterbury.ac.nz fullName:Vladimir Mencl email:null created:Tue Dec 02 16:26:23 NZDT 2008 to role confluence-test but the role does not exist.<br/>
com.atlassian.confluence.core.InsufficientPrivilegeException: User <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/Anonymous">Anonymous</a> does not have the required privileges.<br/>
	at com.atlassian.confluence.user.DefaultUserAccessor.addMembership(DefaultUserAccessor.java:73)<br/>
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br/>
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)<br/>
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)<br/>
	at java.lang.reflect.Method.invoke(Method.java:597)<br/>
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:304)<br/>
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:182)<br/>
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:149)<br/>
	at com.atlassian.spring.interceptors.SpringProfilingInterceptor.invoke(SpringProfilingInterceptor.java:20)<br/>
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171)<br/>
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:106)<br/>
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171)<br/>
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)<br/>
	at $Proxy23.addMembership(Unknown Source)<br/>
	at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.assignUserToRoles(RemoteUserAuthenticator.java:156)<br/>
	at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.getUser(RemoteUserAuthenticator.java:537)<br/>
	at com.atlassian.seraph.auth.AbstractAuthenticator.getUser(AbstractAuthenticator.java:44)<br/>
	at com.atlassian.seraph.filter.BaseLoginFilter$SecurityHttpRequestWrapper.getUserPrincipal(BaseLoginFilter.java:163)<br/>
	at com.atlassian.seraph.filter.BaseLoginFilter$SecurityHttpRequestWrapper.getRemoteUser(BaseLoginFilter.java:157)<br/>
	at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.getUser(RemoteUserAuthenticator.java:498)<br/>
	at com.atlassian.seraph.filter.SecurityFilter.doFilter(SecurityFilter.java:137)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)<br/>
	at com.atlassian.seraph.filter.TrustedApplicationsFilter.doFilter(TrustedApplicationsFilter.java:120)<br/>
	at com.atlassian.confluence.util.AbstractBootstrapHotSwappingFilter.doFilter(AbstractBootstrapHotSwappingFilter.java:28)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)<br/>
	at com.atlassian.seraph.filter.BaseLoginFilter.doFilter(BaseLoginFilter.java:125)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)<br/>
	at com.atlassian.confluence.util.ClusterHeaderFilter.doFilter(ClusterHeaderFilter.java:35)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)<br/>
	at com.atlassian.johnson.filters.AbstractJohnsonFilter.doFilter(AbstractJohnsonFilter.java:72)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)<br/>
	at org.springframework.orm.hibernate.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:170)<br/>
	at com.atlassian.spring.filter.FlushingSpringSessionInViewFilter.doFilterInternal(FlushingSpringSessionInViewFilter.java:29)<br/>
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:75)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)<br/>
	at com.atlassian.util.profiling.filters.ProfilingFilter.doFilter(ProfilingFilter.java:142)<br/>
	at com.atlassian.core.filters.ProfilingAndErrorFilter.doFilter(ProfilingAndErrorFilter.java:27)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)<br/>
	at com.atlassian.confluence.core.datetime.RequestTimeThreadLocalFilter.doFilter(RequestTimeThreadLocalFilter.java:34)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)<br/>
	at com.atlassian.confluence.util.RequestCacheThreadLocalFilter.doFilter(RequestCacheThreadLocalFilter.java:25)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)<br/>
	at com.atlassian.gzipfilter.GzipFilter.doFilterInternal(GzipFilter.java:94)<br/>
	at com.atlassian.gzipfilter.GzipFilter.doFilter(GzipFilter.java:64)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)<br/>
	at com.atlassian.core.filters.AbstractEncodingFilter.doFilter(AbstractEncodingFilter.java:33)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)<br/>
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:210)<br/>
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:174)<br/>
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)<br/>
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:117)<br/>
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:108)<br/>
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:151)<br/>
	at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:200)<br/>
	at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:283)<br/>
	at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:773)<br/>
	at org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:703)<br/>
	at org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.java:895)<br/>
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:685)<br/>
	at java.lang.Thread.run(Thread.java:619)</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="vladimir.mencl" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_21425_concise" href="/secure/ViewProfile.jspa?name=vladimir.mencl">Vladimir Mencl</a>
 added a comment  - <span class='commentdate_21425_concise subText'><span class='date user-tz' title='01/Dec/08 9:32 PM'><time datetime='2008-12-01T21:32-0800'>01/Dec/08 9:32 PM</time></span></span>               
I have just tried compiling the current version in SVN from source code, and changed the logging command at the critical point RemoteUserAuthenticator.assignUserToRoles, line 583 to also include the exception:

&lt;                               + role + " but the role does not exist.");
&gt;                               + role + " but the role does not exist.", e);

This is the error message and the exception stackTrace I got: 

com.atlassian.confluence.core.InsufficientPrivilegeException: User <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/Anonymous">Anonymous</a> does not have the required privileges.

I hope this is helpful - and that a reasonable solution can be found.

Cheers,
Vladimir

2008-12-02 16:26:23,821 ERROR <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/TP-Processor5">TP-Processor5</a> <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/confluence.authentication.shibboleth.RemoteUserAuthenticator">confluence.authentication.shibboleth.RemoteUserAuthenticator</a> assignUserToRoles Attempted to add user id:786433 name:vme30@canterbury.ac.nz fullName:Vladimir Mencl email:null created:Tue Dec 02 16:26:23 NZDT 2008 to role confluence-test but the role does not exist.
com.atlassian.confluence.core.InsufficientPrivilegeException: User <a href="https://studio.plugins.atlassian.com/wiki/display/SHBL/Anonymous">Anonymous</a> does not have the required privileges.
	at com.atlassian.confluence.user.DefaultUserAccessor.addMembership(DefaultUserAccessor.java:73)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:304)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:182)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:149)
	at com.atlassian.spring.interceptors.SpringProfilingInterceptor.invoke(SpringProfilingInterceptor.java:20)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:106)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
	at $Proxy23.addMembership(Unknown Source)
	at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.assignUserToRoles(RemoteUserAuthenticator.java:156)
	at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.getUser(RemoteUserAuthenticator.java:537)
	at com.atlassian.seraph.auth.AbstractAuthenticator.getUser(AbstractAuthenticator.java:44)
	at com.atlassian.seraph.filter.BaseLoginFilter$SecurityHttpRequestWrapper.getUserPrincipal(BaseLoginFilter.java:163)
	at com.atlassian.seraph.filter.BaseLoginFilter$SecurityHttpRequestWrapper.getRemoteUser(BaseLoginFilter.java:157)
	at shibauth.confluence.authentication.shibboleth.RemoteUserAuthenticator.getUser(RemoteUserAuthenticator.java:498)
	at com.atlassian.seraph.filter.SecurityFilter.doFilter(SecurityFilter.java:137)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)
	at com.atlassian.seraph.filter.TrustedApplicationsFilter.doFilter(TrustedApplicationsFilter.java:120)
	at com.atlassian.confluence.util.AbstractBootstrapHotSwappingFilter.doFilter(AbstractBootstrapHotSwappingFilter.java:28)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)
	at com.atlassian.seraph.filter.BaseLoginFilter.doFilter(BaseLoginFilter.java:125)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)
	at com.atlassian.confluence.util.ClusterHeaderFilter.doFilter(ClusterHeaderFilter.java:35)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)
	at com.atlassian.johnson.filters.AbstractJohnsonFilter.doFilter(AbstractJohnsonFilter.java:72)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)
	at org.springframework.orm.hibernate.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:170)
	at com.atlassian.spring.filter.FlushingSpringSessionInViewFilter.doFilterInternal(FlushingSpringSessionInViewFilter.java:29)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:75)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)
	at com.atlassian.util.profiling.filters.ProfilingFilter.doFilter(ProfilingFilter.java:142)
	at com.atlassian.core.filters.ProfilingAndErrorFilter.doFilter(ProfilingAndErrorFilter.java:27)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)
	at com.atlassian.confluence.core.datetime.RequestTimeThreadLocalFilter.doFilter(RequestTimeThreadLocalFilter.java:34)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)
	at com.atlassian.confluence.util.RequestCacheThreadLocalFilter.doFilter(RequestCacheThreadLocalFilter.java:25)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)
	at com.atlassian.gzipfilter.GzipFilter.doFilterInternal(GzipFilter.java:94)
	at com.atlassian.gzipfilter.GzipFilter.doFilter(GzipFilter.java:64)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)
	at com.atlassian.core.filters.AbstractEncodingFilter.doFilter(AbstractEncodingFilter.java:33)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:210)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:174)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:117)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:108)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:151)
	at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:200)
	at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:283)
	at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:773)
	at org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:703)
	at org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.java:895)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:685)
	at java.lang.Thread.run(Thread.java:619)         </div>
    </div>
</div>
                     <div id="comment-21444" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-8?focusedCommentId=21444&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-21444" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_21444_verbose" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_21444_verbose subText'><span class='date user-tz' title='02/Dec/08 8:21 AM'><time datetime='2008-12-02T08:21-0800'>02/Dec/08 8:21 AM</time></span></span>  </div>
        <div class="action-body flooded"><p>Vladimir,</p>

<p>I'm very sorry that you had this issue. The getGroup and addMembership code is in Atlassian's confluence API. Although it is possible, I think it is probably more unlikely that their API is the issue, but if you had time you could write a test plugin that attempted to do the operations you are trying to do in 2.9.2 via the API to see whether their API was the issue, and if so, open up a bug ticket in their developer Jira instance.</p>

<p>The error you posted is very helpful though, and leads me down a different trail:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">com.atlassian.confluence.core.InsufficientPrivilegeException: User [Anonymous] does not have the required privileges.</pre>
</div></div>

<p>This would seem to indicate that the authenticator does not have rights to use the Confluence API to create new groups/users. If you could please open up a support ticket with Atlassian (not a dev ticket) and tell them you need help such that an authenticator you are using should have the ability to use the following method:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">userAccessor.addMembership(group, user)</pre>
</div></div>
<p>but that you get the error</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">com.atlassian.confluence.core.InsufficientPrivilegeException: User [Anonymous] does not have the required privileges.</pre>
</div></div>
<p>and you need to know if there is any Confluence configuration change you can make such that the authenticator will have privileges to do what you need. Be sure to mention that you are not asking for support of the Shib auth plugin- only that you need to know in general whether the ability for an authenticator to use UserAccessor's addMembership method is no longer possible by default, and how to fix that. Thanks!</p>

<p>Also, you probably will want to edit the ticket description above and remove all references to your local username and email address to avoid hacking and spam (although spam is just the norm these days, so maybe email doesn't matter <img class="emoticon" src="/images/icons/emoticons/wink.gif" height="20" width="20" align="absmiddle" alt="" border="0"/> ).</p>

<p>Thanks in advance for your help,<br/>
Gary</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_21444_concise" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_21444_concise subText'><span class='date user-tz' title='02/Dec/08 8:21 AM'><time datetime='2008-12-02T08:21-0800'>02/Dec/08 8:21 AM</time></span></span>               Vladimir,

I'm very sorry that you had this issue. The getGroup and addMembership code is in Atlassian's confluence API. Although it is possible, I think it is probably more unlikely that their API is the issue, but if you had time you could write a test plugin that attempted to do the operations you are trying to do in 2.9.2 via the API to see whether their API was the issue, and if so, open up a bug ticket in their developer Jira instance.

The error you posted is very helpful though, and leads me down a different trail:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">com.atlassian.confluence.core.InsufficientPrivilegeException: User [Anonymous] does not have the required privileges.</pre>
</div></div>

This would seem to indicate that the authenticator does not have rights to use the Confluence API to create new groups/users. If you could please open up a support ticket with Atlassian (not a dev ticket) and tell them you need help such that an authenticator you are using should have the ability to use the following method:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">userAccessor.addMembership(group, user)</pre>
</div></div>
but that you get the error
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">com.atlassian.confluence.core.InsufficientPrivilegeException: User [Anonymous] does not have the required privileges.</pre>
</div></div>
and you need to know if there is any Confluence configuration change you can make such that the authenticator will have privileges to do what you need. Be sure to mention that you are not asking for support of the Shib auth plugin- only that you need to know in general whether the ability for an authenticator to use UserAccessor's addMembership method is no longer possible by default, and how to fix that. Thanks!

Also, you probably will want to edit the ticket description above and remove all references to your local username and email address to avoid hacking and spam (although spam is just the norm these days, so maybe email doesn't matter <img class="emoticon" src="/images/icons/emoticons/wink.gif" height="20" width="20" align="absmiddle" alt="" border="0"/> ).

Thanks in advance for your help,
Gary         </div>
    </div>
</div>
                     <div id="comment-21450" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-8?focusedCommentId=21450&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-21450" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="vladimir.mencl" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_21450_verbose" href="/secure/ViewProfile.jspa?name=vladimir.mencl">Vladimir Mencl</a>
 added a comment  - <span class='commentdate_21450_verbose subText'><span class='date user-tz' title='02/Dec/08 3:54 PM'><time datetime='2008-12-02T15:54-0800'>02/Dec/08 3:54 PM</time></span></span>  </div>
        <div class="action-body flooded"><p>Hi Gary,</p>

<p>Thanks - I will submit that as a support ticket with Atlassian.</p>

<p>I have just started searching their ticket database and found something related - would it have enough information for you to fix the Shibboleth Authenticator: <a href="http://jira.atlassian.com/browse/CONF-12158">http://jira.atlassian.com/browse/CONF-12158</a> ?</p>

<p>Cheers,<br/>
Vladimir</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="vladimir.mencl" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_21450_concise" href="/secure/ViewProfile.jspa?name=vladimir.mencl">Vladimir Mencl</a>
 added a comment  - <span class='commentdate_21450_concise subText'><span class='date user-tz' title='02/Dec/08 3:54 PM'><time datetime='2008-12-02T15:54-0800'>02/Dec/08 3:54 PM</time></span></span>               Hi Gary,

Thanks - I will submit that as a support ticket with Atlassian.

I have just started searching their ticket database and found something related - would it have enough information for you to fix the Shibboleth Authenticator: <a href="http://jira.atlassian.com/browse/CONF-12158">http://jira.atlassian.com/browse/CONF-12158</a> ?

Cheers,
Vladimir         </div>
    </div>
</div>
                     <div id="comment-21455" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-8?focusedCommentId=21455&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-21455" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="vladimir.mencl" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_21455_verbose" href="/secure/ViewProfile.jspa?name=vladimir.mencl">Vladimir Mencl</a>
 added a comment  - <span class='commentdate_21455_verbose subText'><span class='date user-tz' title='02/Dec/08 7:41 PM'><time datetime='2008-12-02T19:41-0800'>02/Dec/08 7:41 PM</time></span></span>  </div>
        <div class="action-body flooded"><p>Hi Gary,</p>

<p>I've just done an experiment to isolate the problem - and I have found it's not specific to a version of Confluence but to how it's configured.</p>

<p>When I did a clean install of 2.9 with the Shibboleth Authenticator module, it failed the same way as 2.9.2 failed.</p>

<p>When I changed the global permissions to give Anonymous users the permissions to "Use" confluence (browse pages and spaces), it started working.</p>

<p>It now looks like the {userAccessor.addMembership(group, user)} method succeeds for an anonymous user IFF the anonymous user is allowed to "Use Confluence: browse pages and spaces".</p>

<p>I'm already talking to the Confluence support - I will post back here the solution I'll hopefully get from them.</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="vladimir.mencl" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_21455_concise" href="/secure/ViewProfile.jspa?name=vladimir.mencl">Vladimir Mencl</a>
 added a comment  - <span class='commentdate_21455_concise subText'><span class='date user-tz' title='02/Dec/08 7:41 PM'><time datetime='2008-12-02T19:41-0800'>02/Dec/08 7:41 PM</time></span></span>               Hi Gary,

I've just done an experiment to isolate the problem - and I have found it's not specific to a version of Confluence but to how it's configured.

When I did a clean install of 2.9 with the Shibboleth Authenticator module, it failed the same way as 2.9.2 failed.

When I changed the global permissions to give Anonymous users the permissions to "Use" confluence (browse pages and spaces), it started working.

It now looks like the {userAccessor.addMembership(group, user)} method succeeds for an anonymous user IFF the anonymous user is allowed to "Use Confluence: browse pages and spaces".

I'm already talking to the Confluence support - I will post back here the solution I'll hopefully get from them.         </div>
    </div>
</div>
                     <div id="comment-21463" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-8?focusedCommentId=21463&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-21463" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
                                            
    
                

    <a class="user-hover user-avatar" rel="vladimir.mencl" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_21463_verbose" href="/secure/ViewProfile.jspa?name=vladimir.mencl">Vladimir Mencl</a>
 added a comment  - <span class='commentdate_21463_verbose subText'><span class='date user-tz' title='02/Dec/08 10:45 PM'><time datetime='2008-12-02T22:45-0800'>02/Dec/08 10:45 PM</time></span></span>   - <span class="redText subText" title="Vladimir Mencl - 02/Dec/08 10:48 PM">edited</span> </div>
        <div class="action-body flooded"><p>Hi Gary &amp; all,</p>

<p>Thanks a for the help.  Together with the help from the Atlassian support team and from searching the support database, I found a solution to this problem at <a href="http://jira.atlassian.com/browse/CONF-12158">http://jira.atlassian.com/browse/CONF-12158</a></p>

<p>The core of the solution is to call the <tt>addMembership(group, user)</tt> method on <tt>groupManager</tt> instead of <tt>userAccessor</tt>.  The dependency injection suggested at CONF-12158 is not really necessary - it works just with obtaining the <tt>groupManager</tt> reference on the fly with:</p>

<p>{{<br/>
groupManager = (GroupManager) ContainerManager.getComponent("groupManager");<br/>
}}</p>

<p>I am attaching a patch (to the SVN version) that fixes this problem - please feel free to commit it to the svn repository.</p>

<p>From what I found, the current implementation of the Shibboleth Authenticator will not work IFF the global access permission letting anonymous users use confluence is not set - which is actually the default setting.</p>

<p>This patch fixes the problem.  Use at will.</p>

<p>Thanks for your help.</p>


<p>Cheers,<br/>
Vladimir</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
                                            
    
                

    <a class="user-hover user-avatar" rel="vladimir.mencl" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_21463_concise" href="/secure/ViewProfile.jspa?name=vladimir.mencl">Vladimir Mencl</a>
 added a comment  - <span class='commentdate_21463_concise subText'><span class='date user-tz' title='02/Dec/08 10:45 PM'><time datetime='2008-12-02T22:45-0800'>02/Dec/08 10:45 PM</time></span></span>   - <span class="redText subText" title="Vladimir Mencl - 02/Dec/08 10:48 PM">edited</span>              Hi Gary &amp; all,

Thanks a for the help.  Together with the help from the Atlassian support team and from searching the support database, I found a solution to this problem at <a href="http://jira.atlassian.com/browse/CONF-12158">http://jira.atlassian.com/browse/CONF-12158</a>

The core of the solution is to call the <tt>addMembership(group, user)</tt> method on <tt>groupManager</tt> instead of <tt>userAccessor</tt>.  The dependency injection suggested at CONF-12158 is not really necessary - it works just with obtaining the <tt>groupManager</tt> reference on the fly with:

{{
groupManager = (GroupManager) ContainerManager.getComponent("groupManager");
}}

I am attaching a patch (to the SVN version) that fixes this problem - please feel free to commit it to the svn repository.

From what I found, the current implementation of the Shibboleth Authenticator will not work IFF the global access permission letting anonymous users use confluence is not set - which is actually the default setting.

This patch fixes the problem.  Use at will.

Thanks for your help.


Cheers,
Vladimir         </div>
    </div>
</div>
                     <div id="comment-21464" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-8?focusedCommentId=21464&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-21464" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="bliong" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_21464_verbose" href="/secure/ViewProfile.jspa?name=bliong">Bruce Liong</a>
 added a comment  - <span class='commentdate_21464_verbose subText'><span class='date user-tz' title='02/Dec/08 11:13 PM'><time datetime='2008-12-02T23:13-0800'>02/Dec/08 11:13 PM</time></span></span>  </div>
        <div class="action-body flooded"><p>Thanks for the patch Vlad.</p>

<p>IIRC, there was some compatibility issue with acquiring group manager (unfortunately can't test it on our environment &#8211; don't have all different versions of confluence). AFAIK, various releases of confluences have different class/package arrangements (not to mention API changes).</p>

<p>Perhaps someone can verify that it is backward compatible? It works on later versions of confluence <img class="emoticon" src="/images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="bliong" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_21464_concise" href="/secure/ViewProfile.jspa?name=bliong">Bruce Liong</a>
 added a comment  - <span class='commentdate_21464_concise subText'><span class='date user-tz' title='02/Dec/08 11:13 PM'><time datetime='2008-12-02T23:13-0800'>02/Dec/08 11:13 PM</time></span></span>               Thanks for the patch Vlad.

IIRC, there was some compatibility issue with acquiring group manager (unfortunately can't test it on our environment &#8211; don't have all different versions of confluence). AFAIK, various releases of confluences have different class/package arrangements (not to mention API changes).

Perhaps someone can verify that it is backward compatible? It works on later versions of confluence <img class="emoticon" src="/images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/>         </div>
    </div>
</div>
                     <div id="comment-21470" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-8?focusedCommentId=21470&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-21470" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_21470_verbose" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_21470_verbose subText'><span class='date user-tz' title='03/Dec/08 8:44 AM'><time datetime='2008-12-03T08:44-0800'>03/Dec/08 8:44 AM</time></span></span>  </div>
        <div class="action-body flooded"><p>Vladimir,</p>

<p>Thanks for the patch! I added a few comments and committed to trunk (revision 26335).</p>

<p>Matt Ryall of Atlassian in <a href="http://jira.atlassian.com/browse/CONF-12158">CONF-12158</a> (which is related to Confluence 2.7+ and the DefaultUserAccessor) suggested ConfluenceGroupJoiningAuthenticator.java as a good example for an authenticator that does addMembership(...) which uses code very similar to what you submitted that I found here as an attachment: <a href="http://confluence.atlassian.com/download/attachments/192312/ConfluenceGroupJoiningAuthenticator.java?version=1">http://confluence.atlassian.com/download/attachments/192312/ConfluenceGroupJoiningAuthenticator.java?version=1</a></p>

<p>Because that code was stated in <a href="http://confluence.atlassian.com/display/DOC/Automatically+Adding+LDAP+users+to+the+confluence-users+Group">http://confluence.atlassian.com/display/DOC/Automatically+Adding+LDAP+users+to+the+confluence-users+Group</a> to work with Confluence 2.2+, I am hoping (but don't have resources+time available to check unfortunately) that it will work with older versions of Confluence as well. I will note in the release that it hasn't been tested in versions of Confluence prior to 2.9.2, but that it should work in theory although there is some lack of confidence about that.</p>

<p>I'll also add you to the list of developers for the plugin if you don't mind (this doesn't imply any obligation, just fame <img class="emoticon" src="/images/icons/emoticons/wink.gif" height="20" width="20" align="absmiddle" alt="" border="0"/> ).</p>

<p>Thanks again,</p>

<p>Gary</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_21470_concise" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_21470_concise subText'><span class='date user-tz' title='03/Dec/08 8:44 AM'><time datetime='2008-12-03T08:44-0800'>03/Dec/08 8:44 AM</time></span></span>               Vladimir,

Thanks for the patch! I added a few comments and committed to trunk (revision 26335).

Matt Ryall of Atlassian in <a href="http://jira.atlassian.com/browse/CONF-12158">CONF-12158</a> (which is related to Confluence 2.7+ and the DefaultUserAccessor) suggested ConfluenceGroupJoiningAuthenticator.java as a good example for an authenticator that does addMembership(...) which uses code very similar to what you submitted that I found here as an attachment: <a href="http://confluence.atlassian.com/download/attachments/192312/ConfluenceGroupJoiningAuthenticator.java?version=1">http://confluence.atlassian.com/download/attachments/192312/ConfluenceGroupJoiningAuthenticator.java?version=1</a>

Because that code was stated in <a href="http://confluence.atlassian.com/display/DOC/Automatically+Adding+LDAP+users+to+the+confluence-users+Group">http://confluence.atlassian.com/display/DOC/Automatically+Adding+LDAP+users+to+the+confluence-users+Group</a> to work with Confluence 2.2+, I am hoping (but don't have resources+time available to check unfortunately) that it will work with older versions of Confluence as well. I will note in the release that it hasn't been tested in versions of Confluence prior to 2.9.2, but that it should work in theory although there is some lack of confidence about that.

I'll also add you to the list of developers for the plugin if you don't mind (this doesn't imply any obligation, just fame <img class="emoticon" src="/images/icons/emoticons/wink.gif" height="20" width="20" align="absmiddle" alt="" border="0"/> ).

Thanks again,

Gary         </div>
    </div>
</div>
                     <div id="comment-21471" class="issue-data-block activity-comment twixi-block expanded">
    <div class="twixi-wrap verbose actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
        <div class="action-links">
            <a href="/browse/SHBL-8?focusedCommentId=21471&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-21471" title="A permanent link to this comment." class="icon icon-perma"><span>Permalink</span></a>
                                </div>
        <div class="action-details">
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_21471_verbose" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_21471_verbose subText'><span class='date user-tz' title='03/Dec/08 9:54 AM'><time datetime='2008-12-03T09:54-0800'>03/Dec/08 9:54 AM</time></span></span>  </div>
        <div class="action-body flooded"><p>patch applied, pom.xml updated with developer info, fix released in 1.3, page updated. I compiled it against 2.3 with no problem, and the patch applied mimics an Atlassian suggested solution for Confluence 2.2+ included with Confluence 2.3+, so I think the plugin should work in Confluence 2.3+ still. However, since it is not tested and Bruc noted concern, I've tried to relay that concern and need for testing in the wiki page and version comment. Please let me know if that sounds ok.</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
        <div class="action-details flooded">
            
    
    
    
                

    <a class="user-hover user-avatar" rel="gswduke" style="background-image:url(/secure/useravatar?size=small&amp;avatarId=10182);"  id="commentauthor_21471_concise" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
 added a comment  - <span class='commentdate_21471_concise subText'><span class='date user-tz' title='03/Dec/08 9:54 AM'><time datetime='2008-12-03T09:54-0800'>03/Dec/08 9:54 AM</time></span></span>               patch applied, pom.xml updated with developer info, fix released in 1.3, page updated. I compiled it against 2.3 with no problem, and the patch applied mimics an Atlassian suggested solution for Confluence 2.2+ included with Confluence 2.3+, so I think the plugin should work in Confluence 2.3+ still. However, since it is not tested and Bruc noted concern, I've tried to relay that concern and need for testing in the wiki page and version comment. Please let me know if that sounds ok.         </div>
    </div>
</div>
                 </div>
</div></div>
                

            </div>
        </div>

        <div class="column" id="secondary">
            <div class="content">
                
                    <div class='module toggle-wrap' id='peoplemodule'><div id='peoplemodule_heading' class='mod-header'><h3 class='toggle-title'>People</h3></div><div class='mod-content'><ul class="item-details" id="peopledetails">
    <li class="people-details">
                <dl>
            <dt>Assignee:</dt>
            <dd id="assignee-val">
                        <a class="user-hover" rel="gswduke" id="issue_summary_assignee_gswduke" href="/secure/ViewProfile.jspa?name=gswduke">Gary S. Weaver</a>
            </dd>
        </dl>
                        <dl>
            <dt>Reporter:</dt>
            <dd id="reporter-val">
                        <a class="user-hover" rel="vladimir.mencl" id="issue_summary_reporter_vladimir.mencl" href="/secure/ViewProfile.jspa?name=vladimir.mencl">Vladimir Mencl</a>
            </dd>
        </dl>
                    </li>
</ul>
<div id="votes-val">
                <span id="vote-label" title="You cannot vote or change your vote on resolved issues."><span class="icon icon-vote-disabled"></span><span class="action-text">Vote</span></span>
    
                (<span id="vote-data">0</span>)
    </div>
<div id="watchers-val">
            <span id="watch-label" title="You have to be logged in to watch an issue."><span class="icon icon-watch-disabled"></span>Watch</span>
    
        
            (<span id="watcher-data">1</span>)
    </div>
</div></div><div class='module toggle-wrap' id='datesmodule'><div id='datesmodule_heading' class='mod-header'><h3 class='toggle-title'>Dates</h3></div><div class='mod-content'><ul class="item-details">
    <li>
            <dl class="dates">
            <dt>Created:</dt>
            <dd id="create-date" class="date user-tz"  title="01/Dec/08 5:24 PM" >
                        <time datetime="2008-12-01T17:24-0800">01/Dec/08 5:24 PM</time></dd>                     </dd>
        </dl>
            <dl class="dates">
            <dt>Updated:</dt>
            <dd id="updated-date" class="date user-tz"  title="03/Dec/08 9:57 AM" >
                        <time datetime="2008-12-03T09:57-0800">03/Dec/08 9:57 AM</time></dd>                     </dd>
        </dl>
            <dl class="dates">
            <dt>Resolved:</dt>
            <dd id="resolved-date" class="date user-tz"  title="03/Dec/08 9:54 AM" >
                        <time datetime="2008-12-03T09:54-0800">03/Dec/08 9:54 AM</time></dd>                     </dd>
        </dl>
        </li>
</ul>
</div></div>
                

            </div>
        </div>
        
            
                
            
        

    </div>
</div>










<div id="studio-footer" class="footer" style="width:100%; padding:0 0 25px 0;">
    <div id="poweredby">
        <p>
            Powered by <a href="http://www.atlassian.com/hosted/studio">JIRA Studio</a> <span id="studioVersion">107.6 r5978538efb935b5414d28000aa78b98bedfcae46</span> |
            <a href="http://www.atlassian.com/hosted/terms.jsp">Terms of Use</a> |
            <a href="http://studio.atlassian.com/browse/JST">Bug/feature request</a> |
            <a href="https://support.atlassian.com/secure/CreateIssueDetails!init.jspa?summary=Your+summary+here...&amp;issuetype=1&amp;priority=3&amp;description=Please+describe+your+problem+here%3A%0A%0A%0AProblem+reported+from+URL%3A+https%3A%2F%2Fstudio.plugins.atlassian.com%2Fbrowse%2FSHBL-8&amp;customfield_10440=https%3A%2F%2Fstudio.plugins.atlassian.com&amp;pid=10140&amp;">Request Support</a> |
            <a href="http://confluence.atlassian.com/display/JIRASTUDIO" target="help_JIRASTUDIO" rel="nofollow">Help/Documentation</a> |
            <a href="http://blogs.atlassian.com/devtools/studio">JIRA Studio Blog</a> |
            <a href="http://twitter.com/jirastudio">Twitter @JIRAStudio</a>
        </p>
    </div>
</div>

<script type="text/javascript" charset="utf-8" src="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/js/contentnamesearch.js"></script>
<script type="text/javascript" charset="utf-8" src="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/js/split_button.js"></script>
<script type="text/javascript" charset="utf-8" src="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/js/userstatus.js"></script>

            <script type="text/javascript" charset="utf-8" src="/s/en_US-31q2po/650/149/107.6.4/_/download/resources/com.atlassian.studio.static:studio_resources/js/safe-ajax.js"></script>
    
<script type="text/javascript">
    // This is the app specific data that the shared js expects
    studioData = {"jiraUrl" : "https://studio.plugins.atlassian.com"};

            document.cookie = "studio.project.rec.used.cookie=" + escape("SHBL-_-") + "; Max-Age=31536000; path=/;";
    
    // Google analytics
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-6032469-30");
    pageTracker._trackPageview();
    } catch(err) {}
</script>

<form id="jira_request_timing_info" class="dont-default-focus" >
	<fieldset class="parameters hidden">
		<input type="hidden" title="jira.request.start.millis" value="1358699862187" />
		<input type="hidden" title="jira.request.server.time" value="5956" />
		<input type="hidden" title="jira.request.id" value="517x7330355x1" />
		<input type="hidden" title="jira.session.expiry.time" value="-" />
		<input type="hidden" title="jira.session.expiry.in.mins" value="-" />
		<input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="1" />
	</fieldset>
</form>
<!--
	                 REQUEST ID : 517x7330355x1
	          REQUEST TIMESTAMP : [20/Jan/2013:08:37:42 -0800]
	               REQUEST TIME : 5.9560
	                 ASESSIONID : quh8wg
	        CONCURRENT REQUESTS : 1
-->
</body>
</html>
